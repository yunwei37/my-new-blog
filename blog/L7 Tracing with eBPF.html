<!DOCTYPE html><!--ER0GCm_u0u_RRwl37uz71--><html lang="en-us" class="__variable_dd5b2f scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/36966cca54120369-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/a06d7e24bf9a7d93.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/54f53e18fb3a4e82.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/7246298b30c42979.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-b4f750df33af4b53.js"/><script src="/_next/static/chunks/4bd1b696-cf72ae8a39fa05aa.js" async=""></script><script src="/_next/static/chunks/964-dd2321b4b492b566.js" async=""></script><script src="/_next/static/chunks/main-app-f9ac654e1cc1d2dc.js" async=""></script><script src="/_next/static/chunks/874-8edb22cc7428423c.js" async=""></script><script src="/_next/static/chunks/650-5c537ecaa5d1cd34.js" async=""></script><script src="/_next/static/chunks/app/layout-1a2cfbd13c591174.js" async=""></script><script src="/_next/static/chunks/63-d245e42a784ca56d.js" async=""></script><script src="/_next/static/chunks/app/blog/%5B...slug%5D/page-71c7cfee63112339.js" async=""></script><link rel="preload" href="https://analytics.umami.is/script.js" as="script"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/svg+xml" href="/static/favicons/favicon.svg"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><meta name="next-size-adjust" content=""/><title>L7 Tracing with eBPF: HTTP and Beyond via Socket Filters and Syscall Tracing | 云微的胡思乱想</title><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://www.yunwei37.com/blog/L7%20Tracing%20with%20eBPF"/><link rel="alternate" type="application/rss+xml" href="https://www.yunwei37.com/feed.xml"/><meta property="og:title" content="L7 Tracing with eBPF: HTTP and Beyond via Socket Filters and Syscall Tracing"/><meta property="og:url" content="https://www.yunwei37.com/blog/L7%20Tracing%20with%20eBPF"/><meta property="og:site_name" content="云微的胡思乱想"/><meta property="og:locale" content="en_US"/><meta property="og:image" content="https://www.yunwei37.com/static/images/twitter-card.png"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2023-06-14T02:41:06.000Z"/><meta property="article:modified_time" content="2023-06-14T02:41:06.000Z"/><meta property="article:author" content="Yusheng Zheng (云微)"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="L7 Tracing with eBPF: HTTP and Beyond via Socket Filters and Syscall Tracing"/><meta name="twitter:image" content="https://www.yunwei37.com/static/images/twitter-card.png"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="pl-[calc(100vw-100%)] text-black antialiased dark:text-white min-h-screen"><div hidden=""><!--$--><!--/$--></div><script>((a,b,c,d,e,f,g,h)=>{let i=document.documentElement,j=["light","dark"];function k(b){var c;(Array.isArray(a)?a:[a]).forEach(a=>{let c="class"===a,d=c&&f?e.map(a=>f[a]||a):e;c?(i.classList.remove(...d),i.classList.add(f&&f[b]?f[b]:b)):i.setAttribute(a,b)}),c=b,h&&j.includes(c)&&(i.style.colorScheme=c)}if(d)k(d);else try{let a=localStorage.getItem(b)||c,d=g&&"system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a;k(d)}catch(a){}})("class","theme","system",null,["light","dark"],null,true,true)</script><div class="min-h-screen flex flex-col justify-center py-8"><div class="content-glass mx-auto w-full max-w-5xl px-4 sm:px-6 xl:px-8 py-8"><header class="flex items-center w-full justify-between py-6 border-b border-gray-200/30 dark:border-gray-700/30"><a class="break-words" aria-label="yunwei37" href="/"><div class="flex items-center"><div class="mr-3"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="none"><defs><linearGradient id="logo_svg__a" x1="0%" x2="100%" y1="0%" y2="100%"><stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1"></stop><stop offset="100%" style="stop-color:#06b6d4;stop-opacity:1"></stop></linearGradient><linearGradient id="logo_svg__b" x1="0%" x2="100%" y1="0%" y2="100%"><stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1"></stop><stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1"></stop></linearGradient></defs><circle cx="20" cy="20" r="18" fill="url(#logo_svg__a)" opacity="0.1"></circle><path fill="url(#logo_svg__a)" d="m12 8 6 10v10h4V18l6-10h-4l-4 6-4-6Z"></path><path fill="url(#logo_svg__b)" d="m8 24 4 8 4-8 4 8 4-8h8v4h-6l-4 8-4-8-4 8-4-8H8Z" opacity="0.8"></path><circle cx="32" cy="12" r="2" fill="url(#logo_svg__b)"></circle><circle cx="8" cy="12" r="1.5" fill="url(#logo_svg__a)" opacity="0.6"></circle></svg></div><div class="hidden text-2xl font-bold sm:block hover:text-primary-600 dark:hover:text-primary-400 transition-colors">yunwei37</div></div></a><div class="flex items-center space-x-4"><div class="no-scrollbar hidden items-center space-x-2 sm:flex"><a class="px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400" href="/blog">Blog</a><a class="px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400" href="/docs">Docs</a><a class="px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400" href="/tags">Tags</a><a class="px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400" href="/about">About</a></div><div class="flex items-center space-x-2"><button aria-label="Search" class="p-2 rounded-lg transition-all duration-200"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></button><button aria-label="Toggle Menu" class="sm:hidden p-2 rounded-lg hover:glass transition-all duration-200 hover:scale-105"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-6 w-6 hover:text-primary-600 dark:hover:text-primary-400 transition-colors"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg></button><span hidden="" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></span></div></div></header><main class="py-6"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"L7 Tracing with eBPF: HTTP and Beyond via Socket Filters and Syscall Tracing","datePublished":"2023-06-14T02:41:06.000Z","dateModified":"2023-06-14T02:41:06.000Z","image":"/static/images/twitter-card.png","url":"https://www.yunwei37.com/blog/L7 Tracing with eBPF","author":[{"@type":"Person","name":"Yusheng Zheng (云微)"}]}</script><section class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="fixed right-8 bottom-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" class="rounded-full bg-white/20 dark:bg-black/20 p-2 transition-all hover:bg-white/30 dark:hover:bg-black/30"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" class="rounded-full bg-white/20 dark:bg-black/20 p-2 transition-all hover:bg-white/30 dark:hover:bg-black/30"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article class="content-glass p-8"><div class="xl:divide-y xl:divide-gray-200/30 xl:dark:divide-gray-700/30"><header class="pt-6 xl:pb-6"><div class="space-y-4 text-center"><dl class="space-y-4"><div><dt class="sr-only">Published on</dt><dd class="text-base leading-6 font-medium text-gray-600 dark:text-gray-300"><time dateTime="2023-06-14T02:41:06.000Z">Wednesday, June 14, 2023</time></dd></div></dl><div><h1 class="text-3xl leading-9 font-extrabold tracking-tight sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">L7 Tracing with eBPF: HTTP and Beyond via Socket Filters and Syscall Tracing</h1></div></div></header><div class="grid-rows-[auto_1fr] divide-y divide-gray-200/30 pb-8 xl:grid xl:grid-cols-4 xl:gap-x-8 xl:divide-y-0 dark:divide-gray-700/30"><dl class="pt-6 pb-10 xl:border-b xl:border-gray-200/30 xl:pt-11 xl:dark:border-gray-700/30"><dt class="sr-only">Authors</dt><dd><ul class="flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-y-6 xl:space-x-0"><li class="flex items-center space-x-3 glass p-4 rounded-xl"><img alt="avatar" loading="lazy" width="38" height="38" decoding="async" data-nimg="1" class="h-10 w-10 rounded-full" style="color:transparent" src="/static/images/avatar.png"/><dl class="text-sm leading-5 font-medium whitespace-nowrap"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Yusheng Zheng (云微)</dd><dt class="sr-only">Twitter</dt><dd><a class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors" target="_blank" rel="noopener noreferrer" href="https://twitter.com/yunwei37">@yunwei37</a></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200/30 xl:col-span-3 xl:row-span-2 xl:pb-0 dark:divide-gray-700/30"><div class="prose dark:prose-invert max-w-none pt-10 pb-8 text-gray-700 dark:text-gray-200"><p>In today&#x27;s technology landscape, with the rise of microservices, cloud-native applications, and complex distributed systems, observability of systems has become a crucial factor in ensuring their health, performance, and security. Especially in a microservices architecture, application components may be distributed across multiple containers and servers, making traditional monitoring methods often insufficient to provide the depth and breadth needed to fully understand the behavior of the system. This is where observing seven-layer protocols such as HTTP, gRPC, MQTT, and more becomes particularly important.</p><p>Seven-layer protocols provide detailed insights into how applications interact with other services and components. In a microservices environment, understanding these interactions is vital, as they often serve as the root causes of performance bottlenecks, failures, and security issues. However, monitoring these protocols is not a straightforward task. Traditional network monitoring tools like tcpdump, while effective at capturing network traffic, often fall short when dealing with the complexity and dynamism of seven-layer protocols.</p><p>This is where eBPF (extended Berkeley Packet Filter) technology comes into play. eBPF allows developers and operators to delve deep into the kernel layer, observing and analyzing system behavior in real-time without the need to modify or insert instrumentation into application code. This presents a unique opportunity to handle application layer traffic more simply and efficiently, particularly in microservices environments.</p><p>In this tutorial, we will delve into the following:</p><ul><li>Tracking seven-layer protocols such as HTTP and the challenges associated with them.</li><li>eBPF&#x27;s socket filter and syscall tracing: How these two technologies assist in tracing HTTP network request data at different kernel layers, and the advantages and limitations of each.</li><li>eBPF practical tutorial: How to develop an eBPF program and utilize eBPF socket filter or syscall tracing to capture and analyze HTTP traffic.</li></ul><p>As network traffic increases and applications grow in complexity, gaining a deeper understanding of seven-layer protocols becomes increasingly important. Through this tutorial, you will acquire the necessary knowledge and tools to more effectively monitor and analyze your network traffic, ultimately enhancing the performance of your applications and servers.</p><p>This article is part of the eBPF Developer Tutorial, and for more detailed content, you can visit <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://eunomia.dev/tutorials/">here</a>. The source code is available on the <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/eunomia-bpf/bpf-developer-tutorial">GitHub repository</a>.</p><h2 class="content-header" id="challenges-in-tracking-http-http2-and-other-seven-layer-protocols"><a class="break-words" href="#challenges-in-tracking-http-http2-and-other-seven-layer-protocols" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Challenges in Tracking HTTP, HTTP/2, and Other Seven-Layer Protocols</h2><p>In the modern networking environment, seven-layer protocols extend beyond just HTTP. In fact, there are many seven-layer protocols such as HTTP/2, gRPC, MQTT, WebSocket, AMQP, and SMTP, each serving critical roles in various application scenarios. These protocols provide detailed insights into how applications interact with other services and components. However, tracking these protocols is not a simple task, especially within complex distributed systems.</p><ol><li><p><strong>Diversity and Complexity</strong>: Each seven-layer protocol has its specific design and workings. For example, gRPC utilizes HTTP/2 as its transport protocol and supports multiple languages, while MQTT is a lightweight publish/subscribe messaging transport protocol designed for low-bandwidth and unreliable networks.</p></li><li><p><strong>Dynamism</strong>: Many seven-layer protocols are dynamic, meaning their behavior can change based on network conditions, application requirements, or other factors.</p></li><li><p><strong>Encryption and Security</strong>: With increased security awareness, many seven-layer protocols employ encryption technologies such as TLS/SSL. This introduces additional challenges for tracking and analysis, as decrypting traffic is required for in-depth examination.</p></li><li><p><strong>High-Performance Requirements</strong>: In high-traffic production environments, capturing and analyzing traffic for seven-layer protocols can impact system performance. Traditional network monitoring tools may struggle to handle a large number of concurrent sessions.</p></li><li><p><strong>Data Completeness and Continuity</strong>: Unlike tools like tcpdump, which capture individual packets, tracking seven-layer protocols requires capturing complete sessions, which may involve multiple packets. This necessitates tools capable of correctly reassembling and parsing these packets to provide a continuous session view.</p></li><li><p><strong>Code Intrusiveness</strong>: To gain deeper insights into the behavior of seven-layer protocols, developers may need to modify application code to add monitoring functionalities. This not only increases development and maintenance complexity but can also impact application performance.</p></li></ol><p>As mentioned earlier, eBPF provides a powerful solution, allowing us to capture and analyze seven-layer protocol traffic in the kernel layer without modifying application code. This approach not only offers insights into system behavior but also ensures optimal performance and efficiency. This is why eBPF has become the preferred technology for modern observability tools, especially in production environments that demand high performance and low latency.</p><h2 class="content-header" id="ebpf-socket-filter-vs-syscall-tracing-in-depth-analysis-and-comparison"><a class="break-words" href="#ebpf-socket-filter-vs-syscall-tracing-in-depth-analysis-and-comparison" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>eBPF Socket Filter vs. Syscall Tracing: In-Depth Analysis and Comparison</h2><h3 class="content-header" id="ebpf-socket-filter"><a class="break-words" href="#ebpf-socket-filter" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>eBPF Socket Filter</strong></h3><p><strong>What Is It?</strong> eBPF socket filter is an extension of the classic Berkeley Packet Filter (BPF) that allows for more advanced packet filtering directly within the kernel. It operates at the socket layer, enabling fine-grained control over which packets are processed by user-space applications.</p><p><strong>Key Features:</strong></p><ul><li><strong>Performance</strong>: By handling packets directly within the kernel, eBPF socket filters reduce the overhead of context switches between user and kernel spaces.</li><li><strong>Flexibility</strong>: eBPF socket filters can be attached to any socket, providing a universal packet filtering mechanism for various protocols and socket types.</li><li><strong>Programmability</strong>: Developers can write custom eBPF programs to define complex filtering logic beyond simple packet matching.</li></ul><p><strong>Use Cases:</strong></p><ul><li><strong>Traffic Control</strong>: Restrict or prioritize traffic based on custom conditions.</li><li><strong>Security</strong>: Discard malicious packets before they reach user-space applications.</li><li><strong>Monitoring</strong>: Capture specific packets for analysis without affecting other traffic.</li></ul><h3 class="content-header" id="ebpf-syscall-tracing"><a class="break-words" href="#ebpf-syscall-tracing" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a><strong>eBPF Syscall Tracing</strong></h3><p><strong>What Is It?</strong> System call tracing using eBPF allows monitoring and manipulation of system calls made by applications. System calls are the primary mechanism through which user-space applications interact with the kernel, making tracing them a valuable way to understand application behavior.</p><p><strong>Key Features:</strong></p><ul><li><strong>Granularity</strong>: eBPF allows tracing specific system calls, even specific parameters within those system calls.</li><li><strong>Low Overhead</strong>: Compared to other tracing methods, eBPF syscall tracing is designed to have minimal performance impact.</li><li><strong>Security</strong>: Kernel validates eBPF programs to ensure they do not compromise system stability.</li></ul><p><strong>How It Works:</strong> eBPF syscall tracing typically involves attaching eBPF programs to tracepoints or kprobes related to the system calls being traced. When the traced system call is invoked, the eBPF program is executed, allowing data collection or even modification of system call parameters.</p><h3 class="content-header" id="comparison-of-ebpf-socket-filter-and-syscall-tracing"><a class="break-words" href="#comparison-of-ebpf-socket-filter-and-syscall-tracing" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Comparison of eBPF Socket Filter and Syscall Tracing</h3><div class="w-full overflow-x-auto"><table><thead><tr><th>Aspect</th><th>eBPF Socket Filter</th><th>eBPF Syscall Tracing</th></tr></thead><tbody><tr><td><strong>Operational Layer</strong></td><td>Socket layer, primarily dealing with network packets received from or sent to sockets.</td><td>System call layer, monitoring and potentially altering the behavior of system calls made by applications.</td></tr><tr><td><strong>Primary Use Cases</strong></td><td>Mainly used for filtering, monitoring, and manipulation of network packets.</td><td>Used for performance analysis, security monitoring, and debugging of interactions with the network.</td></tr><tr><td><strong>Granularity</strong></td><td>Focuses on individual network packets.</td><td>Can monitor a wide range of system activities, including those unrelated to networking.</td></tr><tr><td><strong>Tracking HTTP Traffic</strong></td><td>Can be used to filter and capture HTTP packets passed through sockets.</td><td>Can trace system calls associated with networking operations, which may include HTTP traffic.</td></tr></tbody></table></div><p>In summary, both eBPF socket filters and syscall tracing can be used to trace HTTP traffic, but socket filters are more direct and suitable for this purpose. However, if you are interested in the broader context of how an application interacts with the system (e.g., which system calls lead to HTTP traffic), syscall tracing can be highly valuable. In many advanced observability setups, both tools may be used simultaneously to provide a comprehensive view of system and network behavior.</p><h2 class="content-header" id="capturing-http-traffic-with-ebpf-socket-filter"><a class="break-words" href="#capturing-http-traffic-with-ebpf-socket-filter" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Capturing HTTP Traffic with eBPF Socket Filter</h2><p>eBPF code consists of user-space and kernel-space components, and here we primarily focus on the kernel-space code. Below is the main logic for capturing HTTP traffic in the kernel using eBPF socket filter technology, and the complete code is provided:</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;socket&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">int</span> <span class="token function">socket_handler</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">__sk_buff</span> <span class="token operator">*</span>skb<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">struct</span> <span class="token class-name">so_event</span> <span class="token operator">*</span>e<span class="token punctuation">;</span>
</span><span class="code-line">    __u8 verlen<span class="token punctuation">;</span>
</span><span class="code-line">    __u16 proto<span class="token punctuation">;</span>
</span><span class="code-line">    __u32 nhoff <span class="token operator">=</span> ETH_HLEN<span class="token punctuation">;</span>
</span><span class="code-line">    __u32 ip_proto <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">    __u32 tcp_hdr_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">    __u16 tlen<span class="token punctuation">;</span>
</span><span class="code-line">    __u32 payload_offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">    __u32 payload_length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">    __u8 hdr_len<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>proto<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    proto <span class="token operator">=</span> <span class="token function">__bpf_ntohs</span><span class="token punctuation">(</span>proto<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>proto <span class="token operator">!=</span> ETH_P_IP<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ip_is_fragment</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// ip4 header lengths are variable</span>
</span><span class="code-line">    <span class="token comment">// access ihl as a u8 (linux/include/linux/skbuff.h)</span>
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> ETH_HLEN<span class="token punctuation">,</span> <span class="token operator">&amp;</span>hdr_len<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>hdr_len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    hdr_len <span class="token operator">&amp;=</span> <span class="token number">0x0f</span><span class="token punctuation">;</span>
</span><span class="code-line">    hdr_len <span class="token operator">*=</span> <span class="token number">4</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">/* verify hlen meets minimum size requirements */</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>hdr_len <span class="token operator">&lt;</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">iphdr</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">iphdr</span><span class="token punctuation">,</span> protocol<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ip_proto<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>ip_proto <span class="token operator">!=</span> IPPROTO_TCP<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    tcp_hdr_len <span class="token operator">=</span> nhoff <span class="token operator">+</span> hdr_len<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>verlen<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">iphdr</span><span class="token punctuation">,</span> tot_len<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>tlen<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>tlen<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    __u8 doff<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> tcp_hdr_len <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">__tcphdr</span><span class="token punctuation">,</span> ack_seq<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>doff<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>doff<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// read the first byte past __tcphdr-&gt;ack_seq, we can&#x27;t do offsetof bit fields</span>
</span><span class="code-line">    doff <span class="token operator">&amp;=</span> <span class="token number">0xf0</span><span class="token punctuation">;</span> <span class="token comment">// clean-up res1</span>
</span><span class="code-line">    doff <span class="token operator">&gt;&gt;=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// move the upper 4 bits to low</span>
</span><span class="code-line">    doff <span class="token operator">*=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// convert to bytes length</span>
</span><span class="code-line">
</span><span class="code-line">    payload_offset <span class="token operator">=</span> ETH_HLEN <span class="token operator">+</span> hdr_len <span class="token operator">+</span> doff<span class="token punctuation">;</span>
</span><span class="code-line">    payload_length <span class="token operator">=</span> <span class="token function">__bpf_ntohs</span><span class="token punctuation">(</span>tlen<span class="token punctuation">)</span> <span class="token operator">-</span> hdr_len <span class="token operator">-</span> doff<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">char</span> line_buffer<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>payload_length <span class="token operator">&lt;</span> <span class="token number">7</span> <span class="token operator">||</span> payload_offset <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> payload_offset<span class="token punctuation">,</span> line_buffer<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">bpf_printk</span><span class="token punctuation">(</span><span class="token string">&quot;%d len %d buffer: %s&quot;</span><span class="token punctuation">,</span> payload_offset<span class="token punctuation">,</span> payload_length<span class="token punctuation">,</span> line_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">bpf_strncmp</span><span class="token punctuation">(</span>line_buffer<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
</span><span class="code-line">        <span class="token function">bpf_strncmp</span><span class="token punctuation">(</span>line_buffer<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
</span><span class="code-line">        <span class="token function">bpf_strncmp</span><span class="token punctuation">(</span>line_buffer<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;PUT&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
</span><span class="code-line">        <span class="token function">bpf_strncmp</span><span class="token punctuation">(</span>line_buffer<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">&quot;DELETE&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
</span><span class="code-line">        <span class="token function">bpf_strncmp</span><span class="token punctuation">(</span>line_buffer<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;HTTP&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">/* reserve sample from BPF ringbuf */</span>
</span><span class="code-line">    e <span class="token operator">=</span> <span class="token function">bpf_ringbuf_reserve</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rb<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    e<span class="token operator">-&gt;</span>ip_proto <span class="token operator">=</span> ip_proto<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> hdr_len<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>e<span class="token operator">-&gt;</span>ports<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    e<span class="token operator">-&gt;</span>pkt_type <span class="token operator">=</span> skb<span class="token operator">-&gt;</span>pkt_type<span class="token punctuation">;</span>
</span><span class="code-line">    e<span class="token operator">-&gt;</span>ifindex <span class="token operator">=</span> skb<span class="token operator">-&gt;</span>ifindex<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    e<span class="token operator">-&gt;</span>payload_length <span class="token operator">=</span> payload_length<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> payload_offset<span class="token punctuation">,</span> e<span class="token operator">-&gt;</span>payload<span class="token punctuation">,</span> MAX_BUF_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">iphdr</span><span class="token punctuation">,</span> saddr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>e<span class="token operator">-&gt;</span>src_addr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">iphdr</span><span class="token punctuation">,</span> daddr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>e<span class="token operator">-&gt;</span>dst_addr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">bpf_ringbuf_submit</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">return</span> skb<span class="token operator">-&gt;</span>len<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>When analyzing this eBPF program, we will explain it in detail according to the content of each code block and provide relevant background knowledge:</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;socket&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">int</span> <span class="token function">socket_handler</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">__sk_buff</span> <span class="token operator">*</span>skb<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// ...</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>This is the entry point of the eBPF program, defining a function named <code>socket_handler</code> that the kernel uses to handle incoming network packets. This function is located in an eBPF section named <code>socket</code>, indicating that it is intended for socket handling.</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token keyword">struct</span> <span class="token class-name">so_event</span> <span class="token operator">*</span>e<span class="token punctuation">;</span>
</span><span class="code-line">__u8 verlen<span class="token punctuation">;</span>
</span><span class="code-line">__u16 proto<span class="token punctuation">;</span>
</span><span class="code-line">__u32 nhoff <span class="token operator">=</span> ETH_HLEN<span class="token punctuation">;</span>
</span><span class="code-line">__u32 ip_proto <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">__u32 tcp_hdr_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">__u16 tlen<span class="token punctuation">;</span>
</span><span class="code-line">__u32 payload_offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">__u32 payload_length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line">__u8 hdr_len<span class="token punctuation">;</span>
</span></code></pre></div><p>In this code block, several variables are defined to store information needed during packet processing. These variables include <code>struct so_event *e</code> for storing event information, <code>verlen</code>, <code>proto</code>, <code>nhoff</code>, <code>ip_proto</code>, <code>tcp_hdr_len</code>, <code>tlen</code>, <code>payload_offset</code>, <code>payload_length</code>, and <code>hdr_len</code> for storing packet information.</p><ul><li><code>struct so_event *e;</code>: This is a pointer to the <code>so_event</code> structure for storing captured event information. The specific definition of this structure is located elsewhere in the program.</li><li><code>__u8 verlen;</code>, <code>__u16 proto;</code>, <code>__u32 nhoff = ETH_HLEN;</code>: These variables are used to store various pieces of information, such as protocol types, packet offsets, etc. <code>nhoff</code> is initialized to the length of the Ethernet frame header, typically 14 bytes, as Ethernet frame headers include destination MAC address, source MAC address, and frame type fields.</li><li><code>__u32 ip_proto = 0;</code>: This variable is used to store the type of the IP protocol and is initialized to 0.</li><li><code>__u32 tcp_hdr_len = 0;</code>: This variable is used to store the length of the TCP header and is initialized to 0.</li><li><code>__u16 tlen;</code>: This variable is used to store the total length of the IP packet.</li><li><code>__u32 payload_offset = 0;</code>, <code>__u32 payload_length = 0;</code>: These two variables are used to store the offset and length of the HTTP request payload.</li><li><code>__u8 hdr_len;</code>: This variable is used to store the length of the IP header.</li></ul><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>proto<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">proto <span class="token operator">=</span> <span class="token function">__bpf_ntohs</span><span class="token punctuation">(</span>proto<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span>proto <span class="token operator">!=</span> ETH_P_IP<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span></code></pre></div><p>Here, the code loads the Ethernet frame type field from the packet, which tells us the network layer protocol being used in the packet. It then uses the <code>__bpf_ntohs</code> function to convert the network byte order type field into host byte order. Next, the code checks if the type field is not equal to the Ethernet frame type for IPv4 (0x0800). If it&#x27;s not equal, it means the packet is not an IPv4 packet, and the function returns 0, indicating that the packet should not be processed.</p><p>Key concepts to understand here:</p><ul><li>Ethernet Frame: The Ethernet frame is a data link layer (Layer 2) protocol used for transmitting data frames within a local area network (LAN). Ethernet frames typically include destination MAC address, source MAC address, and frame type fields.</li><li>Network Byte Order: Network protocols often use big-endian byte order to represent data. Therefore, data received from the network needs to be converted into host byte order for proper interpretation on the host. Here, the type field from the network is converted to host byte order for further processing.</li><li>IPv4 Frame Type (ETH_P_IP): This represents the frame type field in the Ethernet frame, where 0x0800 indicates IPv4.</li></ul><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ip_is_fragment</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span></code></pre></div><p>This part of the code checks if IP fragmentation is being handled. IP fragmentation is a mechanism for splitting larger IP packets into multiple smaller fragments for transmission. Here, if the packet is an IP fragment, the function returns 0, indicating that only complete packets will be processed.</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">ip_is_fragment</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">__sk_buff</span> <span class="token operator">*</span>skb<span class="token punctuation">,</span> __u32 nhoff<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    __u16 frag_off<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">iphdr</span><span class="token punctuation">,</span> frag_off<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>frag_off<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    frag_off <span class="token operator">=</span> <span class="token function">__bpf_ntohs</span><span class="token punctuation">(</span>frag_off<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">return</span> frag_off <span class="token operator">&amp;</span> <span class="token punctuation">(</span>IP_MF <span class="token operator">|</span> IP_OFFSET<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>The above code is a helper function used to check if the incoming IPv4 packet is an IP fragment. IP fragmentation is a mechanism where, if the size of an IP packet exceeds the Maximum Transmission Unit (MTU) of the network, routers split it into smaller fragments for transmission across the network. The purpose of this function is to examine the fragment flags and fragment offset fields within the packet to determine if it is a fragment.</p><p>Here&#x27;s an explanation of the code line by line:</p><ol><li><code>__u16 frag_off;</code>: Defines a 16-bit unsigned integer variable <code>frag_off</code> to store the fragment offset field.</li><li><code>bpf_skb_load_bytes(skb, nhoff + offsetof(struct iphdr, frag_off), &amp;frag_off, 2);</code>: This line of code uses the <code>bpf_skb_load_bytes</code> function to load the fragment offset field from the packet. <code>nhoff</code> is the offset of the IP header within the packet, and <code>offsetof(struct iphdr, frag_off)</code> calculates the offset of the fragment offset field within the IPv4 header.</li><li><code>frag_off = __bpf_ntohs(frag_off);</code>: Converts the loaded fragment offset field from network byte order (big-endian) to host byte order. Network protocols typically use big-endian to represent data, and the conversion to host byte order is done for further processing.</li><li><code>return frag_off &amp; (IP_MF | IP_OFFSET);</code>: This line of code checks the value of the fragment offset field using a bitwise AND operation with two flag values:<ul><li><code>IP_MF</code>: Represents the &quot;More Fragments&quot; flag. If this flag is set to 1, it indicates that the packet is part of a fragmented sequence and more fragments are expected.</li><li><code>IP_OFFSET</code>: Represents the fragment offset field. If the fragment offset field is non-zero, it indicates that the packet is part of a fragmented sequence and has a fragment offset value. If either of these flags is set to 1, the result is non-zero, indicating that the packet is an IP fragment. If both flags are 0, it means the packet is not fragmented.</li></ul></li></ol><p>It&#x27;s important to note that the fragment offset field in the IP header is specified in units of 8 bytes, so the actual byte offset is obtained by left-shifting the value by 3 bits. Additionally, the &quot;More Fragments&quot; flag (IP_MF) in the IP header indicates whether there are more fragments in the sequence and is typically used in conjunction with the fragment offset field to indicate the status of fragmented packets.</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> ETH_HLEN<span class="token punctuation">,</span> <span class="token operator">&amp;</span>
</span><span class="code-line">
</span><span class="code-line">hdr_len<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>hdr_len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">hdr_len <span class="token operator">&amp;=</span> <span class="token number">0x0f</span><span class="token punctuation">;</span>
</span><span class="code-line">hdr_len <span class="token operator">*=</span> <span class="token number">4</span><span class="token punctuation">;</span>
</span></code></pre></div><p>In this part of the code, the length of the IP header is loaded from the packet. The IP header length field contains information about the length of the IP header in units of 4 bytes, and it needs to be converted to bytes. Here, it is converted by performing a bitwise AND operation with 0x0f and then multiplying it by 4.</p><p>Key concept:</p><ul><li>IP Header: The IP header contains fundamental information about a packet, such as the source IP address, destination IP address, protocol type, total length, identification, flags, fragment offset, time to live (TTL), checksum, source port, and destination port.</li></ul><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span>hdr_len <span class="token operator">&lt;</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">iphdr</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>This code segment checks if the length of the IP header meets the minimum length requirement, typically 20 bytes. If the length of the IP header is less than 20 bytes, it indicates an incomplete or corrupted packet, and the function returns 0, indicating that the packet should not be processed.</p><p>Key concept:</p><ul><li><code>struct iphdr</code>: This is a structure defined in the Linux kernel, representing the format of an IPv4 header. It includes fields such as version, header length, service type, total length, identification, flags, fragment offset, time to live, protocol, header checksum, source IP address, and destination IP address, among others.</li></ul><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">iphdr</span><span class="token punctuation">,</span> protocol<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ip_proto<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span>ip_proto <span class="token operator">!=</span> IPPROTO_TCP<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>Here, the code loads the protocol field from the IP header to determine the transport layer protocol used in the packet. Then, it checks if the protocol field is not equal to the value for TCP (IPPROTO_TCP). If it&#x27;s not TCP, it means the packet is not an HTTP request or response, and the function returns 0.</p><p>Key concept:</p><ul><li>Transport Layer Protocol: The protocol field in the IP header indicates the transport layer protocol used in the packet, such as TCP, UDP, or ICMP.</li></ul><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line">tcp_hdr_len <span class="token operator">=</span> nhoff <span class="token operator">+</span> hdr_len<span class="token punctuation">;</span>
</span></code></pre></div><p>This line of code calculates the offset of the TCP header. It adds the length of the Ethernet frame header (<code>nhoff</code>) to the length of the IP header (<code>hdr_len</code>) to obtain the starting position of the TCP header.</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>verlen<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><p>This line of code loads the first byte of the TCP header from the packet, which contains information about the TCP header length. This length field is specified in units of 4 bytes and requires further conversion.</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">iphdr</span><span class="token punctuation">,</span> tot_len<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>tlen<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>tlen<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><p>This line of code loads the total length field of the IP header from the packet. The IP header&#x27;s total length field represents the overall length of the IP packet, including both the IP header and the data portion.</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line">__u8 doff<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> tcp_hdr_len <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">__tcphdr</span><span class="token punctuation">,</span> ack_seq<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>doff<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>doff<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">doff <span class="token operator">&amp;=</span> <span class="token number">0xf0</span><span class="token punctuation">;</span>
</span><span class="code-line">doff <span class="token operator">&gt;&gt;=</span> <span class="token number">4</span><span class="token punctuation">;</span>
</span><span class="code-line">doff <span class="token operator">*=</span> <span class="token number">4</span><span class="token punctuation">;</span>
</span></code></pre></div><p>This piece of code is used to calculate the length of the TCP header. It loads the Data Offset field (also known as the Header Length field) from the TCP header, which represents the length of the TCP header in units of 4 bytes. The code clears the high four bits of the offset field, then shifts it right by 4 bits, and finally multiplies it by 4 to obtain the actual length of the TCP header.</p><p>Key points to understand:</p><ul><li>TCP Header: The TCP header contains information related to the TCP protocol, such as source port, destination port, sequence number, acknowledgment number, flags (e.g., SYN, ACK, FIN), window size, and checksum.</li></ul><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line">payload_offset <span class="token operator">=</span> ETH_HLEN <span class="token operator">+</span> hdr_len <span class="token operator">+</span> doff<span class="token punctuation">;</span>
</span><span class="code-line">payload_length <span class="token operator">=</span> <span class="token function">__bpf_ntohs</span><span class="token punctuation">(</span>tlen<span class="token punctuation">)</span> <span class="token operator">-</span> hdr_len <span class="token operator">-</span> doff<span class="token punctuation">;</span>
</span></code></pre></div><p>These two lines of code calculate the offset and length of the HTTP request payload. They add the lengths of the Ethernet frame header, IP header, and TCP header together to obtain the offset to the data portion of the HTTP request. Then, by subtracting the total length, IP header length, and TCP header length from the total length field, they calculate the length of the HTTP request data.</p><p>Key point:</p><ul><li>HTTP Request Payload: The actual data portion included in an HTTP request, typically consisting of the HTTP request headers and request body.</li></ul><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token keyword">char</span> line_buffer<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span>payload_length <span class="token operator">&lt;</span> <span class="token number">7</span> <span class="token operator">||</span> payload_offset <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> payload_offset<span class="token punctuation">,</span> line_buffer<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token function">bpf_printk</span><span class="token punctuation">(</span><span class="token string">&quot;%d len %d buffer: %s&quot;</span><span class="token punctuation">,</span> payload_offset<span class="token punctuation">,</span> payload_length<span class="token punctuation">,</span> line_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><p>This portion of the code loads the first 7 bytes of the HTTP request line and stores them in a character array named <code>line_buffer</code>. It then checks if the length of the HTTP request data is less than 7 bytes or if the offset is negative. If these conditions are met, it indicates an incomplete HTTP request, and the function returns 0. Finally, it uses the <code>bpf_printk</code> function to print the content of the HTTP request line to the kernel log for debugging and analysis.</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">bpf_strncmp</span><span class="token punctuation">(</span>line_buffer<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
</span><span class="code-line">    <span class="token function">bpf_strncmp</span><span class="token punctuation">(</span>line_buffer<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
</span><span class="code-line">    <span class="token function">bpf_strncmp</span><span class="token punctuation">(</span>line_buffer<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;PUT&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
</span><span class="code-line">    <span class="token function">bpf_strncmp</span><span class="token punctuation">(</span>line_buffer<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">&quot;DELETE&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
</span><span class="code-line">    <span class="token function">bpf_strncmp</span><span class="token punctuation">(</span>line_buffer<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;HTTP&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><p>This piece of code uses the <code>bpf_strncmp</code> function to compare the data in <code>line_buffer</code> with HTTP request methods (GET, POST, PUT, DELETE, HTTP). If there is no match, indicating that it is not an HTTP request, it returns 0, indicating that it should not be processed.</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line">e <span class="token operator">=</span> <span class="token function">bpf_ringbuf_reserve</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rb<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span></code></pre></div><p>This section of the code attempts to reserve a block of memory from the BPF ring buffer to store event information. If it cannot reserve the memory block, it returns 0. The BPF ring buffer is used to pass event data between the eBPF program and user space.</p><p>Key point:</p><ul><li>BPF Ring Buffer: The BPF ring buffer is a mechanism for passing data between eBPF programs and user space. It can be used to store event information for further processing or analysis by user space applications.</li></ul><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line">e<span class="token operator">-&gt;</span>ip_proto <span class="token operator">=</span> ip_proto<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> hdr_len<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>e<span class="token operator">-&gt;</span>ports<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">e<span class="token operator">-&gt;</span>pkt_type <span class="token operator">=</span> skb<span class="token operator">-&gt;</span>pkt_type<span class="token punctuation">;</span>
</span><span class="code-line">e<span class="token operator">-&gt;</span>ifindex <span class="token operator">=</span> skb<span class="token operator">-&gt;</span>ifindex<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">e<span class="token operator">-&gt;</span>payload_length <span class="token operator">=</span> payload_length<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> payload_offset<span class="token punctuation">,</span> e<span class="token operator">-&gt;</span>payload<span class="token punctuation">,</span> MAX_BUF_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">iphdr</span><span class="token punctuation">,</span> saddr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>e<span class="token operator">-&gt;</span>src_addr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token function">bpf_skb_load_bytes</span><span class="token punctuation">(</span>skb<span class="token punctuation">,</span> nhoff <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">iphdr</span><span class="token punctuation">,</span> daddr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>e<span class="token operator">-&gt;</span>dst_addr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token function">bpf_ringbuf_submit</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">return</span> skb<span class="token operator">-&gt;</span>len<span class="token punctuation">;</span>
</span></code></pre></div><p>Finally, this code segment stores the captured event information in the <code>e</code> structure and submits it to the BPF ring buffer. It includes information such as the captured IP protocol, source and destination ports, packet type, interface index, payload length, source IP address, and destination IP address. Finally, it returns the length of the packet, indicating that the packet was successfully processed.</p><p>This code is primarily used to store captured event information for further processing. The BPF ring buffer is used to pass this information to user space for additional handling or logging.</p><p>In summary, this eBPF program&#x27;s main task is to capture HTTP requests. It accomplishes this by parsing the Ethernet frame, IP header, and TCP header of incoming packets to determine if they contain HTTP requests. Information about the requests is then stored in the <code>so_event</code> structure and submitted to the BPF ring buffer. This is an efficient method for capturing HTTP traffic at the kernel level and is suitable for applications such as network monitoring and security analysis.</p><h3 class="content-header" id="potential-limitations"><a class="break-words" href="#potential-limitations" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Potential Limitations</h3><p>The above code has some potential limitations, and one of the main limitations is that it cannot handle URLs that span multiple packets.</p><ul><li>Cross-Packet URLs: The code checks the URL in an HTTP request by parsing a single data packet. If the URL of an HTTP request spans multiple packets, it will only examine the URL in the first packet. This can lead to missing or partially capturing long URLs that span multiple data packets.</li></ul><p>To address this issue, a solution often involves reassembling multiple packets to reconstruct the complete HTTP request. This may require implementing packet caching and assembly logic within the eBPF program and waiting to collect all relevant packets until the HTTP request is detected. This adds complexity and may require additional memory to handle cases where URLs span multiple packets.</p><h3 class="content-header" id="user-space-code"><a class="break-words" href="#user-space-code" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>User-Space Code</h3><p>The user-space code&#x27;s main purpose is to create a raw socket and then attach the previously defined eBPF program in the kernel to that socket, allowing the eBPF program to capture and process network packets received on that socket. Here&#x27;s an example of the user-space code:</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token comment">/* Create raw socket for localhost interface */</span>
</span><span class="code-line">sock <span class="token operator">=</span> <span class="token function">open_raw_sock</span><span class="token punctuation">(</span>interface<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span>sock <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    err <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;Failed to open raw socket\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">goto</span> cleanup<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">/* Attach BPF program to raw socket */</span>
</span><span class="code-line">prog_fd <span class="token operator">=</span> <span class="token function">bpf_program__fd</span><span class="token punctuation">(</span>skel<span class="token operator">-&gt;</span>progs<span class="token punctuation">.</span>socket_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">setsockopt</span><span class="token punctuation">(</span>sock<span class="token punctuation">,</span> SOL_SOCKET<span class="token punctuation">,</span> SO_ATTACH_BPF<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prog_fd<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>prog_fd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    err <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">&quot;Failed to attach to raw socket\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">goto</span> cleanup<span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre></div><ol><li><code>sock = open_raw_sock(interface);</code>: This line of code calls a custom function <code>open_raw_sock</code>, which is used to create a raw socket. Raw sockets allow a user-space application to handle network packets directly without going through the protocol stack. The <code>interface</code> parameter might specify the network interface from which to receive packets, determining where to capture packets from. If creating the socket fails, it returns a negative value, otherwise, it returns the file descriptor of the socket <code>sock</code>.</li><li>If the value of <code>sock</code> is less than 0, indicating a failure to open the raw socket, it sets <code>err</code> to -2 and prints an error message on the standard error stream.</li><li><code>prog_fd = bpf_program__fd(skel-&gt;progs.socket_handler);</code>: This line of code retrieves the file descriptor of the socket filter program (<code>socket_handler</code>) previously defined in the eBPF program. It is necessary to attach this program to the socket. <code>skel</code> is a pointer to an eBPF program object, and it provides access to the program collection.</li><li><code>setsockopt(sock, SOL_SOCKET, SO_ATTACH_BPF, &amp;prog_fd, sizeof(prog_fd))</code>: This line of code uses the <code>setsockopt</code> system call to attach the eBPF program to the raw socket. It sets the <code>SO_ATTACH_BPF</code> option and passes the file descriptor of the eBPF program to the option, letting the kernel know which eBPF program to apply to this socket. If the attachment is successful, the socket starts capturing and processing network packets received on it.</li><li>If <code>setsockopt</code> fails, it sets <code>err</code> to -3 and prints an error message on the standard error stream.</li></ol><h3 class="content-header" id="compilation-and-execution"><a class="break-words" href="#compilation-and-execution" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Compilation and Execution</h3><p>The complete source code can be found at <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/eunomia-bpf/bpf-developer-tutorial/tree/main/src/23-http">https://github.com/eunomia-bpf/bpf-developer-tutorial/tree/main/src/23-http</a>. To compile and run the code:</p><div class="relative"><pre><code class="code-highlight language-console"><span class="code-line">$ git submodule update --init --recursive
</span><span class="code-line">$ make
</span><span class="code-line">  BPF      .output/sockfilter.bpf.o
</span><span class="code-line">  GEN-SKEL .output/sockfilter.skel.h
</span><span class="code-line">  CC       .output/sockfilter.o
</span><span class="code-line">  BINARY   sockfilter
</span><span class="code-line">$ sudo ./sockfilter 
</span><span class="code-line">...
</span></code></pre></div><p>In another terminal, start a simple web server using Python:</p><div class="relative"><pre><code class="code-highlight language-console"><span class="code-line">python3 -m http.server
</span><span class="code-line">Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
</span><span class="code-line">127.0.0.1 - - [18/Sep/2023 01:05:52] &quot;GET / HTTP/1.1&quot; 200 -
</span></code></pre></div><p>You can use <code>curl</code> to make requests:</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line">$ curl http<span class="token operator">:</span><span class="token comment">//0.0.0.0:8000/</span>
</span><span class="code-line"><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE HTML<span class="token operator">&gt;</span>
</span><span class="code-line"><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
</span><span class="code-line"><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
</span><span class="code-line"><span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token operator">&gt;</span>
</span><span class="code-line"><span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Directory listing <span class="token keyword">for</span> <span class="token operator">/</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
</span><span class="code-line"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</span></code></pre></div><p>In the eBPF program, you can see that it prints the content of HTTP requests:</p><div class="relative"><pre><code class="code-highlight language-console"><span class="code-line">127.0.0.1:34552(src) -&gt; 127.0.0.1:8000(dst)
</span><span class="code-line">payload: GET / HTTP/1.1
</span><span class="code-line">Host: 0.0.0.0:8000
</span><span class="code-line">User-Agent: curl/7.88.1
</span><span class="code-line">...
</span><span class="code-line">127.0.0.1:8000(src) -&gt; 127.0.0.1:34552(dst)
</span><span class="code-line">payload: HTTP/1.0 200 OK
</span><span class="code-line">Server: SimpleHTTP/0.6 Python/3.11.4
</span><span class="code-line">...
</span></code></pre></div><p>It captures both request and response content.</p><h2 class="content-header" id="capturing-http-traffic-using-ebpf-syscall-tracepoints"><a class="break-words" href="#capturing-http-traffic-using-ebpf-syscall-tracepoints" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Capturing HTTP Traffic Using eBPF Syscall Tracepoints</h2><p>eBPF provides a powerful mechanism for tracing system calls at the kernel level. In this example, we&#x27;ll use eBPF to trace the <code>accept</code> and <code>read</code> system calls to capture HTTP traffic. Due to space limitations, we&#x27;ll provide a brief overview of the code framework.</p><div class="relative"><pre><code class="language-c code-highlight"><span class="code-line"><span class="token keyword">struct</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">__uint</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> BPF_MAP_TYPE_HASH<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">__uint</span><span class="token punctuation">(</span>max_entries<span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">__type</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> u64<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">__type</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">accept_args_t</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span> active_accept_args_map <span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;.maps&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Define a tracepoint at the entry of the accept system call</span>
</span><span class="code-line"><span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;tracepoint/syscalls/sys_enter_accept&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">int</span> <span class="token function">sys_enter_accept</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">trace_event_raw_sys_enter</span> <span class="token operator">*</span>ctx<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    u64 id <span class="token operator">=</span> <span class="token function">bpf_get_current_pid_tgid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment">// ... Get and store the arguments of the accept call</span>
</span><span class="code-line">    <span class="token function">bpf_map_update_elem</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>active_accept_args_map<span class="token punctuation">,</span> <span class="token operator">&amp;</span>id<span class="token punctuation">,</span> <span class="token operator">&amp;</span>accept_args<span class="token punctuation">,</span> BPF_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Define a tracepoint at the exit of the accept system call</span>
</span><span class="code-line"><span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;tracepoint/syscalls/sys_exit_accept&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">int</span> <span class="token function">sys_exit_accept</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">trace_event_raw_sys_exit</span> <span class="token operator">*</span>ctx<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// ... Process the result of the accept call</span>
</span><span class="code-line">    <span class="token keyword">struct</span> <span class="token class-name">accept_args_t</span> <span class="token operator">*</span>args <span class="token operator">=</span>
</span><span class="code-line">        <span class="token function">bpf_map_lookup_elem</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>active_accept_args_map<span class="token punctuation">,</span> <span class="token operator">&amp;</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment">// ... Get and store the socket file descriptor obtained from the accept call</span>
</span><span class="code-line">    __u64 pid_fd <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>__u64<span class="token punctuation">)</span>pid <span class="token operator">&lt;&lt;</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>u32<span class="token punctuation">)</span>ret_fd<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">bpf_map_update_elem</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>conn_info_map<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pid_fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>conn_info<span class="token punctuation">,</span> BPF_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment">// ...</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">struct</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">__uint</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> BPF_MAP_TYPE_HASH<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">__uint</span><span class="token punctuation">(</span>max_entries<span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">__type</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> u64<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token function">__type</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">data_args_t</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span> active_read_args_map <span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;.maps&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Define a tracepoint at the entry of the read system call</span>
</span><span class="code-line"><span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;tracepoint/syscalls/sys_enter_read&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">int</span> <span class="token function">sys_enter_read</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">trace_event_raw_sys_enter</span> <span class="token operator">*</span>ctx<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// ... Get and store the arguments of the read call</span>
</span><span class="code-line">    <span class="token function">bpf_map_update_elem</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>active_read_args_map<span class="token punctuation">,</span> <span class="token operator">&amp;</span>id<span class="token punctuation">,</span> <span class="token operator">&amp;</span>read_args<span class="token punctuation">,</span> BPF_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Helper function to check if it&#x27;s an HTTP connection</span>
</span><span class="code-line"><span class="token keyword">static</span> <span class="token keyword">inline</span> bool <span class="token function">is_http_connection</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>line_buffer<span class="token punctuation">,</span> u64 bytes_count<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// ... Check if the data is an HTTP request or response</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Helper function to process the read data</span>
</span><span class="code-line"><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">process_data</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">trace_event_raw_sys_exit</span> <span class="token operator">*</span>ctx<span class="token punctuation">,</span>
</span><span class="code-line">                                u64 id<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">data_args_t</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> u64 bytes_count<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// ... Process the read data, check if it&#x27;s HTTP traffic, and send events</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_http_connection</span><span class="token punctuation">(</span>line_buffer<span class="token punctuation">,</span> bytes_count<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token comment">// ...</span>
</span><span class="code-line">        <span class="token function">bpf_probe_read_kernel</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>event<span class="token punctuation">.</span>msg<span class="token punctuation">,</span> read_size<span class="token punctuation">,</span> args<span class="token operator">-&gt;</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token comment">// ...</span>
</span><span class="code-line">        <span class="token function">bpf_perf_event_output</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>events<span class="token punctuation">,</span> BPF_F_CURRENT_CPU<span class="token punctuation">,</span>
</span><span class="code-line">                              <span class="token operator">&amp;</span>event<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">socket_data_event_t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// Define a tracepoint at the exit of the read system call</span>
</span><span class="code-line"><span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;tracepoint/syscalls/sys_exit_read&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">int</span> <span class="token function">sys_exit_read</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">trace_event_raw_sys_exit</span> <span class="token operator">*</span>ctx<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// ... Process the result of the read call</span>
</span><span class="code-line">    <span class="token keyword">struct</span> <span class="token class-name">data_args_t</span> <span class="token operator">*</span>read_args <span class="token operator">=</span> <span class="token function">bpf_map_lookup_elem</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>active_read_args_map<span class="token punctuation">,</span> <span class="token operator">&amp;</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>read_args <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token function">process_data</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> id<span class="token punctuation">,</span> read_args<span class="token punctuation">,</span> bytes_count<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token comment">// ...</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">char</span> _license<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">SEC</span><span class="token punctuation">(</span><span class="token string">&quot;license&quot;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">&quot;GPL&quot;</span><span class="token punctuation">;</span>
</span></code></pre></div><p>This code briefly demonstrates how to use eBPF to trace system calls in the Linux kernel to capture HTTP traffic. Here&#x27;s a detailed explanation of the hook locations and the flow, as well as the complete set of system calls that need to be hooked for comprehensive request tracing:</p><h3 class="content-header" id="hook-locations-and-flow"><a class="break-words" href="#hook-locations-and-flow" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Hook Locations and Flow</h3><ul><li><p>The code uses eBPF Tracepoint functionality. Specifically, it defines a series of eBPF programs and binds them to specific system call Tracepoints to capture entry and exit events of these system calls.</p></li><li><p>First, it defines two eBPF hash maps (<code>active_accept_args_map</code> and <code>active_read_args_map</code>) to store system call parameters. These maps are used to track <code>accept</code> and <code>read</code> system calls.</p></li><li><p>Next, it defines multiple Tracepoint tracing programs, including:</p><ul><li><code>sys_enter_accept</code>: Defined at the entry of the <code>accept</code> system call, used to capture the arguments of the <code>accept</code> system call and store them in the hash map.</li><li><code>sys_exit_accept</code>: Defined at the exit of the <code>accept</code> system call, used to process the result of the <code>accept</code> system call, including obtaining and storing the new socket file descriptor and related connection information.</li><li><code>sys_enter_read</code>: Defined at the entry of the <code>read</code> system call, used to capture the arguments of the <code>read</code> system call and store them in the hash map.</li><li><code>sys_exit_read</code>: Defined at the exit of the <code>read</code> system call, used to process the result of the <code>read</code> system call, including checking if the read data is HTTP traffic and sending events.</li></ul></li><li><p>In <code>sys_exit_accept</code> and <code>sys_exit_read</code>, there is also some data processing and event sending logic, such as checking if the data is an HTTP connection, assembling event data, and using <code>bpf_perf_event_output</code> to send events to user space for further processing.</p></li></ul><h3 class="content-header" id="complete-set-of-system-calls-to-hook"><a class="break-words" href="#complete-set-of-system-calls-to-hook" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Complete Set of System Calls to Hook</h3><p>To fully implement HTTP request tracing, the system calls that typically need to be hooked include:</p><ul><li><code>socket</code>: Used to capture socket creation for tracking new connections.</li><li><code>bind</code>: Used to obtain port information where the socket is bound.</li><li><code>listen</code>: Used to start listening for connection requests.</li><li><code>accept</code>: Used to accept connection requests and obtain new socket file descriptors.</li><li><code>read</code>: Used to capture received data and check if it contains HTTP requests.</li><li><code>write</code>: Used to capture sent data and check if it contains HTTP responses.</li></ul><p>The provided code already covers the tracing of <code>accept</code> and <code>read</code> system calls. To complete HTTP request tracing, additional system calls need to be hooked, and corresponding logic needs to be implemented to handle the parameters and results of these system calls.</p><p>The complete source code can be found at <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/eunomia-bpf/bpf-developer-tutorial/tree/main/src/23-http">https://github.com/eunomia-bpf/bpf-developer-tutorial/tree/main/src/23-http</a>.</p><h2 class="content-header" id="summary"><a class="break-words" href="#summary" aria-hidden="true" tabindex="-1"><span class="content-header-link"><svg class="h-5 linkicon w-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"></path><path d="M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"></path></svg></span></a>Summary</h2><p>In today&#x27;s complex technological landscape, system observability has become crucial, especially in the context of microservices and cloud-native applications. This article explores how to leverage eBPF technology for tracing the seven-layer protocols, along with the challenges and solutions that may arise in this process. Here&#x27;s a summary of the content covered in this article:</p><ol><li><p><strong>Introduction</strong>:</p><ul><li>Modern applications often consist of multiple microservices and distributed components, making it essential to observe the behavior of the entire system.</li><li>Seven-layer protocols (such as HTTP, gRPC, MQTT, etc.) provide detailed insights into application interactions, but monitoring these protocols can be challenging.</li></ul></li><li><p><strong>Role of eBPF Technology</strong>:</p><ul><li>eBPF allows developers to dive deep into the kernel layer for real-time observation and analysis of system behavior without modifying or inserting application code.</li><li>eBPF technology offers a powerful tool for monitoring seven-layer protocols, especially in a microservices environment.</li></ul></li><li><p><strong>Tracing Seven-Layer Protocols</strong>:</p><ul><li>The article discusses the challenges of tracing seven-layer protocols, including their complexity and dynamism.</li><li>Traditional network monitoring tools struggle with the complexity of seven-layer protocols.</li></ul></li><li><p><strong>Applications of eBPF</strong>:</p><ul><li>eBPF provides two primary methods for tracing seven-layer protocols: socket filters and syscall tracing.</li><li>Both of these methods help capture network request data for protocols like HTTP and analyze them.</li></ul></li><li><p><strong>eBPF Practical Tutorial</strong>:</p><ul><li>The article provides a practical eBPF tutorial demonstrating how to capture and analyze HTTP traffic using eBPF socket filters or syscall tracing.</li><li>The tutorial covers the development of eBPF programs, the use of the eBPF toolchain, and the implementation of HTTP request tracing.</li></ul></li></ol><p>Through this article, readers can gain a deep understanding of how to use eBPF technology for tracing seven-layer protocols, particularly HTTP traffic. This knowledge will help enhance the monitoring and analysis of network traffic, thereby improving application performance and security. If you&#x27;re interested in learning more about eBPF and its practical applications, you can visit our tutorial code repository at <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://github.com/eunomia-bpf/bpf-developer-tutorial">https://github.com/eunomia-bpf/bpf-developer-tutorial</a> or our website at <a class="break-words" target="_blank" rel="noopener noreferrer" href="https://eunomia.dev/tutorials/">https://eunomia.dev/tutorials/</a> for more examples and complete tutorials.</p></div><div class="pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300 glass p-4 rounded-xl"><a class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors" target="_blank" rel="nofollow" href="https://mobile.twitter.com/search?q=https%3A%2F%2Fwww.yunwei37.com%2Fblog%2FL7%20Tracing%20with%20eBPF">Discuss on Twitter</a> • <a class="hover:text-primary-600 dark:hover:text-primary-400 transition-colors" target="_blank" rel="noopener noreferrer" href="https://github.com/yunwei37/my-new-blog/blob/main/data/blog/L7 Tracing with eBPF.mdx">View on GitHub</a></div><div class="pt-6 pb-6 text-center text-gray-700 dark:text-gray-300 glass p-6 rounded-xl" id="comment"><button>Load Comments</button></div></div><footer><div class="divide-gray-200/30 text-sm leading-5 font-medium xl:col-start-1 xl:row-start-2 xl:divide-y dark:divide-gray-700/30"><div class="py-4 xl:py-8"><h2 class="text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-4">Tags</h2><div class="flex flex-wrap gap-2"><a class="inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50" href="/tags/notes">notes</a><a class="inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50" href="/tags/gpt">gpt</a><a class="inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50" href="/tags/ai">ai</a></div></div><div class="flex justify-between py-4 xl:block xl:space-y-6 xl:py-8"><div class="glass p-4 rounded-xl"><h2 class="text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-2">Previous Article</h2><div class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors"><a class="break-words" href="/blog/gpt-best-practice">OpenAI 新发布GPT 最佳实践：落地大模型应用的策略和战术</a></div></div><div class="glass p-4 rounded-xl"><h2 class="text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-2">Next Article</h2><div class="text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors"><a class="break-words" href="/blog/ebpf-app-store">eBPF 软件应用市场设计方案</a></div></div></div></div><div class="pt-4 xl:pt-8"><a class="inline-flex items-center glass px-4 py-2 rounded-xl text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-all duration-200 hover:scale-105" aria-label="Back to the blog" href="/blog">← Back to the blog</a></div></footer></div></div></article></section><!--$--><!--/$--></main><footer class="border-t border-gray-200/30 dark:border-gray-700/30 pt-8"><div class="flex flex-col items-center space-y-6"><div class="flex flex-wrap justify-center gap-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:yunwei356@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Mail</title><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/yunwei37"><span class="sr-only">github</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://facebook.com"><span class="sr-only">facebook</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Facebook</title><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://youtube.com"><span class="sr-only">youtube</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Youtube</title><path d="M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/yusheng-zheng-611920280"><span class="sr-only">linkedin</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Linkedin</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://bsky.app/"><span class="sr-only">bluesky</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Bluesky</title><path d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565C.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479c.815 2.736 3.713 3.66 6.383 3.364q.204-.03.415-.056q-.207.033-.415.056c-3.912.58-7.387 2.005-2.83 7.078c5.013 5.19 6.87-1.113 7.823-4.308c.953 3.195 2.05 9.271 7.733 4.308c4.267-4.308 1.172-6.498-2.74-7.078a9 9 0 0 1-.415-.056q.21.026.415.056c2.67.297 5.568-.628 6.383-3.364c.246-.828.624-5.79.624-6.478c0-.69-.139-1.861-.902-2.206c-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://x.com/yunwei37"><span class="sr-only">x</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>X</title><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.instagram.com"><span class="sr-only">instagram</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Instagram</title><path d="M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.threads.net"><span class="sr-only">threads</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Threads</title><path d="M12.186 24h-.007c-3.581-.024-6.334-1.205-8.184-3.509C2.35 18.44 1.5 15.586 1.472 12.01v-.017c.03-3.579.879-6.43 2.525-8.482C5.845 1.205 8.6.024 12.18 0h.014c2.746.02 5.043.725 6.826 2.098 1.677 1.29 2.858 3.13 3.509 5.467l-2.04.569c-1.104-3.96-3.898-5.984-8.304-6.015-2.91.022-5.11.936-6.54 2.717C4.307 6.504 3.616 8.914 3.589 12c.027 3.086.718 5.496 2.057 7.164 1.43 1.783 3.631 2.698 6.54 2.717 2.623-.02 4.358-.631 5.8-2.045 1.647-1.613 1.618-3.593 1.09-4.798-.31-.71-.873-1.3-1.634-1.75-.192 1.352-.622 2.446-1.284 3.272-.886 1.102-2.14 1.704-3.73 1.79-1.202.065-2.361-.218-3.259-.801-1.063-.689-1.685-1.74-1.752-2.964-.065-1.19.408-2.285 1.33-3.082.88-.76 2.119-1.207 3.583-1.291a13.853 13.853 0 0 1 3.02.142c-.126-.742-.375-1.332-.75-1.757-.513-.586-1.308-.883-2.359-.89h-.029c-.844 0-1.992.232-2.721 1.32L7.734 7.847c.98-1.454 2.568-2.256 4.478-2.256h.044c3.194.02 5.097 1.975 5.287 5.388.108.046.216.094.321.142 1.49.7 2.58 1.761 3.154 3.07.797 1.82.871 4.79-1.548 7.158-1.85 1.81-4.094 2.628-7.277 2.65Zm1.003-11.69c-.242 0-.487.007-.739.021-1.836.103-2.98.946-2.916 2.143.067 1.256 1.452 1.839 2.784 1.767 1.224-.065 2.818-.543 3.086-3.71a10.5 10.5 0 0 0-2.215-.221z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://medium.com"><span class="sr-only">medium</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6"><title>Medium</title><path d="M13.54 12a6.8 6.8 0 01-6.77 6.82A6.8 6.8 0 010 12a6.8 6.8 0 016.77-6.82A6.8 6.8 0 0113.54 12zM20.96 12c0 3.54-1.51 6.42-3.38 6.42-1.87 0-3.39-2.88-3.39-6.42s1.52-6.42 3.39-6.42 3.38 2.88 3.38 6.42M24 12c0 3.17-.53 5.75-1.19 5.75-.66 0-1.19-2.58-1.19-5.75s.53-5.75 1.19-5.75C23.47 6.25 24 8.83 24 12z"></path></svg></a></div><div class="flex space-x-2 text-sm opacity-80"><div>Yusheng Zheng</div><div> • </div><div>© 2025</div><div> • </div><a class="hover:text-primary-500 transition-colors" href="/">云微的胡思乱想</a></div><div class="text-sm opacity-60"><a class="hover:text-primary-500 transition-colors" target="_blank" rel="noopener noreferrer" href="https://github.com/timlrx/tailwind-nextjs-starter-blog">Tailwind Nextjs Theme</a></div></div></footer></div></div><script src="/_next/static/chunks/webpack-b4f750df33af4b53.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[1478,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5c537ecaa5d1cd34.js\",\"177\",\"static/chunks/app/layout-1a2cfbd13c591174.js\"],\"ThemeProviders\"]\n3:I[4091,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5c537ecaa5d1cd34.js\",\"177\",\"static/chunks/app/layout-1a2cfbd13c591174.js\"],\"default\"]\n4:I[9243,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5c537ecaa5d1cd34.js\",\"177\",\"static/chunks/app/layout-1a2cfbd13c591174.js\"],\"\"]\n5:I[7392,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5c537ecaa5d1cd34.js\",\"177\",\"static/chunks/app/layout-1a2cfbd13c591174.js\"],\"KBarSearchProvider\"]\n6:I[6874,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-71c7cfee63112339.js\"],\"\"]\ne:I[8393,[],\"\"]\n:HL[\"/_next/static/media/36966cca54120369-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/a06d7e24bf9a7d93.css\",\"style\"]\n:HL[\"/_next/static/css/54f53e18fb3a4e82.css\",\"style\"]\n:HL[\"/_next/static/css/7246298b30c42979.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"ER0GCm_u0u-RRwl37uz71\",\"p\":\"\",\"c\":[\"\",\"blog\",\"L7%20Tracing%20with%20eBPF\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"L7%20Tracing%20with%20eBPF\",\"c\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/a06d7e24bf9a7d93.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/54f53e18fb3a4e82.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en-us\",\"className\":\"__variable_dd5b2f scroll-smooth\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"76x76\",\"href\":\"/static/favicons/apple-touch-icon.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/svg+xml\",\"href\":\"/static/favicons/favicon.svg\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/static/favicons/favicon-32x32.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/static/favicons/favicon-16x16.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/static/favicons/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/static/favicons/safari-pinned-tab.svg\",\"color\":\"#5bbad5\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fff\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}],[\"$\",\"body\",null,{\"className\":\"pl-[calc(100vw-100%)] text-black antialiased dark:text-white min-h-screen\",\"children\":[\"$\",\"$L2\",null,{\"children\":[[\"$\",\"$L3\",null,{}],[\"$undefined\",\"$undefined\",\"$undefined\",[\"$\",\"$L4\",null,{\"async\":true,\"defer\":true,\"src\":\"https://analytics.umami.is/script.js\"}],\"$undefined\",\"$undefined\"],[\"$\",\"div\",null,{\"className\":\"min-h-screen flex flex-col justify-center py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"content-glass mx-auto w-full max-w-5xl px-4 sm:px-6 xl:px-8 py-8\",\"children\":[\"$\",\"$L5\",null,{\"kbarConfig\":{\"searchDocumentsPath\":\"/search.json\"},\"children\":[[\"$\",\"header\",null,{\"className\":\"flex items-center w-full justify-between py-6 border-b border-gray-200/30 dark:border-gray-700/30\",\"children\":[[\"$\",\"$L6\",null,{\"className\":\"break-words\",\"href\":\"/\",\"aria-label\":\"yunwei37\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-center\",\"children\":[[\"$\",\"div\",null,{\"className\":\"mr-3\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":40,\"height\":40,\"fill\":\"none\",\"children\":[[\"$\",\"defs\",null,{\"children\":[[\"$\",\"linearGradient\",null,{\"id\":\"logo_svg__a\",\"x1\":\"0%\",\"x2\":\"100%\",\"y1\":\"0%\",\"y2\":\"100%\",\"children\":[[\"$\",\"stop\",null,{\"offset\":\"0%\",\"style\":{\"stopColor\":\"#3b82f6\",\"stopOpacity\":1}}],[\"$\",\"stop\",null,{\"offset\":\"100%\",\"style\":{\"stopColor\":\"#06b6d4\",\"stopOpacity\":1}}]]}],[\"$\",\"linearGradient\",null,{\"id\":\"logo_svg__b\",\"x1\":\"0%\",\"x2\":\"100%\",\"y1\":\"0%\",\"y2\":\"100%\",\"children\":[[\"$\",\"stop\",null,{\"offset\":\"0%\",\"style\":{\"stopColor\":\"#8b5cf6\",\"stopOpacity\":1}}],[\"$\",\"stop\",null,{\"offset\":\"100%\",\"style\":{\"stopColor\":\"#3b82f6\",\"stopOpacity\":1}}]]}]]}],[\"$\",\"circle\",null,{\"cx\":20,\"cy\":20,\"r\":18,\"fill\":\"url(#logo_svg__a)\",\"opacity\":0.1}],[\"$\",\"path\",null,{\"fill\":\"url(#logo_svg__a)\",\"d\":\"m12 8 6 10v10h4V18l6-10h-4l-4 6-4-6Z\"}],[\"$\",\"path\",null,{\"fill\":\"url(#logo_svg__b)\",\"d\":\"m8 24 4 8 4-8 4 8 4-8h8v4h-6l-4 8-4-8-4 8-4-8H8Z\",\"opacity\":0.8}],[\"$\",\"circle\",null,{\"cx\":32,\"cy\":12,\"r\":2,\"fill\":\"url(#logo_svg__b)\"}],[\"$\",\"circle\",null,{\"cx\":8,\"cy\":12,\"r\":1.5,\"fill\":\"url(#logo_svg__a)\",\"opacity\":0.6}]]}]}],[\"$\",\"div\",null,{\"className\":\"hidden text-2xl font-bold sm:block hover:text-primary-600 dark:hover:text-primary-400 transition-colors\",\"children\":\"yunwei37\"}]]}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-4\",\"children\":[[\"$\",\"div\",null,{\"className\":\"no-scrollbar hidden items-center space-x-2 sm:flex\",\"children\":[[\"$\",\"$L6\",\"Blog\",{\"className\":\"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400\",\"href\":\"/blog\",\"children\":\"Blog\"}],[\"$\",\"$L6\",\"Docs\",{\"className\":\"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400\",\"href\":\"/docs\",\"children\":\"Docs\"}],[\"$\",\"$L6\",\"Tags\",{\"className\":\"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400\",\"href\":\"/tags\",\"children\":\"Tags\"}],[\"$\",\"$L6\",\"About\",{\"className\":\"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400\",\"href\":\"/about\",\"children\":\"About\"}]]}],\"$L7\"]}]]}],\"$L8\",\"$L9\"]}]}]}]]}]}]]}]]}],{\"children\":[\"blog\",\"$La\",{\"children\":[[\"slug\",\"L7%20Tracing%20with%20eBPF\",\"c\"],\"$Lb\",{\"children\":[\"__PAGE__\",\"$Lc\",{},null,false]},null,false]},null,false]},null,false],\"$Ld\",false]],\"m\":\"$undefined\",\"G\":[\"$e\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"f:I[4159,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5c537ecaa5d1cd34.js\",\"177\",\"static/chunks/app/layout-1a2cfbd13c591174.js\"],\"KBarButton\"]\n10:I[1762,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5c537ecaa5d1cd34.js\",\"177\",\"static/chunks/app/layout-1a2cfbd13c591174.js\"],\"default\"]\n11:I[7298,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"650\",\"static/chunks/650-5c537ecaa5d1cd34.js\",\"177\",\"static/chunks/app/layout-1a2cfbd13c591174.js\"],\"default\"]\n12:I[7555,[],\"\"]\n13:I[1295,[],\"\"]\n1e:I[9665,[],\"OutletBoundary\"]\n20:I[4911,[],\"AsyncMetadataOutlet\"]\n22:I[9665,[],\"ViewportBoundary\"]\n24:I[9665,[],\"MetadataBoundary\"]\n25:\"$Sreact.suspense\"\n7:[\"$\",\"div\",null,{\"className\":\"flex items-center space-x-2\",\"children\":[[\"$\",\"$Lf\",null,{\"aria-label\":\"Search\",\"className\":\"p-2 rounded-lg transition-all duration-200\",\"children\":[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"fill\":\"none\",\"viewBox\":\"0 0 24 24\",\"strokeWidth\":1.5,\"stroke\":\"currentColor\",\"className\":\"h-6 w-6 hover:text-primary-600 dark:hover:text-primary-400 transition-colors\",\"children\":[\"$\",\"path\",null,{\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"d\":\"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z\"}]}]}],[\"$\",\"$L10\",null,{}],[\"$\",\"$L11\",null,{}]]}]\n"])</script><script>self.__next_f.push([1,"8:[\"$\",\"main\",null,{\"className\":\"py-6\",\"children\":[\"$\",\"$L12\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L13\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"div\",null,{\"className\":\"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-x-2 pt-6 pb-8 md:space-y-5\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-6xl leading-9 font-extrabold tracking-tight md:border-r-2 md:px-6 md:text-8xl md:leading-14\",\"children\":\"404\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-md\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-xl leading-normal font-bold md:text-2xl\",\"children\":\"Sorry we couldn't find this page.\"}],[\"$\",\"p\",null,{\"className\":\"mb-8\",\"children\":\"But dont worry, you can find plenty of other things on our homepage.\"}],[\"$\",\"$L6\",null,{\"className\":\"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm leading-5 font-medium text-white shadow-xs transition-colors duration-150 hover:bg-blue-700 focus:outline-hidden dark:hover:bg-blue-500\",\"href\":\"/\",\"children\":\"Back to homepage\"}]]}]]}],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]\n"])</script><script>self.__next_f.push([1,"9:[\"$\",\"footer\",null,{\"className\":\"border-t border-gray-200/30 dark:border-gray-700/30 pt-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-center space-y-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex flex-wrap justify-center gap-4\",\"children\":[[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"mailto:yunwei356@gmail.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"mail\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 20 20\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Mail\"}],[\"$\",\"path\",null,{\"d\":\"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z\"}],[\"$\",\"path\",null,{\"d\":\"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z\"}]]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/yunwei37\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"github\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"GitHub\"}],[\"$\",\"path\",null,{\"d\":\"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12\"}]]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://facebook.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"facebook\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Facebook\"}],[\"$\",\"path\",null,{\"d\":\"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z\"}]]}]]}],[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://youtube.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"youtube\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Youtube\"}],[\"$\",\"path\",null,{\"d\":\"M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z\"}]]}]]}],\"$L14\",\"$L15\",\"$L16\",\"$L17\",\"$L18\",\"$L19\",\"$L1a\"]}],\"$L1b\",\"$L1c\"]}]}]\n"])</script><script>self.__next_f.push([1,"a:[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L12\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L13\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]\nb:[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L12\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L13\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]\nc:[\"$\",\"$1\",\"c\",{\"children\":[\"$L1d\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/7246298b30c42979.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$L1e\",null,{\"children\":[\"$L1f\",[\"$\",\"$L20\",null,{\"promise\":\"$@21\"}]]}]]}]\nd:[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$L22\",null,{\"children\":\"$L23\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]],[\"$\",\"$L24\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$25\",null,{\"fallback\":null,\"children\":\"$L26\"}]}]}]]}]\n"])</script><script>self.__next_f.push([1,"14:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.linkedin.com/in/yusheng-zheng-611920280\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"linkedin\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Linkedin\"}],[\"$\",\"path\",null,{\"d\":\"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"15:null\n"])</script><script>self.__next_f.push([1,"16:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://bsky.app/\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"bluesky\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Bluesky\"}],[\"$\",\"path\",null,{\"d\":\"M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565C.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479c.815 2.736 3.713 3.66 6.383 3.364q.204-.03.415-.056q-.207.033-.415.056c-3.912.58-7.387 2.005-2.83 7.078c5.013 5.19 6.87-1.113 7.823-4.308c.953 3.195 2.05 9.271 7.733 4.308c4.267-4.308 1.172-6.498-2.74-7.078a9 9 0 0 1-.415-.056q.21.026.415.056c2.67.297 5.568-.628 6.383-3.364c.246-.828.624-5.79.624-6.478c0-.69-.139-1.861-.902-2.206c-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"17:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://x.com/yunwei37\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"x\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"X\"}],[\"$\",\"path\",null,{\"d\":\"M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z\"}]]}]]}]\n27:T69f,"])</script><script>self.__next_f.push([1,"M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"])</script><script>self.__next_f.push([1,"18:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.instagram.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"instagram\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Instagram\"}],[\"$\",\"path\",null,{\"d\":\"$27\"}]]}]]}]\n28:T498,"])</script><script>self.__next_f.push([1,"M12.186 24h-.007c-3.581-.024-6.334-1.205-8.184-3.509C2.35 18.44 1.5 15.586 1.472 12.01v-.017c.03-3.579.879-6.43 2.525-8.482C5.845 1.205 8.6.024 12.18 0h.014c2.746.02 5.043.725 6.826 2.098 1.677 1.29 2.858 3.13 3.509 5.467l-2.04.569c-1.104-3.96-3.898-5.984-8.304-6.015-2.91.022-5.11.936-6.54 2.717C4.307 6.504 3.616 8.914 3.589 12c.027 3.086.718 5.496 2.057 7.164 1.43 1.783 3.631 2.698 6.54 2.717 2.623-.02 4.358-.631 5.8-2.045 1.647-1.613 1.618-3.593 1.09-4.798-.31-.71-.873-1.3-1.634-1.75-.192 1.352-.622 2.446-1.284 3.272-.886 1.102-2.14 1.704-3.73 1.79-1.202.065-2.361-.218-3.259-.801-1.063-.689-1.685-1.74-1.752-2.964-.065-1.19.408-2.285 1.33-3.082.88-.76 2.119-1.207 3.583-1.291a13.853 13.853 0 0 1 3.02.142c-.126-.742-.375-1.332-.75-1.757-.513-.586-1.308-.883-2.359-.89h-.029c-.844 0-1.992.232-2.721 1.32L7.734 7.847c.98-1.454 2.568-2.256 4.478-2.256h.044c3.194.02 5.097 1.975 5.287 5.388.108.046.216.094.321.142 1.49.7 2.58 1.761 3.154 3.07.797 1.82.871 4.79-1.548 7.158-1.85 1.81-4.094 2.628-7.277 2.65Zm1.003-11.69c-.242 0-.487.007-.739.021-1.836.103-2.98.946-2.916 2.143.067 1.256 1.452 1.839 2.784 1.767 1.224-.065 2.818-.543 3.086-3.71a10.5 10.5 0 0 0-2.215-.221z"])</script><script>self.__next_f.push([1,"19:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://www.threads.net\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"threads\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Threads\"}],[\"$\",\"path\",null,{\"d\":\"$28\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"1a:[\"$\",\"a\",null,{\"className\":\"text-sm text-gray-500 transition hover:text-gray-600\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://medium.com\",\"children\":[[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"medium\"}],[\"$\",\"svg\",null,{\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 24 24\",\"className\":\"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Medium\"}],[\"$\",\"path\",null,{\"d\":\"M13.54 12a6.8 6.8 0 01-6.77 6.82A6.8 6.8 0 010 12a6.8 6.8 0 016.77-6.82A6.8 6.8 0 0113.54 12zM20.96 12c0 3.54-1.51 6.42-3.38 6.42-1.87 0-3.39-2.88-3.39-6.42s1.52-6.42 3.39-6.42 3.38 2.88 3.38 6.42M24 12c0 3.17-.53 5.75-1.19 5.75-.66 0-1.19-2.58-1.19-5.75s.53-5.75 1.19-5.75C23.47 6.25 24 8.83 24 12z\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"1b:[\"$\",\"div\",null,{\"className\":\"flex space-x-2 text-sm opacity-80\",\"children\":[[\"$\",\"div\",null,{\"children\":\"Yusheng Zheng\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"div\",null,{\"children\":\"© 2025\"}],[\"$\",\"div\",null,{\"children\":\" • \"}],[\"$\",\"$L6\",null,{\"className\":\"hover:text-primary-500 transition-colors\",\"href\":\"/\",\"children\":\"云微的胡思乱想\"}]]}]\n1c:[\"$\",\"div\",null,{\"className\":\"text-sm opacity-60\",\"children\":[\"$\",\"a\",null,{\"className\":\"hover:text-primary-500 transition-colors\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/timlrx/tailwind-nextjs-starter-blog\",\"children\":\"Tailwind Nextjs Theme\"}]}]\n"])</script><script>self.__next_f.push([1,"29:I[1839,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-71c7cfee63112339.js\"],\"default\"]\n2a:I[3063,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-71c7cfee63112339.js\"],\"Image\"]\n"])</script><script>self.__next_f.push([1,"1d:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"L7 Tracing with eBPF: HTTP and Beyond via Socket Filters and Syscall Tracing\\\",\\\"datePublished\\\":\\\"2023-06-14T02:41:06.000Z\\\",\\\"dateModified\\\":\\\"2023-06-14T02:41:06.000Z\\\",\\\"image\\\":\\\"/static/images/twitter-card.png\\\",\\\"url\\\":\\\"https://www.yunwei37.com/blog/L7 Tracing with eBPF\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Yusheng Zheng (云微)\\\"}]}\"}}],[\"$\",\"section\",null,{\"className\":\"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0\",\"children\":[[\"$\",\"$L29\",null,{}],[\"$\",\"article\",null,{\"className\":\"content-glass p-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"xl:divide-y xl:divide-gray-200/30 xl:dark:divide-gray-700/30\",\"children\":[[\"$\",\"header\",null,{\"className\":\"pt-6 xl:pb-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"space-y-4 text-center\",\"children\":[[\"$\",\"dl\",null,{\"className\":\"space-y-4\",\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Published on\"}],[\"$\",\"dd\",null,{\"className\":\"text-base leading-6 font-medium text-gray-600 dark:text-gray-300\",\"children\":[\"$\",\"time\",null,{\"dateTime\":\"2023-06-14T02:41:06.000Z\",\"children\":\"Wednesday, June 14, 2023\"}]}]]}]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"h1\",null,{\"className\":\"text-3xl leading-9 font-extrabold tracking-tight sm:text-4xl sm:leading-10 md:text-5xl md:leading-14\",\"children\":\"L7 Tracing with eBPF: HTTP and Beyond via Socket Filters and Syscall Tracing\"}]}]]}]}],[\"$\",\"div\",null,{\"className\":\"grid-rows-[auto_1fr] divide-y divide-gray-200/30 pb-8 xl:grid xl:grid-cols-4 xl:gap-x-8 xl:divide-y-0 dark:divide-gray-700/30\",\"children\":[[\"$\",\"dl\",null,{\"className\":\"pt-6 pb-10 xl:border-b xl:border-gray-200/30 xl:pt-11 xl:dark:border-gray-700/30\",\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Authors\"}],[\"$\",\"dd\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-y-6 xl:space-x-0\",\"children\":[[\"$\",\"li\",\"Yusheng Zheng (云微)\",{\"className\":\"flex items-center space-x-3 glass p-4 rounded-xl\",\"children\":[[\"$\",\"$L2a\",null,{\"src\":\"/static/images/avatar.png\",\"width\":38,\"height\":38,\"alt\":\"avatar\",\"className\":\"h-10 w-10 rounded-full\"}],[\"$\",\"dl\",null,{\"className\":\"text-sm leading-5 font-medium whitespace-nowrap\",\"children\":[[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Name\"}],[\"$\",\"dd\",null,{\"className\":\"text-gray-900 dark:text-gray-100\",\"children\":\"Yusheng Zheng (云微)\"}],[\"$\",\"dt\",null,{\"className\":\"sr-only\",\"children\":\"Twitter\"}],[\"$\",\"dd\",null,{\"children\":[\"$\",\"a\",null,{\"className\":\"text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://twitter.com/yunwei37\",\"children\":\"@yunwei37\"}]}]]}]]}]]}]}]]}],[\"$\",\"div\",null,{\"className\":\"divide-y divide-gray-200/30 xl:col-span-3 xl:row-span-2 xl:pb-0 dark:divide-gray-700/30\",\"children\":[[\"$\",\"div\",null,{\"className\":\"prose dark:prose-invert max-w-none pt-10 pb-8 text-gray-700 dark:text-gray-200\",\"children\":[[\"$\",\"p\",null,{\"children\":\"In today's technology landscape, with the rise of microservices, cloud-native applications, and complex distributed systems, observability of systems has become a crucial factor in ensuring their health, performance, and security. Especially in a microservices architecture, application components may be distributed across multiple containers and servers, making traditional monitoring methods often insufficient to provide the depth and breadth needed to fully understand the behavior of the system. This is where observing seven-layer protocols such as HTTP, gRPC, MQTT, and more becomes particularly important.\"}],[\"$\",\"p\",null,{\"children\":\"Seven-layer protocols provide detailed insights into how applications interact with other services and components. In a microservices environment, understanding these interactions is vital, as they often serve as the root causes of performance bottlenecks, failures, and security issues. However, monitoring these protocols is not a straightforward task. Traditional network monitoring tools like tcpdump, while effective at capturing network traffic, often fall short when dealing with the complexity and dynamism of seven-layer protocols.\"}],\"$L2b\",\"$L2c\",\"$L2d\",\"$L2e\",\"$L2f\",\"$L30\",\"$L31\",\"$L32\",\"$L33\",\"$L34\",\"$L35\",\"$L36\",\"$L37\",\"$L38\",\"$L39\",\"$L3a\",\"$L3b\",\"$L3c\",\"$L3d\",\"$L3e\",\"$L3f\",\"$L40\",\"$L41\",\"$L42\",\"$L43\",\"$L44\",\"$L45\",\"$L46\",\"$L47\",\"$L48\",\"$L49\",\"$L4a\",\"$L4b\",\"$L4c\",\"$L4d\",\"$L4e\",\"$L4f\",\"$L50\",\"$L51\",\"$L52\",\"$L53\",\"$L54\",\"$L55\",\"$L56\",\"$L57\",\"$L58\",\"$L59\",\"$L5a\",\"$L5b\",\"$L5c\",\"$L5d\",\"$L5e\",\"$L5f\",\"$L60\",\"$L61\",\"$L62\",\"$L63\",\"$L64\",\"$L65\",\"$L66\",\"$L67\",\"$L68\",\"$L69\",\"$L6a\",\"$L6b\",\"$L6c\",\"$L6d\",\"$L6e\",\"$L6f\",\"$L70\",\"$L71\",\"$L72\",\"$L73\",\"$L74\",\"$L75\",\"$L76\",\"$L77\",\"$L78\",\"$L79\",\"$L7a\",\"$L7b\",\"$L7c\",\"$L7d\",\"$L7e\",\"$L7f\",\"$L80\",\"$L81\",\"$L82\",\"$L83\",\"$L84\",\"$L85\",\"$L86\",\"$L87\",\"$L88\",\"$L89\",\"$L8a\",\"$L8b\",\"$L8c\",\"$L8d\",\"$L8e\",\"$L8f\",\"$L90\",\"$L91\",\"$L92\",\"$L93\",\"$L94\",\"$L95\",\"$L96\",\"$L97\",\"$L98\",\"$L99\",\"$L9a\",\"$L9b\",\"$L9c\",\"$L9d\"]}],\"$L9e\",\"$L9f\"]}],\"$La0\"]}]]}]}]]}]]\n"])</script><script>self.__next_f.push([1,"a1:I[2100,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-71c7cfee63112339.js\"],\"default\"]\n155:I[1449,[\"874\",\"static/chunks/874-8edb22cc7428423c.js\",\"63\",\"static/chunks/63-d245e42a784ca56d.js\",\"909\",\"static/chunks/app/blog/%5B...slug%5D/page-71c7cfee63112339.js\"],\"default\"]\n2b:[\"$\",\"p\",null,{\"children\":\"This is where eBPF (extended Berkeley Packet Filter) technology comes into play. eBPF allows developers and operators to delve deep into the kernel layer, observing and analyzing system behavior in real-time without the need to modify or insert instrumentation into application code. This presents a unique opportunity to handle application layer traffic more simply and efficiently, particularly in microservices environments.\"}]\n2c:[\"$\",\"p\",null,{\"children\":\"In this tutorial, we will delve into the following:\"}]\n2d:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Tracking seven-layer protocols such as HTTP and the challenges associated with them.\"}],[\"$\",\"li\",null,{\"children\":\"eBPF's socket filter and syscall tracing: How these two technologies assist in tracing HTTP network request data at different kernel layers, and the advantages and limitations of each.\"}],[\"$\",\"li\",null,{\"children\":\"eBPF practical tutorial: How to develop an eBPF program and utilize eBPF socket filter or syscall tracing to capture and analyze HTTP traffic.\"}]]}]\n2e:[\"$\",\"p\",null,{\"children\":\"As network traffic increases and applications grow in complexity, gaining a deeper understanding of seven-layer protocols becomes increasingly important. Through this tutorial, you will acquire the necessary knowledge and tools to more effectively monitor and analyze your network traffic, ultimately enhancing the performance of your applications and servers.\"}]\n2f:[\"$\",\"p\",null,{\"children\":[\"This article is part of the eBPF Developer Tutorial, and for more detailed content, you can visit \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noop"])</script><script>self.__next_f.push([1,"ener noreferrer\",\"href\":\"https://eunomia.dev/tutorials/\",\"children\":\"here\"}],\". The source code is available on the \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/eunomia-bpf/bpf-developer-tutorial\",\"children\":\"GitHub repository\"}],\".\"]}]\n"])</script><script>self.__next_f.push([1,"30:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"challenges-in-tracking-http-http2-and-other-seven-layer-protocols\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#challenges-in-tracking-http-http2-and-other-seven-layer-protocols\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Challenges in Tracking HTTP, HTTP/2, and Other Seven-Layer Protocols\"]}]\n"])</script><script>self.__next_f.push([1,"31:[\"$\",\"p\",null,{\"children\":\"In the modern networking environment, seven-layer protocols extend beyond just HTTP. In fact, there are many seven-layer protocols such as HTTP/2, gRPC, MQTT, WebSocket, AMQP, and SMTP, each serving critical roles in various application scenarios. These protocols provide detailed insights into how applications interact with other services and components. However, tracking these protocols is not a simple task, especially within complex distributed systems.\"}]\n"])</script><script>self.__next_f.push([1,"32:[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Diversity and Complexity\"}],\": Each seven-layer protocol has its specific design and workings. For example, gRPC utilizes HTTP/2 as its transport protocol and supports multiple languages, while MQTT is a lightweight publish/subscribe messaging transport protocol designed for low-bandwidth and unreliable networks.\"]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Dynamism\"}],\": Many seven-layer protocols are dynamic, meaning their behavior can change based on network conditions, application requirements, or other factors.\"]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Encryption and Security\"}],\": With increased security awareness, many seven-layer protocols employ encryption technologies such as TLS/SSL. This introduces additional challenges for tracking and analysis, as decrypting traffic is required for in-depth examination.\"]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"High-Performance Requirements\"}],\": In high-traffic production environments, capturing and analyzing traffic for seven-layer protocols can impact system performance. Traditional network monitoring tools may struggle to handle a large number of concurrent sessions.\"]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Data Completeness and Continuity\"}],\": Unlike tools like tcpdump, which capture individual packets, tracking seven-layer protocols requires capturing complete sessions, which may involve multiple packets. This necessitates tools capable of correctly reassembling and parsing these packets to provide a continuous session view.\"]}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Code Intrusiveness\"}],\": To gain deeper insights into the behavior of seven-layer protocols, developers may need to modify application code to add monitoring functionalities. This not only increases development and maintenance complexity but can also impact application performance.\"]}]}]]}]\n"])</script><script>self.__next_f.push([1,"33:[\"$\",\"p\",null,{\"children\":\"As mentioned earlier, eBPF provides a powerful solution, allowing us to capture and analyze seven-layer protocol traffic in the kernel layer without modifying application code. This approach not only offers insights into system behavior but also ensures optimal performance and efficiency. This is why eBPF has become the preferred technology for modern observability tools, especially in production environments that demand high performance and low latency.\"}]\n"])</script><script>self.__next_f.push([1,"34:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"ebpf-socket-filter-vs-syscall-tracing-in-depth-analysis-and-comparison\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#ebpf-socket-filter-vs-syscall-tracing-in-depth-analysis-and-comparison\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"eBPF Socket Filter vs. Syscall Tracing: In-Depth Analysis and Comparison\"]}]\n"])</script><script>self.__next_f.push([1,"35:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"ebpf-socket-filter\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#ebpf-socket-filter\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"eBPF Socket Filter\"}]]}]\n"])</script><script>self.__next_f.push([1,"36:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"What Is It?\"}],\" eBPF socket filter is an extension of the classic Berkeley Packet Filter (BPF) that allows for more advanced packet filtering directly within the kernel. It operates at the socket layer, enabling fine-grained control over which packets are processed by user-space applications.\"]}]\n37:[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Key Features:\"}]}]\n38:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Performance\"}],\": By handling packets directly within the kernel, eBPF socket filters reduce the overhead of context switches between user and kernel spaces.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Flexibility\"}],\": eBPF socket filters can be attached to any socket, providing a universal packet filtering mechanism for various protocols and socket types.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Programmability\"}],\": Developers can write custom eBPF programs to define complex filtering logic beyond simple packet matching.\"]}]]}]\n39:[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Use Cases:\"}]}]\n3a:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Traffic Control\"}],\": Restrict or prioritize traffic based on custom conditions.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Security\"}],\": Discard malicious packets before they reach user-space applications.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Monitoring\"}],\": Capture specific packets for analysis without affecting other traffic.\"]}]]}]\n"])</script><script>self.__next_f.push([1,"3b:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"ebpf-syscall-tracing\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#ebpf-syscall-tracing\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],[\"$\",\"strong\",null,{\"children\":\"eBPF Syscall Tracing\"}]]}]\n"])</script><script>self.__next_f.push([1,"3c:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"What Is It?\"}],\" System call tracing using eBPF allows monitoring and manipulation of system calls made by applications. System calls are the primary mechanism through which user-space applications interact with the kernel, making tracing them a valuable way to understand application behavior.\"]}]\n3d:[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Key Features:\"}]}]\n3e:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Granularity\"}],\": eBPF allows tracing specific system calls, even specific parameters within those system calls.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Low Overhead\"}],\": Compared to other tracing methods, eBPF syscall tracing is designed to have minimal performance impact.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Security\"}],\": Kernel validates eBPF programs to ensure they do not compromise system stability.\"]}]]}]\n3f:[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"How It Works:\"}],\" eBPF syscall tracing typically involves attaching eBPF programs to tracepoints or kprobes related to the system calls being traced. When the traced system call is invoked, the eBPF program is executed, allowing data collection or even modification of system call parameters.\"]}]\n"])</script><script>self.__next_f.push([1,"40:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"comparison-of-ebpf-socket-filter-and-syscall-tracing\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#comparison-of-ebpf-socket-filter-and-syscall-tracing\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Comparison of eBPF Socket Filter and Syscall Tracing\"]}]\n"])</script><script>self.__next_f.push([1,"41:[\"$\",\"div\",null,{\"className\":\"w-full overflow-x-auto\",\"children\":[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Aspect\"}],[\"$\",\"th\",null,{\"children\":\"eBPF Socket Filter\"}],[\"$\",\"th\",null,{\"children\":\"eBPF Syscall Tracing\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Operational Layer\"}]}],[\"$\",\"td\",null,{\"children\":\"Socket layer, primarily dealing with network packets received from or sent to sockets.\"}],[\"$\",\"td\",null,{\"children\":\"System call layer, monitoring and potentially altering the behavior of system calls made by applications.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Primary Use Cases\"}]}],[\"$\",\"td\",null,{\"children\":\"Mainly used for filtering, monitoring, and manipulation of network packets.\"}],[\"$\",\"td\",null,{\"children\":\"Used for performance analysis, security monitoring, and debugging of interactions with the network.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Granularity\"}]}],[\"$\",\"td\",null,{\"children\":\"Focuses on individual network packets.\"}],[\"$\",\"td\",null,{\"children\":\"Can monitor a wide range of system activities, including those unrelated to networking.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Tracking HTTP Traffic\"}]}],[\"$\",\"td\",null,{\"children\":\"Can be used to filter and capture HTTP packets passed through sockets.\"}],[\"$\",\"td\",null,{\"children\":\"Can trace system calls associated with networking operations, which may include HTTP traffic.\"}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"42:[\"$\",\"p\",null,{\"children\":\"In summary, both eBPF socket filters and syscall tracing can be used to trace HTTP traffic, but socket filters are more direct and suitable for this purpose. However, if you are interested in the broader context of how an application interacts with the system (e.g., which system calls lead to HTTP traffic), syscall tracing can be highly valuable. In many advanced observability setups, both tools may be used simultaneously to provide a comprehensive view of system and network behavior.\"}]\n"])</script><script>self.__next_f.push([1,"43:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"capturing-http-traffic-with-ebpf-socket-filter\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#capturing-http-traffic-with-ebpf-socket-filter\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Capturing HTTP Traffic with eBPF Socket Filter\"]}]\n"])</script><script>self.__next_f.push([1,"44:[\"$\",\"p\",null,{\"children\":\"eBPF code consists of user-space and kernel-space components, and here we primarily focus on the kernel-space code. Below is the main logic for capturing HTTP traffic in the kernel using eBPF socket filter technology, and the complete code is provided:\"}]\n"])</script><script>self.__next_f.push([1,"45:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"socket\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"socket_handler\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"__sk_buff\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"so_event\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u8 verlen\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u16 proto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u32 nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" ETH_HLEN\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u32 ip_proto \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u32 tcp_hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u16 tlen\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u32 payload_offset \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u32 payload_length \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u8 hdr_len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"12\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"proto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    proto \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__bpf_ntohs\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"proto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"proto \",\"$La2\",\" ETH_P_IP\",\"$La3\",\"\\n\"]}],\"$La4\",\"$La5\",\"$La6\",\"$La7\",\"$La8\",\"$La9\",\"$Laa\",\"$Lab\",\"$Lac\",\"$Lad\",\"$Lae\",\"$Laf\",\"$Lb0\",\"$Lb1\",\"$Lb2\",\"$Lb3\",\"$Lb4\",\"$Lb5\",\"$Lb6\",\"$Lb7\",\"$Lb8\",\"$Lb9\",\"$Lba\",\"$Lbb\",\"$Lbc\",\"$Lbd\",\"$Lbe\",\"$Lbf\",\"$Lc0\",\"$Lc1\",\"$Lc2\",\"$Lc3\",\"$Lc4\",\"$Lc5\",\"$Lc6\",\"$Lc7\",\"$Lc8\",\"$Lc9\",\"$Lca\",\"$Lcb\",\"$Lcc\",\"$Lcd\",\"$Lce\",\"$Lcf\",\"$Ld0\",\"$Ld1\",\"$Ld2\",\"$Ld3\",\"$Ld4\",\"$Ld5\",\"$Ld6\",\"$Ld7\",\"$Ld8\",\"$Ld9\",\"$Lda\",\"$Ldb\",\"$Ldc\",\"$Ldd\",\"$Lde\",\"$Ldf\",\"$Le0\",\"$Le1\",\"$Le2\",\"$Le3\",\"$Le4\",\"$Le5\",\"$Le6\",\"$Le7\",\"$Le8\",\"$Le9\",\"$Lea\",\"$Leb\"]}]}]\n"])</script><script>self.__next_f.push([1,"46:[\"$\",\"p\",null,{\"children\":\"When analyzing this eBPF program, we will explain it in detail according to the content of each code block and provide relevant background knowledge:\"}]\n"])</script><script>self.__next_f.push([1,"47:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"socket\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"socket_handler\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"__sk_buff\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ...\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"48:[\"$\",\"p\",null,{\"children\":[\"This is the entry point of the eBPF program, defining a function named \",[\"$\",\"code\",null,{\"children\":\"socket_handler\"}],\" that the kernel uses to handle incoming network packets. This function is located in an eBPF section named \",[\"$\",\"code\",null,{\"children\":\"socket\"}],\", indicating that it is intended for socket handling.\"]}]\n"])</script><script>self.__next_f.push([1,"49:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"so_event\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"__u8 verlen\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"__u16 proto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"__u32 nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" ETH_HLEN\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"__u32 ip_proto \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"__u32 tcp_hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"__u16 tlen\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"__u32 payload_offset \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"__u32 payload_length \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"__u8 hdr_len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"4a:[\"$\",\"p\",null,{\"children\":[\"In this code block, several variables are defined to store information needed during packet processing. These variables include \",[\"$\",\"code\",null,{\"children\":\"struct so_event *e\"}],\" for storing event information, \",[\"$\",\"code\",null,{\"children\":\"verlen\"}],\", \",[\"$\",\"code\",null,{\"children\":\"proto\"}],\", \",[\"$\",\"code\",null,{\"children\":\"nhoff\"}],\", \",[\"$\",\"code\",null,{\"children\":\"ip_proto\"}],\", \",[\"$\",\"code\",null,{\"children\":\"tcp_hdr_len\"}],\", \",[\"$\",\"code\",null,{\"children\":\"tlen\"}],\", \",[\"$\",\"code\",null,{\"children\":\"payload_offset\"}],\", \",[\"$\",\"code\",null,{\"children\":\"payload_length\"}],\", and \",[\"$\",\"code\",null,{\"children\":\"hdr_len\"}],\" for storing packet information.\"]}]\n"])</script><script>self.__next_f.push([1,"4b:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"struct so_event *e;\"}],\": This is a pointer to the \",[\"$\",\"code\",null,{\"children\":\"so_event\"}],\" structure for storing captured event information. The specific definition of this structure is located elsewhere in the program.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"__u8 verlen;\"}],\", \",[\"$\",\"code\",null,{\"children\":\"__u16 proto;\"}],\", \",[\"$\",\"code\",null,{\"children\":\"__u32 nhoff = ETH_HLEN;\"}],\": These variables are used to store various pieces of information, such as protocol types, packet offsets, etc. \",[\"$\",\"code\",null,{\"children\":\"nhoff\"}],\" is initialized to the length of the Ethernet frame header, typically 14 bytes, as Ethernet frame headers include destination MAC address, source MAC address, and frame type fields.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"__u32 ip_proto = 0;\"}],\": This variable is used to store the type of the IP protocol and is initialized to 0.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"__u32 tcp_hdr_len = 0;\"}],\": This variable is used to store the length of the TCP header and is initialized to 0.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"__u16 tlen;\"}],\": This variable is used to store the total length of the IP packet.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"__u32 payload_offset = 0;\"}],\", \",[\"$\",\"code\",null,{\"children\":\"__u32 payload_length = 0;\"}],\": These two variables are used to store the offset and length of the HTTP request payload.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"__u8 hdr_len;\"}],\": This variable is used to store the length of the IP header.\"]}]]}]\n"])</script><script>self.__next_f.push([1,"4c:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"12\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"proto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"proto \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__bpf_ntohs\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"proto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"proto \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" ETH_P_IP\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"4d:[\"$\",\"p\",null,{\"children\":[\"Here, the code loads the Ethernet frame type field from the packet, which tells us the network layer protocol being used in the packet. It then uses the \",[\"$\",\"code\",null,{\"children\":\"__bpf_ntohs\"}],\" function to convert the network byte order type field into host byte order. Next, the code checks if the type field is not equal to the Ethernet frame type for IPv4 (0x0800). If it's not equal, it means the packet is not an IPv4 packet, and the function returns 0, indicating that the packet should not be processed.\"]}]\n4e:[\"$\",\"p\",null,{\"children\":\"Key concepts to understand here:\"}]\n"])</script><script>self.__next_f.push([1,"4f:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Ethernet Frame: The Ethernet frame is a data link layer (Layer 2) protocol used for transmitting data frames within a local area network (LAN). Ethernet frames typically include destination MAC address, source MAC address, and frame type fields.\"}],[\"$\",\"li\",null,{\"children\":\"Network Byte Order: Network protocols often use big-endian byte order to represent data. Therefore, data received from the network needs to be converted into host byte order for proper interpretation on the host. Here, the type field from the network is converted to host byte order for further processing.\"}],[\"$\",\"li\",null,{\"children\":\"IPv4 Frame Type (ETH_P_IP): This represents the frame type field in the Ethernet frame, where 0x0800 indicates IPv4.\"}]]}]\n"])</script><script>self.__next_f.push([1,"50:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"ip_is_fragment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"51:[\"$\",\"p\",null,{\"children\":\"This part of the code checks if IP fragmentation is being handled. IP fragmentation is a mechanism for splitting larger IP packets into multiple smaller fragments for transmission. Here, if the packet is an IP fragment, the function returns 0, indicating that only complete packets will be processed.\"}]\n"])</script><script>self.__next_f.push([1,"52:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"static\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"inline\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"ip_is_fragment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"__sk_buff\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" __u32 nhoff\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u16 frag_off\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"offsetof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"iphdr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" frag_off\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"frag_off\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    frag_off \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__bpf_ntohs\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"frag_off\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" frag_off \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"IP_MF \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\" IP_OFFSET\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"53:[\"$\",\"p\",null,{\"children\":\"The above code is a helper function used to check if the incoming IPv4 packet is an IP fragment. IP fragmentation is a mechanism where, if the size of an IP packet exceeds the Maximum Transmission Unit (MTU) of the network, routers split it into smaller fragments for transmission across the network. The purpose of this function is to examine the fragment flags and fragment offset fields within the packet to determine if it is a fragment.\"}]\n54:[\"$\",\"p\",null,{\"children\":\"Here's an explanation of the code line by line:\"}]\n"])</script><script>self.__next_f.push([1,"55:[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"__u16 frag_off;\"}],\": Defines a 16-bit unsigned integer variable \",[\"$\",\"code\",null,{\"children\":\"frag_off\"}],\" to store the fragment offset field.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"bpf_skb_load_bytes(skb, nhoff + offsetof(struct iphdr, frag_off), \u0026frag_off, 2);\"}],\": This line of code uses the \",[\"$\",\"code\",null,{\"children\":\"bpf_skb_load_bytes\"}],\" function to load the fragment offset field from the packet. \",[\"$\",\"code\",null,{\"children\":\"nhoff\"}],\" is the offset of the IP header within the packet, and \",[\"$\",\"code\",null,{\"children\":\"offsetof(struct iphdr, frag_off)\"}],\" calculates the offset of the fragment offset field within the IPv4 header.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"frag_off = __bpf_ntohs(frag_off);\"}],\": Converts the loaded fragment offset field from network byte order (big-endian) to host byte order. Network protocols typically use big-endian to represent data, and the conversion to host byte order is done for further processing.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"return frag_off \u0026 (IP_MF | IP_OFFSET);\"}],\": This line of code checks the value of the fragment offset field using a bitwise AND operation with two flag values:\",[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"IP_MF\"}],\": Represents the \\\"More Fragments\\\" flag. If this flag is set to 1, it indicates that the packet is part of a fragmented sequence and more fragments are expected.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"IP_OFFSET\"}],\": Represents the fragment offset field. If the fragment offset field is non-zero, it indicates that the packet is part of a fragmented sequence and has a fragment offset value. If either of these flags is set to 1, the result is non-zero, indicating that the packet is an IP fragment. If both flags are 0, it means the packet is not fragmented.\"]}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"56:[\"$\",\"p\",null,{\"children\":\"It's important to note that the fragment offset field in the IP header is specified in units of 8 bytes, so the actual byte offset is obtained by left-shifting the value by 3 bits. Additionally, the \\\"More Fragments\\\" flag (IP_MF) in the IP header indicates whether there are more fragments in the sequence and is typically used in conjunction with the fragment offset field to indicate the status of fragmented packets.\"}]\n"])</script><script>self.__next_f.push([1,"57:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ETH_HLEN\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"hdr_len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"hdr_len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0x0f\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"58:[\"$\",\"p\",null,{\"children\":\"In this part of the code, the length of the IP header is loaded from the packet. The IP header length field contains information about the length of the IP header in units of 4 bytes, and it needs to be converted to bytes. Here, it is converted by performing a bitwise AND operation with 0x0f and then multiplying it by 4.\"}]\n59:[\"$\",\"p\",null,{\"children\":\"Key concept:\"}]\n5a:[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"IP Header: The IP header contains fundamental information about a packet, such as the source IP address, destination IP address, protocol type, total length, identification, flags, fragment offset, time to live (TTL), checksum, source port, and destination port.\"}]}]\n"])</script><script>self.__next_f.push([1,"5b:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"iphdr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"5c:[\"$\",\"p\",null,{\"children\":\"This code segment checks if the length of the IP header meets the minimum length requirement, typically 20 bytes. If the length of the IP header is less than 20 bytes, it indicates an incomplete or corrupted packet, and the function returns 0, indicating that the packet should not be processed.\"}]\n5d:[\"$\",\"p\",null,{\"children\":\"Key concept:\"}]\n5e:[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"struct iphdr\"}],\": This is a structure defined in the Linux kernel, representing the format of an IPv4 header. It includes fields such as version, header length, service type, total length, identification, flags, fragment offset, time to live, protocol, header checksum, source IP address, and destination IP address, among others.\"]}]}]\n"])</script><script>self.__next_f.push([1,"5f:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"offsetof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"iphdr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" protocol\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"ip_proto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"ip_proto \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" IPPROTO_TCP\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"60:[\"$\",\"p\",null,{\"children\":\"Here, the code loads the protocol field from the IP header to determine the transport layer protocol used in the packet. Then, it checks if the protocol field is not equal to the value for TCP (IPPROTO_TCP). If it's not TCP, it means the packet is not an HTTP request or response, and the function returns 0.\"}]\n61:[\"$\",\"p\",null,{\"children\":\"Key concept:\"}]\n62:[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"Transport Layer Protocol: The protocol field in the IP header indicates the transport layer protocol used in the packet, such as TCP, UDP, or ICMP.\"}]}]\n63:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"tcp_hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" hdr_len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]}]}]\n64:[\"$\",\"p\",null,{\"children\":[\"This line of code calculates the offset of the TCP header. It adds the length of the Ethernet frame header (\",[\"$\",\"code\",null,{\"children\":\"nhoff\"}],\") to the length of the IP header (\",[\"$\",\"code\",null,{\"children\":\"hdr_len\"}],\") to obtain the starting position of the TCP header.\"]}]\n"])</script><script>self.__next_f.push([1,"65:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"verlen\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]}]}]\n"])</script><script>self.__next_f.push([1,"66:[\"$\",\"p\",null,{\"children\":\"This line of code loads the first byte of the TCP header from the packet, which contains information about the TCP header length. This length field is specified in units of 4 bytes and requires further conversion.\"}]\n"])</script><script>self.__next_f.push([1,"67:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"offsetof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"iphdr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" tot_len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"tlen\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"tlen\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]}]}]\n"])</script><script>self.__next_f.push([1,"68:[\"$\",\"p\",null,{\"children\":\"This line of code loads the total length field of the IP header from the packet. The IP header's total length field represents the overall length of the IP packet, including both the IP header and the data portion.\"}]\n"])</script><script>self.__next_f.push([1,"69:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"__u8 doff\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" tcp_hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"offsetof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"__tcphdr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ack_seq\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"doff\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"doff\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"doff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0xf0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"doff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"doff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"6a:[\"$\",\"p\",null,{\"children\":\"This piece of code is used to calculate the length of the TCP header. It loads the Data Offset field (also known as the Header Length field) from the TCP header, which represents the length of the TCP header in units of 4 bytes. The code clears the high four bits of the offset field, then shifts it right by 4 bits, and finally multiplies it by 4 to obtain the actual length of the TCP header.\"}]\n6b:[\"$\",\"p\",null,{\"children\":\"Key points to understand:\"}]\n6c:[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"TCP Header: The TCP header contains information related to the TCP protocol, such as source port, destination port, sequence number, acknowledgment number, flags (e.g., SYN, ACK, FIN), window size, and checksum.\"}]}]\n"])</script><script>self.__next_f.push([1,"6d:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"payload_offset \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" ETH_HLEN \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" doff\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"payload_length \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__bpf_ntohs\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"tlen\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" doff\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"6e:[\"$\",\"p\",null,{\"children\":\"These two lines of code calculate the offset and length of the HTTP request payload. They add the lengths of the Ethernet frame header, IP header, and TCP header together to obtain the offset to the data portion of the HTTP request. Then, by subtracting the total length, IP header length, and TCP header length from the total length field, they calculate the length of the HTTP request data.\"}]\n6f:[\"$\",\"p\",null,{\"children\":\"Key point:\"}]\n70:[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"HTTP Request Payload: The actual data portion included in an HTTP request, typically consisting of the HTTP request headers and request body.\"}]}]\n"])</script><script>self.__next_f.push([1,"71:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"payload_length \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" payload_offset \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" payload_offset\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_printk\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"%d len %d buffer: %s\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" payload_offset\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" payload_length\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"72:[\"$\",\"p\",null,{\"children\":[\"This portion of the code loads the first 7 bytes of the HTTP request line and stores them in a character array named \",[\"$\",\"code\",null,{\"children\":\"line_buffer\"}],\". It then checks if the length of the HTTP request data is less than 7 bytes or if the offset is negative. If these conditions are met, it indicates an incomplete HTTP request, and the function returns 0. Finally, it uses the \",[\"$\",\"code\",null,{\"children\":\"bpf_printk\"}],\" function to print the content of the HTTP request line to the kernel log for debugging and analysis.\"]}]\n"])</script><script>self.__next_f.push([1,"73:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_strncmp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"GET\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_strncmp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"POST\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_strncmp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"PUT\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_strncmp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"6\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"DELETE\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_strncmp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"HTTP\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"74:[\"$\",\"p\",null,{\"children\":[\"This piece of code uses the \",[\"$\",\"code\",null,{\"children\":\"bpf_strncmp\"}],\" function to compare the data in \",[\"$\",\"code\",null,{\"children\":\"line_buffer\"}],\" with HTTP request methods (GET, POST, PUT, DELETE, HTTP). If there is no match, indicating that it is not an HTTP request, it returns 0, indicating that it should not be processed.\"]}]\n"])</script><script>self.__next_f.push([1,"75:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"e \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_ringbuf_reserve\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"rb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"76:[\"$\",\"p\",null,{\"children\":\"This section of the code attempts to reserve a block of memory from the BPF ring buffer to store event information. If it cannot reserve the memory block, it returns 0. The BPF ring buffer is used to pass event data between the eBPF program and user space.\"}]\n77:[\"$\",\"p\",null,{\"children\":\"Key point:\"}]\n78:[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"BPF Ring Buffer: The BPF ring buffer is a mechanism for passing data between eBPF programs and user space. It can be used to store event information for further processing or analysis by user space applications.\"}]}]\n"])</script><script>self.__next_f.push([1,"79:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"ip_proto \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" ip_proto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" hdr_len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"ports\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"pkt_type \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" skb\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"pkt_type\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"ifindex \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" skb\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"ifindex\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"payload_length \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" payload_length\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" payload_offset\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"payload\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" MAX_BUF_SIZE\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"offsetof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"iphdr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" saddr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"src_addr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",\"$Lec\",\" \",\"$Led\",\"$Lee\",\"$Lef\",\" \",\"$Lf0\",\"$Lf1\",\" daddr\",\"$Lf2\",\"$Lf3\",\" \",\"$Lf4\",\"$Lf5\",\"e\",\"$Lf6\",\"dst_addr\",\"$Lf7\",\"$Lf8\",\" \",\"$Lf9\",\"$Lfa\",\"$Lfb\",\"\\n\"]}],\"$Lfc\",\"$Lfd\",\"$Lfe\"]}]}]\n"])</script><script>self.__next_f.push([1,"7a:[\"$\",\"p\",null,{\"children\":[\"Finally, this code segment stores the captured event information in the \",[\"$\",\"code\",null,{\"children\":\"e\"}],\" structure and submits it to the BPF ring buffer. It includes information such as the captured IP protocol, source and destination ports, packet type, interface index, payload length, source IP address, and destination IP address. Finally, it returns the length of the packet, indicating that the packet was successfully processed.\"]}]\n7b:[\"$\",\"p\",null,{\"children\":\"This code is primarily used to store captured event information for further processing. The BPF ring buffer is used to pass this information to user space for additional handling or logging.\"}]\n7c:[\"$\",\"p\",null,{\"children\":[\"In summary, this eBPF program's main task is to capture HTTP requests. It accomplishes this by parsing the Ethernet frame, IP header, and TCP header of incoming packets to determine if they contain HTTP requests. Information about the requests is then stored in the \",[\"$\",\"code\",null,{\"children\":\"so_event\"}],\" structure and submitted to the BPF ring buffer. This is an efficient method for capturing HTTP traffic at the kernel level and is suitable for applications such as network monitoring and security analysis.\"]}]\n"])</script><script>self.__next_f.push([1,"7d:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"potential-limitations\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#potential-limitations\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Potential Limitations\"]}]\n"])</script><script>self.__next_f.push([1,"7e:[\"$\",\"p\",null,{\"children\":\"The above code has some potential limitations, and one of the main limitations is that it cannot handle URLs that span multiple packets.\"}]\n7f:[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"Cross-Packet URLs: The code checks the URL in an HTTP request by parsing a single data packet. If the URL of an HTTP request spans multiple packets, it will only examine the URL in the first packet. This can lead to missing or partially capturing long URLs that span multiple data packets.\"}]}]\n80:[\"$\",\"p\",null,{\"children\":\"To address this issue, a solution often involves reassembling multiple packets to reconstruct the complete HTTP request. This may require implementing packet caching and assembly logic within the eBPF program and waiting to collect all relevant packets until the HTTP request is detected. This adds complexity and may require additional memory to handle cases where URLs span multiple packets.\"}]\n"])</script><script>self.__next_f.push([1,"81:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"user-space-code\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#user-space-code\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"User-Space Code\"]}]\n"])</script><script>self.__next_f.push([1,"82:[\"$\",\"p\",null,{\"children\":\"The user-space code's main purpose is to create a raw socket and then attach the previously defined eBPF program in the kernel to that socket, allowing the eBPF program to capture and process network packets received on that socket. Here's an example of the user-space code:\"}]\n"])</script><script>self.__next_f.push([1,"83:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"/* Create raw socket for localhost interface */\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"sock \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"open_raw_sock\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"interface\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"sock \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    err \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"fprintf\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"stderr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Failed to open raw socket\\\\n\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"goto\"}],\" cleanup\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"/* Attach BPF program to raw socket */\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"prog_fd \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_program__fd\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skel\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"progs\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"socket_handler\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"setsockopt\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"sock\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" SOL_SOCKET\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" SO_ATTACH_BPF\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"prog_fd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"prog_fd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    err \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"fprintf\"}],\"$Lff\",\"$L100\",\"$L101\",\" \",\"$L102\",\"$L103\",\"$L104\",\"\\n\"]}],\"$L105\",\"$L106\"]}]}]\n"])</script><script>self.__next_f.push([1,"84:[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"sock = open_raw_sock(interface);\"}],\": This line of code calls a custom function \",[\"$\",\"code\",null,{\"children\":\"open_raw_sock\"}],\", which is used to create a raw socket. Raw sockets allow a user-space application to handle network packets directly without going through the protocol stack. The \",[\"$\",\"code\",null,{\"children\":\"interface\"}],\" parameter might specify the network interface from which to receive packets, determining where to capture packets from. If creating the socket fails, it returns a negative value, otherwise, it returns the file descriptor of the socket \",[\"$\",\"code\",null,{\"children\":\"sock\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":[\"If the value of \",[\"$\",\"code\",null,{\"children\":\"sock\"}],\" is less than 0, indicating a failure to open the raw socket, it sets \",[\"$\",\"code\",null,{\"children\":\"err\"}],\" to -2 and prints an error message on the standard error stream.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"prog_fd = bpf_program__fd(skel-\u003eprogs.socket_handler);\"}],\": This line of code retrieves the file descriptor of the socket filter program (\",[\"$\",\"code\",null,{\"children\":\"socket_handler\"}],\") previously defined in the eBPF program. It is necessary to attach this program to the socket. \",[\"$\",\"code\",null,{\"children\":\"skel\"}],\" is a pointer to an eBPF program object, and it provides access to the program collection.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"setsockopt(sock, SOL_SOCKET, SO_ATTACH_BPF, \u0026prog_fd, sizeof(prog_fd))\"}],\": This line of code uses the \",[\"$\",\"code\",null,{\"children\":\"setsockopt\"}],\" system call to attach the eBPF program to the raw socket. It sets the \",[\"$\",\"code\",null,{\"children\":\"SO_ATTACH_BPF\"}],\" option and passes the file descriptor of the eBPF program to the option, letting the kernel know which eBPF program to apply to this socket. If the attachment is successful, the socket starts capturing and processing network packets received on it.\"]}],[\"$\",\"li\",null,{\"children\":[\"If \",[\"$\",\"code\",null,{\"children\":\"setsockopt\"}],\" fails, it sets \",[\"$\",\"code\",null,{\"children\":\"err\"}],\" to -3 and prints an error message on the standard error stream.\"]}]]}]\n"])</script><script>self.__next_f.push([1,"85:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"compilation-and-execution\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#compilation-and-execution\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Compilation and Execution\"]}]\n"])</script><script>self.__next_f.push([1,"86:[\"$\",\"p\",null,{\"children\":[\"The complete source code can be found at \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/eunomia-bpf/bpf-developer-tutorial/tree/main/src/23-http\",\"children\":\"https://github.com/eunomia-bpf/bpf-developer-tutorial/tree/main/src/23-http\"}],\". To compile and run the code:\"]}]\n"])</script><script>self.__next_f.push([1,"87:[\"$\",\"$La1\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-console\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"$$ git submodule update --init --recursive\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"$$ make\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  BPF      .output/sockfilter.bpf.o\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  GEN-SKEL .output/sockfilter.skel.h\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  CC       .output/sockfilter.o\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  BINARY   sockfilter\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"$$ sudo ./sockfilter \\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"...\\n\"}]]}]}]\n"])</script><script>self.__next_f.push([1,"88:[\"$\",\"p\",null,{\"children\":\"In another terminal, start a simple web server using Python:\"}]\n89:[\"$\",\"$La1\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-console\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"python3 -m http.server\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"127.0.0.1 - - [18/Sep/2023 01:05:52] \\\"GET / HTTP/1.1\\\" 200 -\\n\"}]]}]}]\n8a:[\"$\",\"p\",null,{\"children\":[\"You can use \",[\"$\",\"code\",null,{\"children\":\"curl\"}],\" to make requests:\"]}]\n"])</script><script>self.__next_f.push([1,"8b:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"$$ curl http\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"//0.0.0.0:8000/\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"DOCTYPE HTML\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"html lang\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"en\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"head\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"meta charset\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"utf-8\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"title\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"Directory listing \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"for\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"/\"}],\"title\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"\\n\"]}]]}]}]\n"])</script><script>self.__next_f.push([1,"8c:[\"$\",\"p\",null,{\"children\":\"In the eBPF program, you can see that it prints the content of HTTP requests:\"}]\n"])</script><script>self.__next_f.push([1,"8d:[\"$\",\"$La1\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"code-highlight language-console\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"127.0.0.1:34552(src) -\u003e 127.0.0.1:8000(dst)\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"payload: GET / HTTP/1.1\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"Host: 0.0.0.0:8000\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"User-Agent: curl/7.88.1\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"...\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"127.0.0.1:8000(src) -\u003e 127.0.0.1:34552(dst)\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"payload: HTTP/1.0 200 OK\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"Server: SimpleHTTP/0.6 Python/3.11.4\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"...\\n\"}]]}]}]\n"])</script><script>self.__next_f.push([1,"8e:[\"$\",\"p\",null,{\"children\":\"It captures both request and response content.\"}]\n"])</script><script>self.__next_f.push([1,"8f:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"capturing-http-traffic-using-ebpf-syscall-tracepoints\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#capturing-http-traffic-using-ebpf-syscall-tracepoints\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Capturing HTTP Traffic Using eBPF Syscall Tracepoints\"]}]\n"])</script><script>self.__next_f.push([1,"90:[\"$\",\"p\",null,{\"children\":[\"eBPF provides a powerful mechanism for tracing system calls at the kernel level. In this example, we'll use eBPF to trace the \",[\"$\",\"code\",null,{\"children\":\"accept\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"read\"}],\" system calls to capture HTTP traffic. Due to space limitations, we'll provide a brief overview of the code framework.\"]}]\n"])</script><script>self.__next_f.push([1,"91:[\"$\",\"$La1\",null,{\"className\":\"language-c\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-c code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__uint\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"type\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" BPF_MAP_TYPE_HASH\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__uint\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"max_entries\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4096\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__type\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" u64\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__type\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"value\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"accept_args_t\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" active_accept_args_map \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\".maps\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Define a tracepoint at the entry of the accept system call\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"tracepoint/syscalls/sys_enter_accept\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"sys_enter_accept\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"trace_event_raw_sys_enter\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    u64 id \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_get_current_pid_tgid\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ... Get and store the arguments of the accept call\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_map_update_elem\"}],\"$L107\",\"$L108\",\"active_accept_args_map\",\"$L109\",\" \",\"$L10a\",\"id\",\"$L10b\",\" \",\"$L10c\",\"accept_args\",\"$L10d\",\" BPF_ANY\",\"$L10e\",\"$L10f\",\"\\n\"]}],\"$L110\",\"$L111\",\"$L112\",\"$L113\",\"$L114\",\"$L115\",\"$L116\",\"$L117\",\"$L118\",\"$L119\",\"$L11a\",\"$L11b\",\"$L11c\",\"$L11d\",\"$L11e\",\"$L11f\",\"$L120\",\"$L121\",\"$L122\",\"$L123\",\"$L124\",\"$L125\",\"$L126\",\"$L127\",\"$L128\",\"$L129\",\"$L12a\",\"$L12b\",\"$L12c\",\"$L12d\",\"$L12e\",\"$L12f\",\"$L130\",\"$L131\",\"$L132\",\"$L133\",\"$L134\",\"$L135\",\"$L136\",\"$L137\",\"$L138\",\"$L139\",\"$L13a\",\"$L13b\",\"$L13c\",\"$L13d\",\"$L13e\",\"$L13f\",\"$L140\",\"$L141\",\"$L142\",\"$L143\",\"$L144\",\"$L145\",\"$L146\",\"$L147\",\"$L148\",\"$L149\",\"$L14a\",\"$L14b\",\"$L14c\",\"$L14d\",\"$L14e\",\"$L14f\",\"$L150\",\"$L151\",\"$L152\",\"$L153\",\"$L154\"]}]}]\n"])</script><script>self.__next_f.push([1,"92:[\"$\",\"p\",null,{\"children\":\"This code briefly demonstrates how to use eBPF to trace system calls in the Linux kernel to capture HTTP traffic. Here's a detailed explanation of the hook locations and the flow, as well as the complete set of system calls that need to be hooked for comprehensive request tracing:\"}]\n"])</script><script>self.__next_f.push([1,"93:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"hook-locations-and-flow\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#hook-locations-and-flow\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Hook Locations and Flow\"]}]\n"])</script><script>self.__next_f.push([1,"94:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"The code uses eBPF Tracepoint functionality. Specifically, it defines a series of eBPF programs and binds them to specific system call Tracepoints to capture entry and exit events of these system calls.\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[\"First, it defines two eBPF hash maps (\",[\"$\",\"code\",null,{\"children\":\"active_accept_args_map\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"active_read_args_map\"}],\") to store system call parameters. These maps are used to track \",[\"$\",\"code\",null,{\"children\":\"accept\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"read\"}],\" system calls.\"]}]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":\"Next, it defines multiple Tracepoint tracing programs, including:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"sys_enter_accept\"}],\": Defined at the entry of the \",[\"$\",\"code\",null,{\"children\":\"accept\"}],\" system call, used to capture the arguments of the \",[\"$\",\"code\",null,{\"children\":\"accept\"}],\" system call and store them in the hash map.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"sys_exit_accept\"}],\": Defined at the exit of the \",[\"$\",\"code\",null,{\"children\":\"accept\"}],\" system call, used to process the result of the \",[\"$\",\"code\",null,{\"children\":\"accept\"}],\" system call, including obtaining and storing the new socket file descriptor and related connection information.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"sys_enter_read\"}],\": Defined at the entry of the \",[\"$\",\"code\",null,{\"children\":\"read\"}],\" system call, used to capture the arguments of the \",[\"$\",\"code\",null,{\"children\":\"read\"}],\" system call and store them in the hash map.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"sys_exit_read\"}],\": Defined at the exit of the \",[\"$\",\"code\",null,{\"children\":\"read\"}],\" system call, used to process the result of the \",[\"$\",\"code\",null,{\"children\":\"read\"}],\" system call, including checking if the read data is HTTP traffic and sending events.\"]}]]}]]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"p\",null,{\"children\":[\"In \",[\"$\",\"code\",null,{\"children\":\"sys_exit_accept\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"sys_exit_read\"}],\", there is also some data processing and event sending logic, such as checking if the data is an HTTP connection, assembling event data, and using \",[\"$\",\"code\",null,{\"children\":\"bpf_perf_event_output\"}],\" to send events to user space for further processing.\"]}]}]]}]\n"])</script><script>self.__next_f.push([1,"95:[\"$\",\"h3\",null,{\"className\":\"content-header\",\"id\":\"complete-set-of-system-calls-to-hook\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#complete-set-of-system-calls-to-hook\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Complete Set of System Calls to Hook\"]}]\n"])</script><script>self.__next_f.push([1,"96:[\"$\",\"p\",null,{\"children\":\"To fully implement HTTP request tracing, the system calls that typically need to be hooked include:\"}]\n"])</script><script>self.__next_f.push([1,"97:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"socket\"}],\": Used to capture socket creation for tracking new connections.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"bind\"}],\": Used to obtain port information where the socket is bound.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"listen\"}],\": Used to start listening for connection requests.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"accept\"}],\": Used to accept connection requests and obtain new socket file descriptors.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"read\"}],\": Used to capture received data and check if it contains HTTP requests.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"write\"}],\": Used to capture sent data and check if it contains HTTP responses.\"]}]]}]\n"])</script><script>self.__next_f.push([1,"98:[\"$\",\"p\",null,{\"children\":[\"The provided code already covers the tracing of \",[\"$\",\"code\",null,{\"children\":\"accept\"}],\" and \",[\"$\",\"code\",null,{\"children\":\"read\"}],\" system calls. To complete HTTP request tracing, additional system calls need to be hooked, and corresponding logic needs to be implemented to handle the parameters and results of these system calls.\"]}]\n99:[\"$\",\"p\",null,{\"children\":[\"The complete source code can be found at \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/eunomia-bpf/bpf-developer-tutorial/tree/main/src/23-http\",\"children\":\"https://github.com/eunomia-bpf/bpf-developer-tutorial/tree/main/src/23-http\"}],\".\"]}]\n"])</script><script>self.__next_f.push([1,"9a:[\"$\",\"h2\",null,{\"className\":\"content-header\",\"id\":\"summary\",\"children\":[[\"$\",\"a\",null,{\"className\":\"break-words\",\"href\":\"#summary\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"content-header-link\",\"children\":[\"$\",\"svg\",null,{\"className\":\"h-5 linkicon w-5\",\"fill\":\"currentColor\",\"viewBox\":\"0 0 20 20\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"children\":[[\"$\",\"path\",null,{\"d\":\"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z\"}],[\"$\",\"path\",null,{\"d\":\"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z\"}]]}]}]}],\"Summary\"]}]\n"])</script><script>self.__next_f.push([1,"9b:[\"$\",\"p\",null,{\"children\":\"In today's complex technological landscape, system observability has become crucial, especially in the context of microservices and cloud-native applications. This article explores how to leverage eBPF technology for tracing the seven-layer protocols, along with the challenges and solutions that may arise in this process. Here's a summary of the content covered in this article:\"}]\n"])</script><script>self.__next_f.push([1,"9c:[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Introduction\"}],\":\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Modern applications often consist of multiple microservices and distributed components, making it essential to observe the behavior of the entire system.\"}],[\"$\",\"li\",null,{\"children\":\"Seven-layer protocols (such as HTTP, gRPC, MQTT, etc.) provide detailed insights into application interactions, but monitoring these protocols can be challenging.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Role of eBPF Technology\"}],\":\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"eBPF allows developers to dive deep into the kernel layer for real-time observation and analysis of system behavior without modifying or inserting application code.\"}],[\"$\",\"li\",null,{\"children\":\"eBPF technology offers a powerful tool for monitoring seven-layer protocols, especially in a microservices environment.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Tracing Seven-Layer Protocols\"}],\":\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"The article discusses the challenges of tracing seven-layer protocols, including their complexity and dynamism.\"}],[\"$\",\"li\",null,{\"children\":\"Traditional network monitoring tools struggle with the complexity of seven-layer protocols.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Applications of eBPF\"}],\":\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"eBPF provides two primary methods for tracing seven-layer protocols: socket filters and syscall tracing.\"}],[\"$\",\"li\",null,{\"children\":\"Both of these methods help capture network request data for protocols like HTTP and analyze them.\"}]]}]]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"eBPF Practical Tutorial\"}],\":\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"The article provides a practical eBPF tutorial demonstrating how to capture and analyze HTTP traffic using eBPF socket filters or syscall tracing.\"}],[\"$\",\"li\",null,{\"children\":\"The tutorial covers the development of eBPF programs, the use of the eBPF toolchain, and the implementation of HTTP request tracing.\"}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"9d:[\"$\",\"p\",null,{\"children\":[\"Through this article, readers can gain a deep understanding of how to use eBPF technology for tracing seven-layer protocols, particularly HTTP traffic. This knowledge will help enhance the monitoring and analysis of network traffic, thereby improving application performance and security. If you're interested in learning more about eBPF and its practical applications, you can visit our tutorial code repository at \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/eunomia-bpf/bpf-developer-tutorial\",\"children\":\"https://github.com/eunomia-bpf/bpf-developer-tutorial\"}],\" or our website at \",[\"$\",\"a\",null,{\"className\":\"break-words\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://eunomia.dev/tutorials/\",\"children\":\"https://eunomia.dev/tutorials/\"}],\" for more examples and complete tutorials.\"]}]\n"])</script><script>self.__next_f.push([1,"9e:[\"$\",\"div\",null,{\"className\":\"pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300 glass p-4 rounded-xl\",\"children\":[[\"$\",\"a\",null,{\"className\":\"hover:text-primary-600 dark:hover:text-primary-400 transition-colors\",\"target\":\"_blank\",\"rel\":\"nofollow\",\"href\":\"https://mobile.twitter.com/search?q=https%3A%2F%2Fwww.yunwei37.com%2Fblog%2FL7%20Tracing%20with%20eBPF\",\"children\":\"Discuss on Twitter\"}],\" • \",[\"$\",\"a\",null,{\"className\":\"hover:text-primary-600 dark:hover:text-primary-400 transition-colors\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://github.com/yunwei37/my-new-blog/blob/main/data/blog/L7 Tracing with eBPF.mdx\",\"children\":\"View on GitHub\"}]]}]\n9f:[\"$\",\"div\",null,{\"className\":\"pt-6 pb-6 text-center text-gray-700 dark:text-gray-300 glass p-6 rounded-xl\",\"id\":\"comment\",\"children\":[\"$\",\"$L155\",null,{\"slug\":\"L7 Tracing with eBPF\"}]}]\n"])</script><script>self.__next_f.push([1,"a0:[\"$\",\"footer\",null,{\"children\":[[\"$\",\"div\",null,{\"className\":\"divide-gray-200/30 text-sm leading-5 font-medium xl:col-start-1 xl:row-start-2 xl:divide-y dark:divide-gray-700/30\",\"children\":[[\"$\",\"div\",null,{\"className\":\"py-4 xl:py-8\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-4\",\"children\":\"Tags\"}],[\"$\",\"div\",null,{\"className\":\"flex flex-wrap gap-2\",\"children\":[[\"$\",\"$L6\",\"notes\",{\"href\":\"/tags/notes\",\"className\":\"inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50\",\"children\":\"notes\"}],[\"$\",\"$L6\",\"gpt\",{\"href\":\"/tags/gpt\",\"className\":\"inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50\",\"children\":\"gpt\"}],[\"$\",\"$L6\",\"ai\",{\"href\":\"/tags/ai\",\"className\":\"inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50\",\"children\":\"ai\"}]]}]]}],[\"$\",\"div\",null,{\"className\":\"flex justify-between py-4 xl:block xl:space-y-6 xl:py-8\",\"children\":[[\"$\",\"div\",null,{\"className\":\"glass p-4 rounded-xl\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-2\",\"children\":\"Previous Article\"}],[\"$\",\"div\",null,{\"className\":\"text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors\",\"children\":[\"$\",\"$L6\",null,{\"className\":\"break-words\",\"href\":\"/blog/gpt-best-practice\",\"children\":\"OpenAI 新发布GPT 最佳实践：落地大模型应用的策略和战术\"}]}]]}],[\"$\",\"div\",null,{\"className\":\"glass p-4 rounded-xl\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-2\",\"children\":\"Next Article\"}],[\"$\",\"div\",null,{\"className\":\"text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors\",\"children\":[\"$\",\"$L6\",null,{\"className\":\"break-words\",\"href\":\"/blog/ebpf-app-store\",\"children\":\"eBPF 软件应用市场设计方案\"}]}]]}]]}]]}],[\"$\",\"div\",null,{\"className\":\"pt-4 xl:pt-8\",\"children\":[\"$\",\"$L6\",null,{\"className\":\"inline-flex items-center glass px-4 py-2 rounded-xl text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-all duration-200 hover:scale-105\",\"href\":\"/blog\",\"aria-label\":\"Back to the blog\",\"children\":\"← Back to the blog\"}]}]]}]\n"])</script><script>self.__next_f.push([1,"a2:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}]\na3:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\na4:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\na5:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\na6:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"ip_is_fragment\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\na7:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\na8:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\na9:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ip4 header lengths are variable\"}],\"\\n\"]}]\naa:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// access ihl as a u8 (linux/include/linux/skbuff.h)\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"ab:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ETH_HLEN\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"hdr_len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"hdr_len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"ac:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0x0f\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\nad:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\nae:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\naf:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"/* verify hlen meets minimum size requirements */\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"b0:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"iphdr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"b1:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\nb2:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\nb3:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\nb4:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n"])</script><script>self.__next_f.push([1,"b5:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"offsetof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"iphdr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" protocol\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"ip_proto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"b6:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\nb7:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"ip_proto \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" IPPROTO_TCP\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\nb8:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\nb9:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\nba:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\nbb:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\nbc:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    tcp_hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" hdr_len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"bd:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"verlen\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"be:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"offsetof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"iphdr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" tot_len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"tlen\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"tlen\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"bf:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\nc0:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u8 doff\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"c1:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" tcp_hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"offsetof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"__tcphdr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" ack_seq\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"doff\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"doff\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// read the first byte past __tcphdr-\u003eack_seq, we can't do offsetof bit fields\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"c2:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    doff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0xf0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// clean-up res1\"}],\"\\n\"]}]\nc3:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    doff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\u003e=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// move the upper 4 bits to low\"}],\"\\n\"]}]\nc4:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    doff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// convert to bytes length\"}],\"\\n\"]}]\nc5:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\nc6:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    payload_offset \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" ETH_HLEN \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" doff\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\nc7:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    payload_length \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__bpf_ntohs\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"tlen\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\" hdr_len \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],"])</script><script>self.__next_f.push([1,"\" doff\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\nc8:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\nc9:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\nca:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"payload_length \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"||\"}],\" payload_offset \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\ncb:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\ncc:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\ncd:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\nce:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" payl"])</script><script>self.__next_f.push([1,"oad_offset\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"cf:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_printk\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"%d len %d buffer: %s\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" payload_offset\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" payload_length\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"d0:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_strncmp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"GET\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"d1:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_strncmp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"POST\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"d2:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_strncmp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"PUT\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"d3:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_strncmp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"6\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"DELETE\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\u0026\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"d4:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_strncmp\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"HTTP\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"d5:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\nd6:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\nd7:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\nd8:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\nd9:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"/* reserve sample from BPF ringbuf */\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"da:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    e \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_ringbuf_reserve\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"rb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"db:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\ndc:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\ndd:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\nde:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"ip_proto \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" ip_proto\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"df:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" hdr_len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"ports\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"e0:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"pkt_type \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" skb\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"pkt_type\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\ne1:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"ifindex \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" skb\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"ifindex\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\ne2:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\ne3:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"payload_length \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" payload_length\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\ne4:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" payload_offset\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"payload\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" MAX_BUF_SIZE\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\ne5:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n"])</script><script>self.__next_f.push([1,"e6:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"offsetof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"iphdr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" saddr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"src_addr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"e7:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_skb_load_bytes\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"skb\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" nhoff \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"offsetof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"iphdr\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" daddr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"dst_addr\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"e8:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_ringbuf_submit\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\ne9:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\nea:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" skb\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\neb:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\nec:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"+\"}]\ned:[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"offsetof\"}]\nee:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}]\nef:[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}]\nf0:[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"iphdr\"}]\nf1:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}]\nf2:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\nf3:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}]\nf4:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}]\nf5:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}]\nf6:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}]\nf7:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\nf8:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}]\nf9:[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}]\nfa:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\nfb:[\"$\",\"span\",null,{\"className\""])</script><script>self.__next_f.push([1,":\"token punctuation\",\"children\":\";\"}]\nfc:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_ringbuf_submit\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"e\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\nfd:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\nfe:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" skb\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"len\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\nff:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}]\n100:[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"stderr\"}]\n101:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}]\n102:[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Failed to attach to raw socket\\\\n\\\"\"}]\n103:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\n104:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n105:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"goto\"}],\" cleanup\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n106:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n107:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}]\n108:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}]\n109:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}]\n10a:[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}]\n10b:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}]\n10c:[\"$\",\"span\",null,{\"class"])</script><script>self.__next_f.push([1,"Name\":\"token operator\",\"children\":\"\u0026\"}]\n10d:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}]\n10e:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]\n10f:[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}]\n110:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n111:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n112:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n113:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Define a tracepoint at the exit of the accept system call\"}],\"\\n\"]}]\n114:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"tracepoint/syscalls/sys_exit_accept\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n115:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"sys_exit_accept\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"trace_event_raw_sys_exit\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n116:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\n117:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children"])</script><script>self.__next_f.push([1,"\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ... Process the result of the accept call\"}],\"\\n\"]}]\n118:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"accept_args_t\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"args \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"\\n\"]}]\n119:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_map_lookup_elem\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"active_accept_args_map\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n11a:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ... Get and store the socket file descriptor obtained from the accept call\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"11b:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    __u64 pid_fd \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"__u64\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"pid \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\u003c\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"32\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"u32\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"ret_fd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"11c:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_map_update_elem\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"conn_info_map\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"pid_fd\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"conn_info\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" BPF_ANY\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"11d:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ...\"}],\"\\n\"]}]\n11e:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n11f:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n120:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\"\\n\"]}]\n121:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\n122:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__uint\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"type\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" BPF_MAP_TYPE_HASH\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n123:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__uint\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"max_entries\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4096\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n124:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"__type\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"key\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" u64\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n125:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"class"])</script><script>self.__next_f.push([1,"Name\":\"token function\",\"children\":\"__type\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"value\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"data_args_t\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n126:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" active_read_args_map \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\".maps\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n127:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n128:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Define a tracepoint at the entry of the read system call\"}],\"\\n\"]}]\n129:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"tracepoint/syscalls/sys_enter_read\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n12a:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"sys_enter_read\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"trace_event_raw_sys_enter\"}],\" \",[\"$\",\"span\",null,{\""])</script><script>self.__next_f.push([1,"className\":\"token operator\",\"children\":\"*\"}],\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n12b:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\n12c:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ... Get and store the arguments of the read call\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"12d:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_map_update_elem\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"active_read_args_map\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"read_args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" BPF_ANY\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"12e:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n12f:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n130:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n131:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Helper function to check if it's an HTTP connection\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"132:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"static\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"inline\"}],\" bool \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"is_http_connection\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" u64 bytes_count\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"133:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\n134:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ... Check if the data is an HTTP request or response\"}],\"\\n\"]}]\n135:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n136:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n137:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Helper function to process the read data\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"138:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"static\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"inline\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"void\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"process_data\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"trace_event_raw_sys_exit\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"139:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                                u64 id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"data_args_t\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" u64 bytes_count\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n13a:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\n13b:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ... Process the read data, check if it's HTTP traffic, and send events\"}],\"\\n\"]}]\n13c:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"is_http_connection\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"line_buffer\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" bytes_count\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n13d:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\n13e:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ...\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"13f:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_probe_read_kernel\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"event\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"msg\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" read_size\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" args\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\u003e\"}],\"buf\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"140:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ...\"}],\"\\n\"]}]\n141:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_perf_event_output\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"events\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" BPF_F_CURRENT_CPU\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"142:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                              \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"event\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"sizeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"socket_data_event_t\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"143:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n144:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n145:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n146:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Define a tracepoint at the exit of the read system call\"}],\"\\n\"]}]\n147:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"tracepoint/syscalls/sys_exit_read\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n148:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"int\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"sys_exit_read\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"trace_event_raw_sys_exit\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n149:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\n14a:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ... Process the result of the read call\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"14b:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"struct\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"data_args_t\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"*\"}],\"read_args \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"bpf_map_lookup_elem\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"active_read_args_map\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"14c:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"read_args \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"!=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"NULL\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]\n14d:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}]\n14e:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"process_data\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"ctx\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" read_args\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" bytes_count\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n14f:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n150:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ...\"}],\"\\n\"]}]\n151:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n152:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]\n153:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}]\n"])</script><script>self.__next_f.push([1,"154:[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"char\"}],\" _license\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SEC\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"license\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"GPL\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]\n"])</script><script>self.__next_f.push([1,"23:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n1f:null\n"])</script><script>self.__next_f.push([1,"21:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"L7 Tracing with eBPF: HTTP and Beyond via Socket Filters and Syscall Tracing | 云微的胡思乱想\"}],[\"$\",\"meta\",\"1\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"2\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"3\",{\"rel\":\"canonical\",\"href\":\"https://www.yunwei37.com/blog/L7%20Tracing%20with%20eBPF\"}],[\"$\",\"link\",\"4\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"https://www.yunwei37.com/feed.xml\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"L7 Tracing with eBPF: HTTP and Beyond via Socket Filters and Syscall Tracing\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:url\",\"content\":\"https://www.yunwei37.com/blog/L7%20Tracing%20with%20eBPF\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:site_name\",\"content\":\"云微的胡思乱想\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:image\",\"content\":\"https://www.yunwei37.com/static/images/twitter-card.png\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"11\",{\"property\":\"article:published_time\",\"content\":\"2023-06-14T02:41:06.000Z\"}],[\"$\",\"meta\",\"12\",{\"property\":\"article:modified_time\",\"content\":\"2023-06-14T02:41:06.000Z\"}],[\"$\",\"meta\",\"13\",{\"property\":\"article:author\",\"content\":\"Yusheng Zheng (云微)\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:title\",\"content\":\"L7 Tracing with eBPF: HTTP and Beyond via Socket Filters and Syscall Tracing\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:image\",\"content\":\"https://www.yunwei37.com/static/images/twitter-card.png\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"26:\"$21:metadata\"\n"])</script></body></html>