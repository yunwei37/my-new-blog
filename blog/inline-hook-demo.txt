1:"$Sreact.fragment"
2:I[1478,["874","static/chunks/874-8edb22cc7428423c.js","650","static/chunks/650-5c537ecaa5d1cd34.js","177","static/chunks/app/layout-1a2cfbd13c591174.js"],"ThemeProviders"]
3:I[4091,["874","static/chunks/874-8edb22cc7428423c.js","650","static/chunks/650-5c537ecaa5d1cd34.js","177","static/chunks/app/layout-1a2cfbd13c591174.js"],"default"]
4:I[9243,["874","static/chunks/874-8edb22cc7428423c.js","650","static/chunks/650-5c537ecaa5d1cd34.js","177","static/chunks/app/layout-1a2cfbd13c591174.js"],""]
5:I[7392,["874","static/chunks/874-8edb22cc7428423c.js","650","static/chunks/650-5c537ecaa5d1cd34.js","177","static/chunks/app/layout-1a2cfbd13c591174.js"],"KBarSearchProvider"]
6:I[6874,["874","static/chunks/874-8edb22cc7428423c.js","63","static/chunks/63-d245e42a784ca56d.js","909","static/chunks/app/blog/%5B...slug%5D/page-71c7cfee63112339.js"],""]
e:I[8393,[],""]
:HL["/_next/static/media/36966cca54120369-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/css/a06d7e24bf9a7d93.css","style"]
:HL["/_next/static/css/54f53e18fb3a4e82.css","style"]
:HL["/_next/static/css/7246298b30c42979.css","style"]
0:{"P":null,"b":"ER0GCm_u0u-RRwl37uz71","p":"","c":["","blog","inline-hook-demo"],"i":false,"f":[[["",{"children":["blog",{"children":[["slug","inline-hook-demo","c"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/a06d7e24bf9a7d93.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/54f53e18fb3a4e82.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en-us","className":"__variable_dd5b2f scroll-smooth","suppressHydrationWarning":true,"children":[["$","link",null,{"rel":"apple-touch-icon","sizes":"76x76","href":"/static/favicons/apple-touch-icon.png"}],["$","link",null,{"rel":"icon","type":"image/svg+xml","href":"/static/favicons/favicon.svg"}],["$","link",null,{"rel":"icon","type":"image/png","sizes":"32x32","href":"/static/favicons/favicon-32x32.png"}],["$","link",null,{"rel":"icon","type":"image/png","sizes":"16x16","href":"/static/favicons/favicon-16x16.png"}],["$","link",null,{"rel":"manifest","href":"/static/favicons/site.webmanifest"}],["$","link",null,{"rel":"mask-icon","href":"/static/favicons/safari-pinned-tab.svg","color":"#5bbad5"}],["$","meta",null,{"name":"msapplication-TileColor","content":"#000000"}],["$","meta",null,{"name":"theme-color","media":"(prefers-color-scheme: light)","content":"#fff"}],["$","meta",null,{"name":"theme-color","media":"(prefers-color-scheme: dark)","content":"#000"}],["$","link",null,{"rel":"alternate","type":"application/rss+xml","href":"/feed.xml"}],["$","body",null,{"className":"pl-[calc(100vw-100%)] text-black antialiased dark:text-white min-h-screen","children":["$","$L2",null,{"children":[["$","$L3",null,{}],["$undefined","$undefined","$undefined",["$","$L4",null,{"async":true,"defer":true,"src":"https://analytics.umami.is/script.js"}],"$undefined","$undefined"],["$","div",null,{"className":"min-h-screen flex flex-col justify-center py-8","children":["$","div",null,{"className":"content-glass mx-auto w-full max-w-5xl px-4 sm:px-6 xl:px-8 py-8","children":["$","$L5",null,{"kbarConfig":{"searchDocumentsPath":"/search.json"},"children":[["$","header",null,{"className":"flex items-center w-full justify-between py-6 border-b border-gray-200/30 dark:border-gray-700/30","children":[["$","$L6",null,{"className":"break-words","href":"/","aria-label":"yunwei37","children":["$","div",null,{"className":"flex items-center","children":[["$","div",null,{"className":"mr-3","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":40,"height":40,"fill":"none","children":[["$","defs",null,{"children":[["$","linearGradient",null,{"id":"logo_svg__a","x1":"0%","x2":"100%","y1":"0%","y2":"100%","children":[["$","stop",null,{"offset":"0%","style":{"stopColor":"#3b82f6","stopOpacity":1}}],["$","stop",null,{"offset":"100%","style":{"stopColor":"#06b6d4","stopOpacity":1}}]]}],["$","linearGradient",null,{"id":"logo_svg__b","x1":"0%","x2":"100%","y1":"0%","y2":"100%","children":[["$","stop",null,{"offset":"0%","style":{"stopColor":"#8b5cf6","stopOpacity":1}}],["$","stop",null,{"offset":"100%","style":{"stopColor":"#3b82f6","stopOpacity":1}}]]}]]}],["$","circle",null,{"cx":20,"cy":20,"r":18,"fill":"url(#logo_svg__a)","opacity":0.1}],["$","path",null,{"fill":"url(#logo_svg__a)","d":"m12 8 6 10v10h4V18l6-10h-4l-4 6-4-6Z"}],["$","path",null,{"fill":"url(#logo_svg__b)","d":"m8 24 4 8 4-8 4 8 4-8h8v4h-6l-4 8-4-8-4 8-4-8H8Z","opacity":0.8}],["$","circle",null,{"cx":32,"cy":12,"r":2,"fill":"url(#logo_svg__b)"}],["$","circle",null,{"cx":8,"cy":12,"r":1.5,"fill":"url(#logo_svg__a)","opacity":0.6}]]}]}],["$","div",null,{"className":"hidden text-2xl font-bold sm:block hover:text-primary-600 dark:hover:text-primary-400 transition-colors","children":"yunwei37"}]]}]}],["$","div",null,{"className":"flex items-center space-x-4","children":[["$","div",null,{"className":"no-scrollbar hidden items-center space-x-2 sm:flex","children":[["$","$L6","Blog",{"className":"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400","href":"/blog","children":"Blog"}],["$","$L6","Docs",{"className":"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400","href":"/docs","children":"Docs"}],["$","$L6","Tags",{"className":"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400","href":"/tags","children":"Tags"}],["$","$L6","About",{"className":"px-3 py-2 rounded-lg transition-all duration-200 font-medium hover:text-primary-600 dark:hover:text-primary-400","href":"/about","children":"About"}]]}],"$L7"]}]]}],"$L8","$L9"]}]}]}]]}]}]]}]]}],{"children":["blog","$La",{"children":[["slug","inline-hook-demo","c"],"$Lb",{"children":["__PAGE__","$Lc",{},null,false]},null,false]},null,false]},null,false],"$Ld",false]],"m":"$undefined","G":["$e",[]],"s":false,"S":true}
f:I[4159,["874","static/chunks/874-8edb22cc7428423c.js","650","static/chunks/650-5c537ecaa5d1cd34.js","177","static/chunks/app/layout-1a2cfbd13c591174.js"],"KBarButton"]
10:I[1762,["874","static/chunks/874-8edb22cc7428423c.js","650","static/chunks/650-5c537ecaa5d1cd34.js","177","static/chunks/app/layout-1a2cfbd13c591174.js"],"default"]
11:I[7298,["874","static/chunks/874-8edb22cc7428423c.js","650","static/chunks/650-5c537ecaa5d1cd34.js","177","static/chunks/app/layout-1a2cfbd13c591174.js"],"default"]
12:I[7555,[],""]
13:I[1295,[],""]
1e:I[9665,[],"OutletBoundary"]
20:I[4911,[],"AsyncMetadataOutlet"]
22:I[9665,[],"ViewportBoundary"]
24:I[9665,[],"MetadataBoundary"]
25:"$Sreact.suspense"
7:["$","div",null,{"className":"flex items-center space-x-2","children":[["$","$Lf",null,{"aria-label":"Search","className":"p-2 rounded-lg transition-all duration-200","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":1.5,"stroke":"currentColor","className":"h-6 w-6 hover:text-primary-600 dark:hover:text-primary-400 transition-colors","children":["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"}]}]}],["$","$L10",null,{}],["$","$L11",null,{}]]}]
8:["$","main",null,{"className":"py-6","children":["$","$L12",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L13",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[["$","div",null,{"className":"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6","children":[["$","div",null,{"className":"space-x-2 pt-6 pb-8 md:space-y-5","children":["$","h1",null,{"className":"text-6xl leading-9 font-extrabold tracking-tight md:border-r-2 md:px-6 md:text-8xl md:leading-14","children":"404"}]}],["$","div",null,{"className":"max-w-md","children":[["$","p",null,{"className":"mb-4 text-xl leading-normal font-bold md:text-2xl","children":"Sorry we couldn't find this page."}],["$","p",null,{"className":"mb-8","children":"But dont worry, you can find plenty of other things on our homepage."}],["$","$L6",null,{"className":"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm leading-5 font-medium text-white shadow-xs transition-colors duration-150 hover:bg-blue-700 focus:outline-hidden dark:hover:bg-blue-500","href":"/","children":"Back to homepage"}]]}]]}],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]
9:["$","footer",null,{"className":"border-t border-gray-200/30 dark:border-gray-700/30 pt-8","children":["$","div",null,{"className":"flex flex-col items-center space-y-6","children":[["$","div",null,{"className":"flex flex-wrap justify-center gap-4","children":[["$","a",null,{"className":"text-sm text-gray-500 transition hover:text-gray-600","target":"_blank","rel":"noopener noreferrer","href":"mailto:yunwei356@gmail.com","children":[["$","span",null,{"className":"sr-only","children":"mail"}],["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 20 20","className":"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6","children":[["$","title",null,{"children":"Mail"}],["$","path",null,{"d":"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"}],["$","path",null,{"d":"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"}]]}]]}],["$","a",null,{"className":"text-sm text-gray-500 transition hover:text-gray-600","target":"_blank","rel":"noopener noreferrer","href":"https://github.com/yunwei37","children":[["$","span",null,{"className":"sr-only","children":"github"}],["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 24 24","className":"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6","children":[["$","title",null,{"children":"GitHub"}],["$","path",null,{"d":"M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"}]]}]]}],["$","a",null,{"className":"text-sm text-gray-500 transition hover:text-gray-600","target":"_blank","rel":"noopener noreferrer","href":"https://facebook.com","children":[["$","span",null,{"className":"sr-only","children":"facebook"}],["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 24 24","className":"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6","children":[["$","title",null,{"children":"Facebook"}],["$","path",null,{"d":"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"}]]}]]}],["$","a",null,{"className":"text-sm text-gray-500 transition hover:text-gray-600","target":"_blank","rel":"noopener noreferrer","href":"https://youtube.com","children":[["$","span",null,{"className":"sr-only","children":"youtube"}],["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 24 24","className":"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6","children":[["$","title",null,{"children":"Youtube"}],["$","path",null,{"d":"M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z"}]]}]]}],"$L14","$L15","$L16","$L17","$L18","$L19","$L1a"]}],"$L1b","$L1c"]}]}]
a:["$","$1","c",{"children":[null,["$","$L12",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L13",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}]
b:["$","$1","c",{"children":[null,["$","$L12",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L13",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}]
c:["$","$1","c",{"children":["$L1d",[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/7246298b30c42979.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$L1e",null,{"children":["$L1f",["$","$L20",null,{"promise":"$@21"}]]}]]}]
d:["$","$1","h",{"children":[null,[["$","$L22",null,{"children":"$L23"}],["$","meta",null,{"name":"next-size-adjust","content":""}]],["$","$L24",null,{"children":["$","div",null,{"hidden":true,"children":["$","$25",null,{"fallback":null,"children":"$L26"}]}]}]]}]
14:["$","a",null,{"className":"text-sm text-gray-500 transition hover:text-gray-600","target":"_blank","rel":"noopener noreferrer","href":"https://www.linkedin.com/in/yusheng-zheng-611920280","children":[["$","span",null,{"className":"sr-only","children":"linkedin"}],["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 24 24","className":"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6","children":[["$","title",null,{"children":"Linkedin"}],["$","path",null,{"d":"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"}]]}]]}]
15:null
16:["$","a",null,{"className":"text-sm text-gray-500 transition hover:text-gray-600","target":"_blank","rel":"noopener noreferrer","href":"https://bsky.app/","children":[["$","span",null,{"className":"sr-only","children":"bluesky"}],["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 24 24","className":"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6","children":[["$","title",null,{"children":"Bluesky"}],["$","path",null,{"d":"M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565C.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479c.815 2.736 3.713 3.66 6.383 3.364q.204-.03.415-.056q-.207.033-.415.056c-3.912.58-7.387 2.005-2.83 7.078c5.013 5.19 6.87-1.113 7.823-4.308c.953 3.195 2.05 9.271 7.733 4.308c4.267-4.308 1.172-6.498-2.74-7.078a9 9 0 0 1-.415-.056q.21.026.415.056c2.67.297 5.568-.628 6.383-3.364c.246-.828.624-5.79.624-6.478c0-.69-.139-1.861-.902-2.206c-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8"}]]}]]}]
17:["$","a",null,{"className":"text-sm text-gray-500 transition hover:text-gray-600","target":"_blank","rel":"noopener noreferrer","href":"https://x.com/yunwei37","children":[["$","span",null,{"className":"sr-only","children":"x"}],["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 24 24","className":"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6","children":[["$","title",null,{"children":"X"}],["$","path",null,{"d":"M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"}]]}]]}]
27:T69f,M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z18:["$","a",null,{"className":"text-sm text-gray-500 transition hover:text-gray-600","target":"_blank","rel":"noopener noreferrer","href":"https://www.instagram.com","children":[["$","span",null,{"className":"sr-only","children":"instagram"}],["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 24 24","className":"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6","children":[["$","title",null,{"children":"Instagram"}],["$","path",null,{"d":"$27"}]]}]]}]
28:T498,M12.186 24h-.007c-3.581-.024-6.334-1.205-8.184-3.509C2.35 18.44 1.5 15.586 1.472 12.01v-.017c.03-3.579.879-6.43 2.525-8.482C5.845 1.205 8.6.024 12.18 0h.014c2.746.02 5.043.725 6.826 2.098 1.677 1.29 2.858 3.13 3.509 5.467l-2.04.569c-1.104-3.96-3.898-5.984-8.304-6.015-2.91.022-5.11.936-6.54 2.717C4.307 6.504 3.616 8.914 3.589 12c.027 3.086.718 5.496 2.057 7.164 1.43 1.783 3.631 2.698 6.54 2.717 2.623-.02 4.358-.631 5.8-2.045 1.647-1.613 1.618-3.593 1.09-4.798-.31-.71-.873-1.3-1.634-1.75-.192 1.352-.622 2.446-1.284 3.272-.886 1.102-2.14 1.704-3.73 1.79-1.202.065-2.361-.218-3.259-.801-1.063-.689-1.685-1.74-1.752-2.964-.065-1.19.408-2.285 1.33-3.082.88-.76 2.119-1.207 3.583-1.291a13.853 13.853 0 0 1 3.02.142c-.126-.742-.375-1.332-.75-1.757-.513-.586-1.308-.883-2.359-.89h-.029c-.844 0-1.992.232-2.721 1.32L7.734 7.847c.98-1.454 2.568-2.256 4.478-2.256h.044c3.194.02 5.097 1.975 5.287 5.388.108.046.216.094.321.142 1.49.7 2.58 1.761 3.154 3.07.797 1.82.871 4.79-1.548 7.158-1.85 1.81-4.094 2.628-7.277 2.65Zm1.003-11.69c-.242 0-.487.007-.739.021-1.836.103-2.98.946-2.916 2.143.067 1.256 1.452 1.839 2.784 1.767 1.224-.065 2.818-.543 3.086-3.71a10.5 10.5 0 0 0-2.215-.221z19:["$","a",null,{"className":"text-sm text-gray-500 transition hover:text-gray-600","target":"_blank","rel":"noopener noreferrer","href":"https://www.threads.net","children":[["$","span",null,{"className":"sr-only","children":"threads"}],["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 24 24","className":"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6","children":[["$","title",null,{"children":"Threads"}],["$","path",null,{"d":"$28"}]]}]]}]
1a:["$","a",null,{"className":"text-sm text-gray-500 transition hover:text-gray-600","target":"_blank","rel":"noopener noreferrer","href":"https://medium.com","children":[["$","span",null,{"className":"sr-only","children":"medium"}],["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","viewBox":"0 0 24 24","className":"hover:text-primary-500 dark:hover:text-primary-400 fill-current text-gray-700 dark:text-gray-200 h-6 w-6","children":[["$","title",null,{"children":"Medium"}],["$","path",null,{"d":"M13.54 12a6.8 6.8 0 01-6.77 6.82A6.8 6.8 0 010 12a6.8 6.8 0 016.77-6.82A6.8 6.8 0 0113.54 12zM20.96 12c0 3.54-1.51 6.42-3.38 6.42-1.87 0-3.39-2.88-3.39-6.42s1.52-6.42 3.39-6.42 3.38 2.88 3.38 6.42M24 12c0 3.17-.53 5.75-1.19 5.75-.66 0-1.19-2.58-1.19-5.75s.53-5.75 1.19-5.75C23.47 6.25 24 8.83 24 12z"}]]}]]}]
1b:["$","div",null,{"className":"flex space-x-2 text-sm opacity-80","children":[["$","div",null,{"children":"Yusheng Zheng"}],["$","div",null,{"children":" • "}],["$","div",null,{"children":"© 2025"}],["$","div",null,{"children":" • "}],["$","$L6",null,{"className":"hover:text-primary-500 transition-colors","href":"/","children":"云微的胡思乱想"}]]}]
1c:["$","div",null,{"className":"text-sm opacity-60","children":["$","a",null,{"className":"hover:text-primary-500 transition-colors","target":"_blank","rel":"noopener noreferrer","href":"https://github.com/timlrx/tailwind-nextjs-starter-blog","children":"Tailwind Nextjs Theme"}]}]
29:I[1839,["874","static/chunks/874-8edb22cc7428423c.js","63","static/chunks/63-d245e42a784ca56d.js","909","static/chunks/app/blog/%5B...slug%5D/page-71c7cfee63112339.js"],"default"]
2a:I[3063,["874","static/chunks/874-8edb22cc7428423c.js","63","static/chunks/63-d245e42a784ca56d.js","909","static/chunks/app/blog/%5B...slug%5D/page-71c7cfee63112339.js"],"Image"]
1d:[["$","script",null,{"type":"application/ld+json","dangerouslySetInnerHTML":{"__html":"{\"@context\":\"https://schema.org\",\"@type\":\"BlogPosting\",\"headline\":\"Implementing an Inline Hook in C in 5 minutes\",\"datePublished\":\"2024-02-14T02:41:06.000Z\",\"dateModified\":\"2024-02-14T02:41:06.000Z\",\"image\":\"/static/images/twitter-card.png\",\"url\":\"https://www.yunwei37.com/blog/inline-hook-demo\",\"author\":[{\"@type\":\"Person\",\"name\":\"Yusheng Zheng (云微)\"}]}"}}],["$","section",null,{"className":"mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0","children":[["$","$L29",null,{}],["$","article",null,{"className":"content-glass p-8","children":["$","div",null,{"className":"xl:divide-y xl:divide-gray-200/30 xl:dark:divide-gray-700/30","children":[["$","header",null,{"className":"pt-6 xl:pb-6","children":["$","div",null,{"className":"space-y-4 text-center","children":[["$","dl",null,{"className":"space-y-4","children":["$","div",null,{"children":[["$","dt",null,{"className":"sr-only","children":"Published on"}],["$","dd",null,{"className":"text-base leading-6 font-medium text-gray-600 dark:text-gray-300","children":["$","time",null,{"dateTime":"2024-02-14T02:41:06.000Z","children":"Wednesday, February 14, 2024"}]}]]}]}],["$","div",null,{"children":["$","h1",null,{"className":"text-3xl leading-9 font-extrabold tracking-tight sm:text-4xl sm:leading-10 md:text-5xl md:leading-14","children":"Implementing an Inline Hook in C in 5 minutes"}]}]]}]}],["$","div",null,{"className":"grid-rows-[auto_1fr] divide-y divide-gray-200/30 pb-8 xl:grid xl:grid-cols-4 xl:gap-x-8 xl:divide-y-0 dark:divide-gray-700/30","children":[["$","dl",null,{"className":"pt-6 pb-10 xl:border-b xl:border-gray-200/30 xl:pt-11 xl:dark:border-gray-700/30","children":[["$","dt",null,{"className":"sr-only","children":"Authors"}],["$","dd",null,{"children":["$","ul",null,{"className":"flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-y-6 xl:space-x-0","children":[["$","li","Yusheng Zheng (云微)",{"className":"flex items-center space-x-3 glass p-4 rounded-xl","children":[["$","$L2a",null,{"src":"/static/images/avatar.png","width":38,"height":38,"alt":"avatar","className":"h-10 w-10 rounded-full"}],["$","dl",null,{"className":"text-sm leading-5 font-medium whitespace-nowrap","children":[["$","dt",null,{"className":"sr-only","children":"Name"}],["$","dd",null,{"className":"text-gray-900 dark:text-gray-100","children":"Yusheng Zheng (云微)"}],["$","dt",null,{"className":"sr-only","children":"Twitter"}],["$","dd",null,{"children":["$","a",null,{"className":"text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors","target":"_blank","rel":"noopener noreferrer","href":"https://twitter.com/yunwei37","children":"@yunwei37"}]}]]}]]}]]}]}]]}],["$","div",null,{"className":"divide-y divide-gray-200/30 xl:col-span-3 xl:row-span-2 xl:pb-0 dark:divide-gray-700/30","children":[["$","div",null,{"className":"prose dark:prose-invert max-w-none pt-10 pb-8 text-gray-700 dark:text-gray-200","children":[["$","p",null,{"children":"One of the fascinating aspects of programming comes when we try to alter the behavior of a program while it is running."}],["$","p",null,{"children":"In this tutorial, we shed light on one method that can make this possible - an \"Inline Hook\". We will delve into how you can manipulate the execution flow of a program in the C programming language. By implementing an Inline Hook, we aim to divert the program's execution flow to our function, then returning it back to the normal flow."}],["$","h2",null,{"className":"content-header","id":"what-is-an-inline-hook","children":[["$","a",null,{"className":"break-words","href":"#what-is-an-inline-hook","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],"$L2b"]}]}]}],"What is an Inline Hook?"]}],"$L2c","$L2d","$L2e","$L2f","$L30","$L31","$L32","$L33","$L34","$L35","$L36","$L37","$L38","$L39","$L3a","$L3b","$L3c","$L3d","$L3e","$L3f","$L40","$L41","$L42","$L43","$L44","$L45","$L46","$L47","$L48","$L49","$L4a","$L4b","$L4c","$L4d","$L4e","$L4f","$L50","$L51","$L52","$L53","$L54","$L55","$L56","$L57","$L58","$L59"]}],"$L5a","$L5b"]}],"$L5c"]}]]}]}]]}]]
5d:I[2100,["874","static/chunks/874-8edb22cc7428423c.js","63","static/chunks/63-d245e42a784ca56d.js","909","static/chunks/app/blog/%5B...slug%5D/page-71c7cfee63112339.js"],"default"]
bc:I[1449,["874","static/chunks/874-8edb22cc7428423c.js","63","static/chunks/63-d245e42a784ca56d.js","909","static/chunks/app/blog/%5B...slug%5D/page-71c7cfee63112339.js"],"default"]
2b:["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]
2c:["$","p",null,{"children":"An Inline hook is a technique that inserts a piece of code into a running program, altering its control flow. In practice, this is achieved by replacing the first few instructions of a function with a jump to our inserted code (usually another function), which upon completion will jump back, continuing the execution of the original function. Frida is a popular tool that uses this technique to inject code into a running process. It is used for dynamic instrumentation, debugging, and reverse engineering."}]
2d:["$","p",null,{"children":["In our userspace eBPF runtime bpftime (",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://github.com/eunomia-bpf/bpftime","children":"https://github.com/eunomia-bpf/bpftime"}],"), we use inline hooking to implement the ",["$","code",null,{"children":"uprobe"}]," feature. bpftime is an userspace eBPF runtime that allows existing eBPF applications to operate in unprivileged userspace using the same libraries and toolchains. It offers Uprobe and Syscall tracepoints for eBPF, with significant performance improvements over kernel uprobe and without requiring manual code instrumentation or process restarts."]}]
2e:["$","h2",null,{"className":"content-header","id":"inline-hook-implementation","children":[["$","a",null,{"className":"break-words","href":"#inline-hook-implementation","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Inline Hook Implementation"]}]
2f:["$","p",null,{"children":"The Inline hook implementation primarily follows five crucial steps:"}]
30:["$","ol",null,{"children":[["$","li",null,{"children":"Identifying the memory address of the function to be hooked."}],["$","li",null,{"children":"Backing up the initial instructions of the target function that will be overwritten,"}],["$","li",null,{"children":"Writing a jump instruction at the beginning of the target function in the hooked process's memory,"}],["$","li",null,{"children":"Creating the hook function, which will replace the original one,"}],["$","li",null,{"children":"Altering the memory permissions to enable the changes, and restoring them once modifications are complete."}]]}]
31:["$","p",null,{"children":"On a side note, Inline Hooking could be limited by modern compiler optimization and certain memory protection procedures such as Data Execution Prevention (DEP) and Address Space Layout Randomization (ASLR)."}]
32:["$","h2",null,{"className":"content-header","id":"inline-hooking-example-how-to-use-it","children":[["$","a",null,{"className":"break-words","href":"#inline-hooking-example-how-to-use-it","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Inline Hooking Example: how to use it"]}]
33:["$","p",null,{"children":["To make this more digestible, we will use an example scenario. In this example, we will hook a simple function ",["$","code",null,{"children":"my_function"}],". This code is in ",["$","code",null,{"children":"main.c"}]," and it initially prints \"Hello, world!\". But after applying our hook, it prints \"Hello from hook!\" instead."]}]
34:["$","$L5d",null,{"className":"language-c","children":["$","code",null,{"className":"language-c code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token comment","children":"// This is the original function to hook."}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"my_function"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token function","children":"printf"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Hello, world!\\n\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}]
35:["$","p",null,{"children":["Next, we create a hooking function ",["$","code",null,{"children":"my_hook_function"}]," in ",["$","code",null,{"children":"hook.c"}],". This function will replace ",["$","code",null,{"children":"my_function"}]," and is designed to print \"Hello from hook!\""]}]
36:["$","$L5d",null,{"className":"language-c","children":["$","code",null,{"className":"language-c code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token comment","children":"// This is the hook function."}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"my_hook_function"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token function","children":"printf"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Hello from hook!\\n\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}]
37:["$","p",null,{"children":["The ",["$","code",null,{"children":"inline_hook"}]," function is the most critical part of our application. It uses ",["$","code",null,{"children":"mprotect"}]," to change the memory permissions of the target function, making it writable. It then replaces the first few instructions of ",["$","code",null,{"children":"my_function"}]," with a jump instruction to ",["$","code",null,{"children":"my_hook_function"}],". The original bytes are saved for future restoration."]}]
38:["$","p",null,{"children":["On the main function, we start by calling ",["$","code",null,{"children":"my_function"}],", enabling the ",["$","code",null,{"children":"inline_hook"}],", calling ",["$","code",null,{"children":"my_function"}]," again (which now executes ",["$","code",null,{"children":"my_hook_function"}],"), then removing the hook and calling ",["$","code",null,{"children":"my_function"}]," another time to see that it prints the original \"Hello, world!\" string."]}]
39:["$","$L5d",null,{"className":"language-c","children":["$","code",null,{"className":"language-c code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"int"}]," ",["$","span",null,{"className":"token function","children":"main"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token function","children":"my_function"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"    \n"}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Enabling the hook."}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token function","children":"inline_hook"}],["$","span",null,{"className":"token punctuation","children":"("}],"my_function",["$","span",null,{"className":"token punctuation","children":","}]," my_hook_function",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"    \n"}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Now calling the function will actually call the hook function."}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token function","children":"my_function"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"    \n"}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Removing the hook"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token function","children":"remove_hook"}],["$","span",null,{"className":"token punctuation","children":"("}],"my_function",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"    \n"}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Now calling the function will call the original function."}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token function","children":"my_function"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token number","children":"0"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}]
3a:["$","p",null,{"children":"After compiling and running the main function, we can observe the output."}]
3b:["$","$L5d",null,{"children":["$","code",null,{"className":"code-highlight language-console","children":[["$","span",null,{"className":"code-line","children":"$$ make\n"}],["$","span",null,{"className":"code-line","children":"$$ ./maps\n"}],["$","span",null,{"className":"code-line","children":"Hello, world!\n"}],["$","span",null,{"className":"code-line","children":"Hello from hook!\n"}],["$","span",null,{"className":"code-line","children":"Hello, world!\n"}]]}]}]
3c:["$","p",null,{"children":["You can find the complete example in the following repository: ",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://github.com/eunomia-bpf/inline-hook-demo","children":"https://github.com/eunomia-bpf/inline-hook-demo"}]]}]
3d:["$","h2",null,{"className":"content-header","id":"implementation-a-inline-hook","children":[["$","a",null,{"className":"break-words","href":"#implementation-a-inline-hook","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Implementation a inline hook"]}]
3e:["$","p",null,{"children":["Let's take a look at the implementation of the ",["$","code",null,{"children":"inline_hook"}]," function. This is a very basic implementation that works on x86_64, ARM64, and ARM32. It is not a complete implementation, but it should be enough to get you started."]}]
3f:["$","$L5d",null,{"className":"language-c","children":["$","code",null,{"className":"language-c code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"include"}]," ",["$","span",null,{"className":"token string","children":"<sys/mman.h>"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"include"}]," ",["$","span",null,{"className":"token string","children":"<unistd.h>"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"include"}]," ",["$","span",null,{"className":"token string","children":"<assert.h>"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"include"}]," ",["$","span",null,{"className":"token string","children":"<string.h>"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"include"}]," ",["$","span",null,{"className":"token string","children":"<stdlib.h>"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"include"}]," ",["$","span",null,{"className":"token string","children":"<stdint.h>"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"if"}]," ",["$","span",null,{"className":"token expression","children":[["$","span",null,{"className":"token function","children":"defined"}],["$","span",null,{"className":"token punctuation","children":"("}],"__x86_64__",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"||"}]," ",["$","span",null,{"className":"token function","children":"defined"}],["$","span",null,{"className":"token punctuation","children":"("}],"_M_X64",["$","span",null,{"className":"token punctuation","children":")"}]]}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"define"}]," ",["$","span",null,{"className":"token macro-name","children":"SIZE_ORIG_BYTES"}]," ",["$","span",null,{"className":"token expression","children":["$","span",null,{"className":"token number","children":"16"}]}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"static"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"inline_hook_replace_inst"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"orig_func",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"hook_func",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token comment","children":"// Write a jump instruction at the start of the original function."}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token operator","children":"*"}],"$L5e","$L5f","$L60"," ","$L61"," ","$L62","$L63","orig_func ","$L64"," ","$L65","$L66"," ","$L67"," ","$L68","$L69"," ","$L6a","\n"]}],"$L6b","$L6c","$L6d","$L6e","$L6f","$L70","$L71","$L72","$L73","$L74","$L75","$L76","$L77","$L78","$L79","$L7a","$L7b","$L7c","$L7d","$L7e","$L7f","$L80","$L81","$L82","$L83","$L84","$L85","$L86","$L87","$L88","$L89","$L8a","$L8b","$L8c","$L8d","$L8e","$L8f","$L90","$L91","$L92","$L93","$L94","$L95","$L96","$L97","$L98","$L99","$L9a","$L9b","$L9c","$L9d","$L9e","$L9f","$La0","$La1","$La2","$La3","$La4","$La5","$La6","$La7","$La8","$La9","$Laa","$Lab","$Lac"]}]}]
40:["$","p",null,{"children":["We start by saving the original bytes of the target function in the ",["$","code",null,{"children":"orig_bytes"}]," array. We then make the memory page writable using ",["$","code",null,{"children":"mprotect"}],". Next, we replace the first few instructions of the target function with a jump instruction to the hook function. Finally, we restore the memory page's permissions to their original state. ",["$","code",null,{"children":"get_page_addr"}]," computes the page-aligned address. ",["$","code",null,{"children":"inline_hook"}]," sets up the hook by storing original bytes and modifying instructions. ",["$","code",null,{"children":"remove_hook"}]," reverses the changes."]}]
41:["$","p",null,{"children":"The hook installation differs based on the processor architecture."}]
42:["$","p",null,{"children":["On x86_64, we replace the beginning of the target function with a ",["$","code",null,{"children":"JMP"}]," instruction that redirects to our hook function."]}]
43:["$","$L5d",null,{"className":"language-c","children":["$","code",null,{"className":"language-c code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"define"}]," ",["$","span",null,{"className":"token macro-name","children":"SIZE_ORIG_BYTES"}]," ",["$","span",null,{"className":"token expression","children":["$","span",null,{"className":"token number","children":"16"}]}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"static"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"inline_hook_replace_inst"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"orig_func",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"hook_func",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Write a jump instruction at the start of the original function."}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"unsigned"}]," ",["$","span",null,{"className":"token keyword","children":"char"}]," ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":")"}],"orig_func ",["$","span",null,{"className":"token operator","children":"+"}]," ",["$","span",null,{"className":"token number","children":"0"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token number","children":"0xE9"}],["$","span",null,{"className":"token punctuation","children":";"}]," ",["$","span",null,{"className":"token comment","children":"// JMP instruction"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"unsigned"}]," ",["$","span",null,{"className":"token keyword","children":"char"}]," ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":")"}],"orig_func ",["$","span",null,{"className":"token operator","children":"+"}]," ",["$","span",null,{"className":"token number","children":"1"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"="}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"unsigned"}]," ",["$","span",null,{"className":"token keyword","children":"char"}]," ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":")"}],"hook_func ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"unsigned"}]," ",["$","span",null,{"className":"token keyword","children":"char"}]," ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":")"}],"orig_func ","$Lad"," ","$Lae","$Laf","\n"]}],"$Lb0"]}]}]
44:["$","p",null,{"children":"Note that in ARM32, the Program Counter (PC) is usually 2 instructions ahead, which is why we subtract 8 (2 instructions * 4 bytes/instruction) when calculating the offset. This might differ between different ARM versions or modes (Thumb vs ARM, etc.) so please adjust accordingly to your target's specifics."}]
45:["$","p",null,{"children":"Also, you need to increase the SIZE_ORIG_BYTES from 16 to 20 because the minimal branch instruction in ARM is 4 bytes and you're going to replace 5 instructions. This is needed because the branch instruction uses a relative offset and you cannot be sure how far your hook function will be. If your function and hook are within 32MB of each other, you could only replace the first 4 bytes with a branch and wouldn't need to touch the rest."}]
46:["$","$L5d",null,{"className":"language-c","children":["$","code",null,{"className":"language-c code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"define"}]," ",["$","span",null,{"className":"token macro-name","children":"SIZE_ORIG_BYTES"}]," ",["$","span",null,{"className":"token expression","children":["$","span",null,{"className":"token number","children":"20"}]}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"static"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"inline_hook_replace_inst"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"orig_func",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"hook_func",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"int"}]," offset ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"intptr_t"}],["$","span",null,{"className":"token punctuation","children":")"}],"hook_func ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"intptr_t"}],["$","span",null,{"className":"token punctuation","children":")"}],"orig_func ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token number","children":"8"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"/"}]," ",["$","span",null,{"className":"token number","children":"4"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"int"}]," branch_instruction ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token number","children":"0xEA000000"}]," ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"offset ",["$","span",null,{"className":"token operator","children":"&"}]," ",["$","span",null,{"className":"token number","children":"0x00FFFFFF"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"int"}]," ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":")"}],"orig_func ",["$","span",null,{"className":"token operator","children":"="}]," branch_instruction",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}]
47:["$","p",null,{"children":"Similar to ARM32, ARM64 uses the ARM instruction set. However, there are differences and specifics to consider for ARM64. For example, the encoding of the branch instruction is different and because of the larger address space, you have to create a trampoline for larger offsets that can't be reached by a single branch instruction. The trampoline should be close to the original function so it can be reached by a branch instruction and from there, it will load the full 64 bit address of the hook function."}]
48:["$","$L5d",null,{"className":"language-c","children":["$","code",null,{"className":"language-c code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"define"}]," ",["$","span",null,{"className":"token macro-name","children":"SIZE_ORIG_BYTES"}]," ",["$","span",null,{"className":"token expression","children":["$","span",null,{"className":"token number","children":"32"}]}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"static"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"inline_hook_replace_inst"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"orig_func",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"hook_func",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"int"}]," offset ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"intptr_t"}],["$","span",null,{"className":"token punctuation","children":")"}],"hook_func ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"intptr_t"}],["$","span",null,{"className":"token punctuation","children":")"}],"orig_func",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"/"}]," ",["$","span",null,{"className":"token number","children":"4"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Check if the offset is within the allowable range for a branch instruction."}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"offset ",["$","span",null,{"className":"token operator","children":"<"}]," ",["$","span",null,{"className":"token operator","children":"-"}],["$","span",null,{"className":"token number","children":"0x2000000"}]," ",["$","span",null,{"className":"token operator","children":"||"}]," offset ",["$","span",null,{"className":"token operator","children":">"}]," ",["$","span",null,{"className":"token number","children":"0x1ffffff"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token function","children":"printf"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Offset %d out of range!\\n\""}],["$","span",null,{"className":"token punctuation","children":","}]," offset",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token function","children":"exit"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token number","children":"1"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Construct and write the branch instruction."}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ","$Lb1"," branch_instruction ","$Lb2"," ","$Lb3"," ","$Lb4"," ","$Lb5","offset ","$Lb6"," ","$Lb7","$Lb8","$Lb9","\n"]}],"$Lba","$Lbb"]}]}]
49:["$","p",null,{"children":["You can find the complete example in the following repository: ",["$","a",null,{"className":"break-words","target":"_blank","rel":"noopener noreferrer","href":"https://github.com/eunomia-bpf/inline-hook-demo","children":"https://github.com/eunomia-bpf/inline-hook-demo"}]]}]
4a:["$","h2",null,{"className":"content-header","id":"limitations","children":[["$","a",null,{"className":"break-words","href":"#limitations","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Limitations"]}]
4b:["$","h2",null,{"className":"content-header","id":"understanding-the-limitations-of-inline-hooking","children":[["$","a",null,{"className":"break-words","href":"#understanding-the-limitations-of-inline-hooking","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Understanding the Limitations of Inline Hooking"]}]
4c:["$","p",null,{"children":"Inline Hooking, while a powerful technique for intercepting and modifying function calls in software, has several inherent limitations, particularly in the context of modern operating systems and programming environments. Here, we delve into these limitations in more detail to provide a clearer understanding of the challenges and implications involved. The demostration code is very simple and cannot be used in production."}]
4d:["$","h3",null,{"className":"content-header","id":"1-operating-system-security-mechanisms","children":[["$","a",null,{"className":"break-words","href":"#1-operating-system-security-mechanisms","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"1. ",["$","strong",null,{"children":"Operating System Security Mechanisms"}]]}]
4e:["$","p",null,{"children":"Modern operating systems deploy a variety of security mechanisms to prevent malicious or unintended modifications to executing code:"}]
4f:["$","ul",null,{"children":[["$","li",null,{"children":["$","p",null,{"children":[["$","strong",null,{"children":"Data Execution Prevention (DEP)"}],": DEP is designed to prevent code from being run from data segments of a process, such as the stack or heap. Inline hooking often requires executing code that has been written to these segments, which can be blocked by DEP."]}]}],["$","li",null,{"children":["$","p",null,{"children":[["$","strong",null,{"children":"Address Space Layout Randomization (ASLR)"}],": ASLR randomizes the memory addresses used by system and application files. This complicates the process of inline hooking since the exact address of the target function may change every time the application or system is restarted."]}]}],["$","li",null,{"children":["$","p",null,{"children":[["$","strong",null,{"children":"Code Signing and Integrity Checks"}],": Some operating systems and applications implement code signing and integrity checks. These mechanisms can detect modifications to code, including inline hooks, and may prevent the modified application from executing or flag it as malicious."]}]}]]}]
50:["$","h3",null,{"className":"content-header","id":"2-compiler-optimizations","children":[["$","a",null,{"className":"break-words","href":"#2-compiler-optimizations","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"2. ",["$","strong",null,{"children":"Compiler Optimizations"}]]}]
51:["$","p",null,{"children":"Modern compilers employ various optimizations that can interfere with inline hooking:"}]
52:["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Function Inlining"}],": Compilers may inline functions, which means the function's code is directly inserted into each place it is called, rather than being kept as a separate function. This can eliminate the consistent function entry point that inline hooks rely on."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Instruction Reordering and Optimizations"}],": Compilers might reorder instructions or optimize the function's structure in a way that doesn't align well with the assumptions made during the setup of an inline hook, potentially leading to crashes or undefined behavior."]}]]}]
53:["$","h3",null,{"className":"content-header","id":"3-multi-threading-and-concurrent-execution","children":[["$","a",null,{"className":"break-words","href":"#3-multi-threading-and-concurrent-execution","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"3. ",["$","strong",null,{"children":"Multi-threading and Concurrent Execution"}]]}]
54:["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Thread Safety"}],": In multi-threaded applications, ensuring that the hook is correctly applied without interrupting currently executing threads can be challenging. There's a risk of race conditions where one thread might be executing the function being hooked while another is applying the hook."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Re-entrancy Issues"}],": If the hooked function or the hook itself is re-entrant (can be called simultaneously from multiple threads), it complicates the inline hooking process. Care must be taken to handle such cases properly to avoid deadlocks or inconsistent program states."]}]]}]
55:["$","h3",null,{"className":"content-header","id":"4-hardware-and-architecture-specifics","children":[["$","a",null,{"className":"break-words","href":"#4-hardware-and-architecture-specifics","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"4. ",["$","strong",null,{"children":"Hardware and Architecture Specifics"}]]}]
56:["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Instruction Set Differences"}],": Different processors have different instruction sets and execution models. For instance, ARM and x86 processors have significantly different ways of handling instructions, making the process of writing a universal inline hook more complex."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Instruction Length Variations"}],": The length of instructions can vary (especially in variable-length instruction sets like x86), making it difficult to determine how many bytes to overwrite safely without affecting subsequent instructions."]}]]}]
57:["$","h2",null,{"className":"content-header","id":"wrapping-up","children":[["$","a",null,{"className":"break-words","href":"#wrapping-up","aria-hidden":"true","tabIndex":"-1","children":["$","span",null,{"className":"content-header-link","children":["$","svg",null,{"className":"h-5 linkicon w-5","fill":"currentColor","viewBox":"0 0 20 20","xmlns":"http://www.w3.org/2000/svg","children":[["$","path",null,{"d":"M12.232 4.232a2.5 2.5 0 0 1 3.536 3.536l-1.225 1.224a.75.75 0 0 0 1.061 1.06l1.224-1.224a4 4 0 0 0-5.656-5.656l-3 3a4 4 0 0 0 .225 5.865.75.75 0 0 0 .977-1.138 2.5 2.5 0 0 1-.142-3.667l3-3Z"}],["$","path",null,{"d":"M11.603 7.963a.75.75 0 0 0-.977 1.138 2.5 2.5 0 0 1 .142 3.667l-3 3a2.5 2.5 0 0 1-3.536-3.536l1.225-1.224a.75.75 0 0 0-1.061-1.06l-1.224 1.224a4 4 0 1 0 5.656 5.656l3-3a4 4 0 0 0-.225-5.865Z"}]]}]}]}],"Wrapping Up"]}]
58:["$","p",null,{"children":"Understanding inline hooking can substantially aid in areas such as software security, testing, and debugging. It provides an avenue to alter and control program behavior on-the-fly. While it is powerful, it also comes with its drawbacks, which need to be handled with care. In conclusion, while inline hooks are powerful tools, they should be used with caution, understanding, and a good knowledge of system architecture."}]
59:["$","p",null,{"children":"I hope you enjoyed the journey exploring Inline Hooks. Happy coding!"}]
5a:["$","div",null,{"className":"pt-6 pb-6 text-sm text-gray-700 dark:text-gray-300 glass p-4 rounded-xl","children":[["$","a",null,{"className":"hover:text-primary-600 dark:hover:text-primary-400 transition-colors","target":"_blank","rel":"nofollow","href":"https://mobile.twitter.com/search?q=https%3A%2F%2Fwww.yunwei37.com%2Fblog%2Finline-hook-demo","children":"Discuss on Twitter"}]," • ",["$","a",null,{"className":"hover:text-primary-600 dark:hover:text-primary-400 transition-colors","target":"_blank","rel":"noopener noreferrer","href":"https://github.com/yunwei37/my-new-blog/blob/main/data/blog/inline-hook-demo.mdx","children":"View on GitHub"}]]}]
5b:["$","div",null,{"className":"pt-6 pb-6 text-center text-gray-700 dark:text-gray-300 glass p-6 rounded-xl","id":"comment","children":["$","$Lbc",null,{"slug":"inline-hook-demo"}]}]
5c:["$","footer",null,{"children":[["$","div",null,{"className":"divide-gray-200/30 text-sm leading-5 font-medium xl:col-start-1 xl:row-start-2 xl:divide-y dark:divide-gray-700/30","children":[["$","div",null,{"className":"py-4 xl:py-8","children":[["$","h2",null,{"className":"text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-4","children":"Tags"}],["$","div",null,{"className":"flex flex-wrap gap-2","children":[["$","$L6","notes",{"href":"/tags/notes","className":"inline-block px-3 py-1 text-xs font-medium uppercase tracking-wide bg-primary-100 hover:bg-primary-200 dark:bg-primary-900/30 dark:hover:bg-primary-800/40 rounded-full transition-all duration-200 text-primary-800 hover:text-primary-900 dark:text-primary-300 dark:hover:text-primary-200 border border-primary-200/50 dark:border-primary-700/50","children":"notes"}]]}]]}],["$","div",null,{"className":"flex justify-between py-4 xl:block xl:space-y-6 xl:py-8","children":[["$","div",null,{"className":"glass p-4 rounded-xl","children":[["$","h2",null,{"className":"text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-2","children":"Previous Article"}],["$","div",null,{"className":"text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors","children":["$","$L6",null,{"className":"break-words","href":"/blog/bpftime","children":"bpftime: Extending eBPF from Kernel to User Space"}]}]]}],["$","div",null,{"className":"glass p-4 rounded-xl","children":[["$","h2",null,{"className":"text-xs tracking-wide text-gray-600 uppercase dark:text-gray-300 mb-2","children":"Next Article"}],["$","div",null,{"className":"text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-colors","children":["$","$L6",null,{"className":"break-words","href":"/blog/setjmp","children":"Using `setjmp`, `longjmp`, and Signals to Catch Page Faults and Measure Performance"}]}]]}]]}]]}],["$","div",null,{"className":"pt-4 xl:pt-8","children":["$","$L6",null,{"className":"inline-flex items-center glass px-4 py-2 rounded-xl text-primary-600 hover:text-primary-700 dark:text-primary-400 dark:hover:text-primary-300 transition-all duration-200 hover:scale-105","href":"/blog","aria-label":"Back to the blog","children":"← Back to the blog"}]}]]}]
5e:["$","span",null,{"className":"token punctuation","children":"("}]
5f:["$","span",null,{"className":"token punctuation","children":"("}]
60:["$","span",null,{"className":"token keyword","children":"unsigned"}]
61:["$","span",null,{"className":"token keyword","children":"char"}]
62:["$","span",null,{"className":"token operator","children":"*"}]
63:["$","span",null,{"className":"token punctuation","children":")"}]
64:["$","span",null,{"className":"token operator","children":"+"}]
65:["$","span",null,{"className":"token number","children":"0"}]
66:["$","span",null,{"className":"token punctuation","children":")"}]
67:["$","span",null,{"className":"token operator","children":"="}]
68:["$","span",null,{"className":"token number","children":"0xE9"}]
69:["$","span",null,{"className":"token punctuation","children":";"}]
6a:["$","span",null,{"className":"token comment","children":"// JMP instruction"}]
6b:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"unsigned"}]," ",["$","span",null,{"className":"token keyword","children":"char"}]," ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":")"}],"orig_func ",["$","span",null,{"className":"token operator","children":"+"}]," ",["$","span",null,{"className":"token number","children":"1"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"="}],"\n"]}]
6c:["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"unsigned"}]," ",["$","span",null,{"className":"token keyword","children":"char"}]," ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":")"}],"hook_func ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"unsigned"}]," ",["$","span",null,{"className":"token keyword","children":"char"}]," ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":")"}],"orig_func ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token number","children":"5"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
6d:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]
6e:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"elif"}]," ",["$","span",null,{"className":"token expression","children":[["$","span",null,{"className":"token function","children":"defined"}],["$","span",null,{"className":"token punctuation","children":"("}],"__aarch64__",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"||"}]," ",["$","span",null,{"className":"token function","children":"defined"}],["$","span",null,{"className":"token punctuation","children":"("}],"_M_ARM64",["$","span",null,{"className":"token punctuation","children":")"}]]}]]}],"\n"]}]
6f:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"define"}]," ",["$","span",null,{"className":"token macro-name","children":"SIZE_ORIG_BYTES"}]," ",["$","span",null,{"className":"token expression","children":["$","span",null,{"className":"token number","children":"32"}]}]]}],"\n"]}]
70:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"static"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"inline_hook_replace_inst"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"orig_func",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"hook_func",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}]
71:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"int"}]," offset ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"intptr_t"}],["$","span",null,{"className":"token punctuation","children":")"}],"hook_func ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"intptr_t"}],["$","span",null,{"className":"token punctuation","children":")"}],"orig_func",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"/"}]," ",["$","span",null,{"className":"token number","children":"4"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
72:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"offset ",["$","span",null,{"className":"token operator","children":"<"}]," ",["$","span",null,{"className":"token operator","children":"-"}],["$","span",null,{"className":"token number","children":"0x2000000"}]," ",["$","span",null,{"className":"token operator","children":"||"}]," offset ",["$","span",null,{"className":"token operator","children":">"}]," ",["$","span",null,{"className":"token number","children":"0x1ffffff"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}]
73:["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token function","children":"printf"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Offset %d out of range!\\n\""}],["$","span",null,{"className":"token punctuation","children":","}]," offset",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
74:["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token function","children":"exit"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token number","children":"1"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
75:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]
76:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token class-name","children":"uint32_t"}]," branch_instruction ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token number","children":"0x14000000"}]," ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"offset ",["$","span",null,{"className":"token operator","children":"&"}]," ",["$","span",null,{"className":"token number","children":"0x03ffffff"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
77:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"uint32_t"}],["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":")"}],"orig_func",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"="}]," branch_instruction",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
78:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]
79:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"elif"}]," ",["$","span",null,{"className":"token expression","children":[["$","span",null,{"className":"token function","children":"defined"}],["$","span",null,{"className":"token punctuation","children":"("}],"__arm__",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"||"}]," ",["$","span",null,{"className":"token function","children":"defined"}],["$","span",null,{"className":"token punctuation","children":"("}],"_M_ARM",["$","span",null,{"className":"token punctuation","children":")"}]]}]]}],"\n"]}]
7a:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"define"}]," ",["$","span",null,{"className":"token macro-name","children":"SIZE_ORIG_BYTES"}]," ",["$","span",null,{"className":"token expression","children":["$","span",null,{"className":"token number","children":"20"}]}]]}],"\n"]}]
7b:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"static"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"inline_hook_replace_inst"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"orig_func",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"hook_func",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}]
7c:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Construct a branch instruction to the hook function."}],"\n"]}]
7d:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// The instruction for a branch in ARM is 0xEA000000 | ((<offset> / 4) & 0x00FFFFFF)"}],"\n"]}]
7e:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// The offset needs to be divided by 4 because the PC advances by 4 bytes each step in ARM"}],"\n"]}]
7f:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"int"}]," offset ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"intptr_t"}],["$","span",null,{"className":"token punctuation","children":")"}],"hook_func ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"intptr_t"}],["$","span",null,{"className":"token punctuation","children":")"}],"orig_func ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token number","children":"8"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"/"}]," ",["$","span",null,{"className":"token number","children":"4"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
80:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"int"}]," branch_instruction ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token number","children":"0xEA000000"}]," ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"offset ",["$","span",null,{"className":"token operator","children":"&"}]," ",["$","span",null,{"className":"token number","children":"0x00FFFFFF"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
81:["$","span",null,{"className":"code-line","children":"\n"}]
82:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Write the branch instruction to the start of the original function."}],"\n"]}]
83:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"int"}]," ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":")"}],"orig_func ",["$","span",null,{"className":"token operator","children":"="}]," branch_instruction",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
84:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]
85:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"else"}]]}],"\n"]}]
86:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"error"}]," ",["$","span",null,{"className":"token string","children":"\"Unsupported architecture\""}]]}],"\n"]}]
87:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token macro property","children":[["$","span",null,{"className":"token directive-hash","children":"#"}],["$","span",null,{"className":"token keyword directive","children":"endif"}]]}],"\n"]}]
88:["$","span",null,{"className":"code-line","children":"\n"}]
89:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token function","children":"get_page_addr"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"addr",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}]
8a:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}]
8b:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"uintptr_t"}],["$","span",null,{"className":"token punctuation","children":")"}],"addr ",["$","span",null,{"className":"token operator","children":"&"}]," ",["$","span",null,{"className":"token operator","children":"~"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token function","children":"getpagesize"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token number","children":"1"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
8c:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]
8d:["$","span",null,{"className":"code-line","children":"\n"}]
8e:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"unsigned"}]," ",["$","span",null,{"className":"token keyword","children":"char"}]," orig_bytes",["$","span",null,{"className":"token punctuation","children":"["}],"SIZE_ORIG_BYTES",["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
8f:["$","span",null,{"className":"code-line","children":"\n"}]
90:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"inline_hook"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"orig_func",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"hook_func",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}]
91:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}]
92:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Store the original bytes of the function."}],"\n"]}]
93:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token function","children":"memcpy"}],["$","span",null,{"className":"token punctuation","children":"("}],"orig_bytes",["$","span",null,{"className":"token punctuation","children":","}]," orig_func",["$","span",null,{"className":"token punctuation","children":","}]," SIZE_ORIG_BYTES",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
94:["$","span",null,{"className":"code-line","children":"\n"}]
95:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Make the memory page writable."}],"\n"]}]
96:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token function","children":"mprotect"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token function","children":"get_page_addr"}],["$","span",null,{"className":"token punctuation","children":"("}],"orig_func",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token function","children":"getpagesize"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}]
97:["$","span",null,{"className":"code-line","children":["         PROT_READ ",["$","span",null,{"className":"token operator","children":"|"}]," PROT_WRITE ",["$","span",null,{"className":"token operator","children":"|"}]," PROT_EXEC",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
98:["$","span",null,{"className":"code-line","children":"\n"}]
99:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token function","children":"inline_hook_replace_inst"}],["$","span",null,{"className":"token punctuation","children":"("}],"orig_func",["$","span",null,{"className":"token punctuation","children":","}]," hook_func",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
9a:["$","span",null,{"className":"code-line","children":"\n"}]
9b:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Make the memory page executable only."}],"\n"]}]
9c:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token function","children":"mprotect"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token function","children":"get_page_addr"}],["$","span",null,{"className":"token punctuation","children":"("}],"orig_func",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token function","children":"getpagesize"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}]
9d:["$","span",null,{"className":"code-line","children":["         PROT_READ ",["$","span",null,{"className":"token operator","children":"|"}]," PROT_EXEC",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
9e:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]
9f:["$","span",null,{"className":"code-line","children":"\n"}]
a0:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token function","children":"remove_hook"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"*"}],"orig_func",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}]
a1:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}]
a2:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Make the memory page writable."}],"\n"]}]
a3:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token function","children":"mprotect"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token function","children":"get_page_addr"}],["$","span",null,{"className":"token punctuation","children":"("}],"orig_func",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token function","children":"getpagesize"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}]
a4:["$","span",null,{"className":"code-line","children":["         PROT_READ ",["$","span",null,{"className":"token operator","children":"|"}]," PROT_WRITE ",["$","span",null,{"className":"token operator","children":"|"}]," PROT_EXEC",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
a5:["$","span",null,{"className":"code-line","children":"\n"}]
a6:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Restore the original bytes of the function."}],"\n"]}]
a7:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token function","children":"memcpy"}],["$","span",null,{"className":"token punctuation","children":"("}],"orig_func",["$","span",null,{"className":"token punctuation","children":","}]," orig_bytes",["$","span",null,{"className":"token punctuation","children":","}]," SIZE_ORIG_BYTES",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
a8:["$","span",null,{"className":"code-line","children":"\n"}]
a9:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// Make the memory page executable only."}],"\n"]}]
aa:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token function","children":"mprotect"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token function","children":"get_page_addr"}],["$","span",null,{"className":"token punctuation","children":"("}],"orig_func",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token function","children":"getpagesize"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}]
ab:["$","span",null,{"className":"code-line","children":["         PROT_READ ",["$","span",null,{"className":"token operator","children":"|"}]," PROT_EXEC",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
ac:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]
ad:["$","span",null,{"className":"token operator","children":"-"}]
ae:["$","span",null,{"className":"token number","children":"5"}]
af:["$","span",null,{"className":"token punctuation","children":";"}]
b0:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]
b1:["$","span",null,{"className":"token class-name","children":"uint32_t"}]
b2:["$","span",null,{"className":"token operator","children":"="}]
b3:["$","span",null,{"className":"token number","children":"0x14000000"}]
b4:["$","span",null,{"className":"token operator","children":"|"}]
b5:["$","span",null,{"className":"token punctuation","children":"("}]
b6:["$","span",null,{"className":"token operator","children":"&"}]
b7:["$","span",null,{"className":"token number","children":"0x03ffffff"}]
b8:["$","span",null,{"className":"token punctuation","children":")"}]
b9:["$","span",null,{"className":"token punctuation","children":";"}]
ba:["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":"uint32_t"}],["$","span",null,{"className":"token operator","children":"*"}],["$","span",null,{"className":"token punctuation","children":")"}],"orig_func",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"="}]," branch_instruction",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]
bb:["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]
23:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
1f:null
21:{"metadata":[["$","title","0",{"children":"Implementing an Inline Hook in C in 5 minutes | 云微的胡思乱想"}],["$","meta","1",{"name":"robots","content":"index, follow"}],["$","meta","2",{"name":"googlebot","content":"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"}],["$","link","3",{"rel":"canonical","href":"https://www.yunwei37.com/blog/inline-hook-demo"}],["$","link","4",{"rel":"alternate","type":"application/rss+xml","href":"https://www.yunwei37.com/feed.xml"}],["$","meta","5",{"property":"og:title","content":"Implementing an Inline Hook in C in 5 minutes"}],["$","meta","6",{"property":"og:url","content":"https://www.yunwei37.com/blog/inline-hook-demo"}],["$","meta","7",{"property":"og:site_name","content":"云微的胡思乱想"}],["$","meta","8",{"property":"og:locale","content":"en_US"}],["$","meta","9",{"property":"og:image","content":"https://www.yunwei37.com/static/images/twitter-card.png"}],["$","meta","10",{"property":"og:type","content":"article"}],["$","meta","11",{"property":"article:published_time","content":"2024-02-14T02:41:06.000Z"}],["$","meta","12",{"property":"article:modified_time","content":"2024-02-14T02:41:06.000Z"}],["$","meta","13",{"property":"article:author","content":"Yusheng Zheng (云微)"}],["$","meta","14",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","15",{"name":"twitter:title","content":"Implementing an Inline Hook in C in 5 minutes"}],["$","meta","16",{"name":"twitter:image","content":"https://www.yunwei37.com/static/images/twitter-card.png"}]],"error":null,"digest":"$undefined"}
26:"$21:metadata"
